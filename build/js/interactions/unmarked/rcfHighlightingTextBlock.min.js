(window.rcfRunTime_24113=window.rcfRunTime_24113||[]).push([["interactions/unmarked/rcfHighlightingTextBlock"],{417:function(t,e){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},430:function(t,e,r){"use strict";var o=r(19),i=r(513),n=r(50),s=r(21),a=r(89),c=r(88),l=r(49).f,h=r(54),g=r(241),d=r(41),u=r(150),f=r(26),p=r(514),m=r(237),E=r(417),v=r(240),b=r(63),C=r(42),T=r(46),O=n("Error"),R=n("DOMException")||function(){try{(new(n("MessageChannel")||i("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(t){if("DATA_CLONE_ERR"==t.name&&25==t.code)return t.constructor}}(),y=R&&R.prototype,S=O.prototype,N=b.set,A=b.getterFor("DOMException"),w="stack"in O("DOMException"),x=function(t){return d(E,t)&&E[t].m?E[t].c:0},D=function(){u(this,_);var t=arguments.length,e=m(t<1?void 0:arguments[0]),r=m(t<2?void 0:arguments[1],"Error"),o=x(r);if(N(this,{type:"DOMException",name:r,message:e,code:o}),C||(this.name=r,this.message=e,this.code=o),w){var i=O(e);i.name="DOMException",l(this,"stack",c(1,v(i.stack,1)))}},_=D.prototype=a(S),H=function(t){return{enumerable:!0,configurable:!0,get:t}},I=function(t){return H((function(){return A(this)[t]}))};C&&(g(_,"code",I("code")),g(_,"message",I("message")),g(_,"name",I("name"))),l(_,"constructor",c(1,D));var k=s((function(){return!(new R instanceof O)})),M=k||s((function(){return S.toString!==p||"2: 1"!==String(new R(1,2))})),L=k||s((function(){return 25!==new R(1,"DataCloneError").code})),P=k||25!==R.DATA_CLONE_ERR||25!==y.DATA_CLONE_ERR,B=T?M||L||P:k;o({global:!0,constructor:!0,forced:B},{DOMException:B?D:R});var j=n("DOMException"),V=j.prototype;for(var $ in M&&(T||R===j)&&h(V,"toString",p),L&&C&&R===j&&g(V,"code",H((function(){return x(f(this).name)}))),E)if(d(E,$)){var U=E[$],z=U.s,Y=c(6,U.c);d(j,z)||l(j,z,Y),d(V,z)||l(V,z,Y)}},431:function(t,e,r){"use strict";var o=r(19),i=r(50),n=r(88),s=r(49).f,a=r(41),c=r(150),l=r(160),h=r(237),g=r(417),d=r(240),u=r(46),f=i("Error"),p=i("DOMException"),m=function(){c(this,E);var t=arguments.length,e=h(t<1?void 0:arguments[0]),r=h(t<2?void 0:arguments[1],"Error"),o=new p(e,r),i=f(e);return i.name="DOMException",s(o,"stack",n(1,d(i.stack,1))),l(o,this,m),o},E=m.prototype=p.prototype,v="stack"in f("DOMException"),b="stack"in new p(1,2),C=v&&!b;o({global:!0,constructor:!0,forced:u||C},{DOMException:C?m:p});var T=i("DOMException"),O=T.prototype;if(O.constructor!==T)for(var R in u||s(O,"constructor",n(1,T)),g)if(a(g,R)){var y=g[R],S=y.s;a(T,S)||s(T,S,n(6,y.c))}},432:function(t,e,r){var o=r(50);r(127)(o("DOMException"),"DOMException")},513:function(t,e,r){var o=r(108);t.exports=function(t){try{if(o)return Function('return require("'+t+'")')()}catch(t){}}},514:function(t,e,r){"use strict";var o=r(42),i=r(21),n=r(26),s=r(89),a=r(237),c=Error.prototype.toString,l=i((function(){if(o){var t=s(Object.defineProperty({},"name",{get:function(){return this===t}}));if("true"!==c.call(t))return!0}return"2: 1"!==c.call({message:1,name:2})||"Error"!==c.call({})}));t.exports=l?function(){var t=n(this),e=a(t.name,"Error"),r=a(t.message);return e?r?e+": "+r:e:r}:c},695:function(t,e,r){"use strict";r.r(e);r(25),r(32),r(33);const o=[],i=t=>{const e=new Set;return[()=>{const r=o[o.length-1];return r&&e.add(r),t},r=>{t=r;for(const t of e)t()}]};var n=r(5),s=r.n(n),a=r(98);var c=(t,e)=>{const{$colorTools:r,$showToolsButton:o,$activity:i}=t;r.off("click").on("click","button",t=>{const r=s()(t.currentTarget).attr("data-rcfColorClass");e(r)}),o.off("click").on("click",()=>{i.toggleClass("highlighterToolsOpen");const t=i.hasClass("highlighterToolsOpen")?"interactions.highlightingTextBlock.toolsButtonOpen":"interactions.highlightingTextBlock.toolsButtonClosed";o.attr("aria-label",a.a.t(t))})};r(101),r(153),r(106),r(102),r(6),r(13),r(15),r(16),r(170),r(171),r(59),r(100);const l="data-highlighted",h=1,g=3,d=["SCRIPT","STYLE","SELECT","OPTION","BUTTON","OBJECT","APPLET","VIDEO","AUDIO","CANVAS","EMBED","PARAM","METER","PROGRESS"],u=(t,e)=>(null==t?void 0:t.nodeType)===e,f=t=>u(t,g),p=(t,e)=>{t.sort((t,r)=>v(e?r:t).parents().length-v(e?t:r).parents().length)},m=(t,e)=>!(!t.hasAttribute("data-rcf-highlight")||!e.hasAttribute("data-rcf-highlight"))&&t.getAttribute("data-rcf-highlight")===e.getAttribute("data-rcf-highlight"),E=t=>({addClass(e){t.classList?t.classList.add(e):t.className+=" ".concat(e)},removeClass(e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e+"(\\b|$)","gi")," ")},prepend(e){const r=Array.prototype.slice.call(e);let o=r.length;for(;o--;)t.insertBefore(r[o],t.firstChild)},append(e){const r=Array.prototype.slice.call(e);for(let e=0,o=r.length;e<o;++e)t.appendChild(r[e])},insertAfter:e=>e.parentNode.insertBefore(t,e.nextSibling),insertBefore:e=>e.parentNode.insertBefore(t,e),remove(){t.parentNode.removeChild(t),t=null},contains:e=>t!==e&&t.contains(e),wrap:e=>(t.parentNode&&t.parentNode.insertBefore(e,t),e.appendChild(t),e),unwrap(){const e=Array.prototype.slice.call(t.childNodes);let r;return e.forEach((function(t){r=t.parentNode,E(t).insertBefore(t.parentNode),E(r).remove()})),e},parents(){let e;const r=[];for(;e=t.parentNode;)r.push(e),t=e;return r},normalizeTextNodes(){if(t){if(t.nodeType===g)for(;t.nextSibling&&t.nextSibling.nodeType===g;)t.nodeValue+=t.nextSibling.nodeValue,t.parentNode.removeChild(t.nextSibling);else E(t.firstChild).normalizeTextNodes();E(t.nextSibling).normalizeTextNodes()}},color:()=>t.style.backgroundColor,fromHTML(t){const e=document.createElement("div");return e.innerHTML=t,e.childNodes},getRange(){const e=E(t).getSelection();let r;return e.rangeCount>0&&(r=e.getRangeAt(0)),r},removeAllRanges(){E(t).getSelection().removeAllRanges()},getSelection:()=>E(t).getWindow().getSelection(),getWindow:()=>E(t).getDocument().defaultView,getDocument:()=>t.ownerDocument||t});var v=E,b=r(4);function C(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function T(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?C(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function O(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const R=(t,e)=>T(T({},e),t);var y=class{constructor(t,e){if(this.mouseStartX=0,this.mouseStartY=0,this.originalHtml=t.innerHTML,!t)throw"Missing anchor element";var r,o;this.el=t,this.options=R(e,{colorClass:"rcf-highlight",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:()=>!0,onBeforeHighlight:()=>!0,onAfterHighlight(){}}),v(this.el).addClass(this.options.contextClass),r=this.el,o=this,r.addEventListener("mousedown",o.mouseDown.bind(o)),r.addEventListener("click",o.mouseClick.bind(o)),r.addEventListener("keypress",o.keyPress.bind(o)),r.addEventListener("mouseup",o.highlightHandler.bind(o)),r.addEventListener("touchend",o.highlightHandler.bind(o))}destroy(){var t,e;t=this.el,e=this,t.removeEventListener("mousedown",e.mouseDown.bind(e)),t.removeEventListener("click",e.mouseClick.bind(e)),t.removeEventListener("keypress",e.keyPress.bind(e)),t.removeEventListener("mouseup",e.highlightHandler.bind(e)),t.removeEventListener("touchend",e.highlightHandler.bind(e)),v(this.el).removeClass(this.options.contextClass)}mouseDown(t){this.mouseStartX=t.clientX,this.mouseStartY=t.clientY}mouseClick(t){const e=this;if(Math.abs(t.clientX-e.mouseStartX)<5&&Math.abs(t.clientY-e.mouseStartY)<5){const r=t.target;if(e.isHighlight(r)){const r=t.target.getAttribute("data-timestamp");if(!r)return;document.querySelectorAll("[".concat("data-timestamp",'="').concat(r,'"]')).forEach(t=>{e.removeHighlights(t)})}t.stopPropagation()}}keyPress(t){if("Enter"!==t.key)return;t.stopPropagation();const e=t.target;if(this.isHighlight(e)){const t=e.getAttribute("data-timestamp");if(!t)return;document.querySelectorAll("[".concat("data-timestamp",'="').concat(t,'"]')).forEach(t=>{this.removeHighlights(t)})}}highlightHandler(t){this.doHighlight(),t.stopPropagation()}doHighlight(t){const e=v(this.el).getRange();if(e&&!e.collapsed){if(!0===this.options.onBeforeHighlight(e)){const t=+new Date,r=(t=>{let{highlightedClass:e,colorClass:r}=t;const o=document.createElement("span");return o.classList.add(e),o.classList.add(r),o.setAttribute("data-rcf-highlight",r),o.setAttribute("title","click to remove"),o})(this.options);r.setAttribute("data-timestamp",t);const o=this.highlightRange(e,r),i=this.normalizeHighlights(o);this.options.onAfterHighlight(e,i,t)}t||v(this.el).removeAllRanges()}}highlightRange(t,e){if(!t||t.collapsed)return[];const r=(t=>{let{startContainer:e,endContainer:r}=t;const{ancestor:o}=t.commonAncestorContainer;let i=!0;if(0===t.endOffset){for(;!r.previousSibling&&r.parentNode!==o;)r=r.parentNode;r=r.previousSibling}else r.nodeType===g?t.endOffset<r.nodeValue.length&&r.splitText(t.endOffset):t.endOffset>0&&(r=r.childNodes.item(t.endOffset-1));return e.nodeType===g?t.startOffset===e.nodeValue.length?i=!1:t.startOffset>0&&(e=e.splitText(t.startOffset),r===e.previousSibling&&(r=e)):e=t.startOffset<e.childNodes.length?e.childNodes.item(t.startOffset):e.nextSibling,{startContainer:e,endContainer:r,goDeeper:i}})(t),{startContainer:o,endContainer:i}=r;let{goDeeper:n}=r,s=!1,a=o;const c=[];do{if(n&&f(a)){if(!d.includes(a.parentNode.tagName)&&""!==a.nodeValue.trim()){const t=e.cloneNode(!0);t.setAttribute(l,!0);const r=a.parentNode;if(v(this.el).contains(r)||r===this.el){const e=v(a).wrap(t);c.push(e)}}n=!1}a!==i||i.hasChildNodes()&&n||(s=!0),a.tagName&&d.includes(a.tagName)&&(i.parentNode===a&&(s=!0),n=!1),n&&a.hasChildNodes()?a=a.firstChild:a.nextSibling?(a=a.nextSibling,n=!0):(a=a.parentNode,n=!1)}while(!s);return c}normalizeHighlights(t){this.flattenNestedHighlights(t),this.mergeSiblingHighlights(t);const e=t.filter(t=>t.parentElement?t:null);return Object(b.f)(e).sort((t,e)=>t.offsetTop-e.offsetTop||t.offsetLeft-e.offsetLeft)}flattenNestedHighlights(t){const e=this;let r=!1;p(t,!0);const o=()=>{let r=!1;return t.forEach((o,i)=>{const{parentElement:n}=o,s=n.previousSibling,a=n.nextSibling;e.isHighlight(n)&&(m(n,o)?(n.replaceChild(o.firstChild,o),t[i]=n,r=!0):(o.nextSibling||(v(o).insertBefore(a||n),r=!0),o.previousSibling||(v(o).insertAfter(s||n),r=!0),n.hasChildNodes()||v(n).remove()))}),r};do{r=o()}while(r)}mergeSiblingHighlights(t){const e=this,r=(t,r)=>r&&r.type===h&&m(t,r)&&e.isHighlight(r);t.forEach(t=>{const{previousSibling:e,nextSibling:o}=t;r(t,e)&&(v(t).prepend(e.childNodes),v(e).remove()),r(t,o)&&(v(t).append(o.childNodes),v(o).remove()),v(t).normalizeTextNodes()})}setColorClass(t){this.options.colorClass=t}getColorClass(){return this.options.colorClass}removeHighlights(t){const e=t||this.el,r=this.getHighlights({container:e}),o=this,i=t=>f(t),n=t=>{v(t).unwrap().forEach(t=>{(t=>{const{previousSibling:e,nextSibling:r}=t;i(e)&&(t.nodeValue=e.nodeValue+t.nodeValue,v(e).remove()),i(r)&&(t.nodeValue=t.nodeValue+r.nodeValue,v(r).remove())})(t)})};p(r,!0),r.forEach(t=>{!0===o.options.onRemoveHighlight(t)&&n(t)})}getHighlights(t){const e=R(t,{container:this.el}),r=[...e.container.querySelectorAll("[".concat(l,"]"))];return e.container.hasAttribute(l)&&r.push(e.container),r}isHighlight(t){return u(t,h)&&t.hasAttribute(l)}serializeHighlights(){const t=this.getHighlights(),e=this.el,r=[];return p(t,!1),t.forEach(t=>{let o=0;const{length:i}=t.textContent,n=function(t,e){const r=[];do{const e=[...t.parentNode.childNodes];r.unshift(e.indexOf(t)),t=t.parentNode}while(t!==e||!t);return r}(t,e);let s=t.cloneNode(!0);s.innerHTML="",s=s.outerHTML,f(t.previousSibling)&&(o=t.previousSibling.length),r.push([s,t.textContent,n.join(":"),o,i])}),JSON.stringify(r)}deserializeHighlights(t){let e;const r=[],o=this;if(!t)return r;try{e=JSON.parse(t)}catch(t){throw"Can't parse JSON: ".concat(t)}return e.forEach(t=>{try{(t=>{const e={wrapper:t[0],text:t[1],path:t[2].split(":"),offset:t[3],length:t[4]};let i,n,s,a=e.path.pop(),c=o.el;for(;s=e.path.shift();)c=c.childNodes[s];f(c.childNodes[a-1])&&(a-=1),c=c.childNodes[a],i=c.splitText(e.offset),i.splitText(e.length),i.nextSibling&&!i.nextSibling.nodeValue&&v(i.nextSibling).remove(),i.previousSibling&&!i.previousSibling.nodeValue&&v(i.previousSibling).remove(),n=v(i).wrap(v().fromHTML(e.wrapper)[0]),r.push(n)})(t)}catch(t){var e;null!==(e=console)&&void 0!==e&&e.warn&&console.warn("Can't deserialize highlight descriptor. Cause: ".concat(t))}}),r}},S=r(36);var N=(t,e)=>{e.forEach(t=>{const e=(t.getAttribute("data-rcf-highlight")||"").replace("highlighting-color",""),r=a.a.t("interactions.highlightingTextBlock.highlightedWith",{color:e}),o=Object(S.f)()?a.a.t("interactions.highlightingTextBlock.removeSelectionTouch"):a.a.t("interactions.highlightingTextBlock.removeSelectionClick"),i="".concat(r,", ").concat(o);t.setAttribute("role","mark"),t.setAttribute("aria-label",i),t.setAttribute("tabindex","0")})};var A=(t,e)=>{const{$selector:r}=t;r.each((r,o)=>{const i=o.getAttribute("data-rcfid")||"",n=new y(o,{colorClass:e,onAfterHighlight:N});t.instances[i]={highlighterInstance:n,$highlightingTextBlock:s()(o)}})};r(11);var w=(t,e)=>t.find('button[data-rcfColorClass="'.concat(e,'"]'));var x=(t,e)=>{const r=e.get(0),o=t.get(0),i=getComputedStyle(r).backgroundColor;o.style.setProperty("--selection-color",i)};var D=(t,e)=>{t.find(".active").removeClass("active"),e.addClass("active")};var _=(t,e)=>{const{$activity:r,$colorTools:o,instances:i}=t,n=w(o,e);0!==n.length?(D(o,n),x(r,n),Object.keys(i).forEach(t=>{const{highlighterInstance:r}=i[t];if(r)try{r.setColorClass(e)}catch(e){console.error("Error setting color class for block with id [".concat(t,"] ! ").concat(e))}})):console.error("The color class ".concat(e," is not a valid color class"))};var H=t=>t.find(".highlighterToolbarContainer");var I=t=>t.find(".showToolsButton");var k=t=>t.find(".highlighterColorTools");var M=t=>t.find(".active").attr("data-rcfColorClass");var L=t=>{const e=H(t.$activity),r=I(e),n=k(e),s=M(n),[a,l]=i(s);t.$colorTools=n,t.$showToolsButton=r,A(t,s),c(t,l),(t=>{const e=()=>{o.push(e);try{t()}finally{o.pop()}};e()})(()=>{_(t,a())})};r(430),r(431),r(432);var P=(t,e)=>{const{instances:r}=t;e.answers.forEach(t=>{const e=t.elm,o=r[e];if(!o)return;const{highlighterInstance:i}=o;i.removeHighlights();const n=decodeURIComponent(atob(t.value));i.deserializeHighlights(n)})},B=(r(48),r(8));var j=t=>{const{instances:e}=t;return Object.keys(e).map(t=>{const r=e[t].highlighterInstance.serializeHighlights();return{elm:t,type:B.a.simple,markType:B.d.unmarked,value:btoa(encodeURIComponent(r))}})};var V=t=>{Object.keys(t.instances).forEach(e=>{const{highlighterInstance:r}=t.instances[e];if(r)try{r.removeHighlights()}catch(t){console.error("Error removing highlights for block with id [".concat(e,"] ! ").concat(t))}})};var $=t=>{V(t),t.$activity.removeClass("highlighterToolsOpen")};var U=t=>{Object.keys(t.instances).forEach(e=>{const{highlighterInstance:r}=t.instances[e];try{r.removeHighlights(),r.destroy()}catch(t){console.warn("Warning: error when removing highlights / clearing up highligher instances for rcfid ".concat(e," ! ").concat(t))}})};function z(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}e.default=class{constructor(t,e){z(this,"$activity",void 0),z(this,"$selector",void 0),z(this,"$showToolsButton",void 0),z(this,"$colorTools",void 0),z(this,"instances",void 0),this.instances={},this.$activity=t,this.$selector=e,L(this)}getUserAnswers(){return j(this)}showAnswers(t){P(this,t)}close(){U(this)}reset(t){t||$(this)}}}}]);
/* build created on 15/08/2025 16:19 */
//# sourceMappingURL=http://localhost:4000/source-maps/interactions/unmarked/rcfHighlightingTextBlock.js.map