(window.rcfRunTime_24113=window.rcfRunTime_24113||[]).push([["interactions/openGradable/rcfOpenGradableFreeDrawing"],{354:function(t,e,r){"use strict";var i=r(19),n=r(360).start;i({target:"String",proto:!0,forced:r(362)},{padStart:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},360:function(t,e,r){var i=r(20),n=r(125),o=r(61),s=r(361),a=r(74),c=i(s),h=i("".slice),l=Math.ceil,d=function(t){return function(e,r,i){var s,d,u=o(a(e)),p=n(r),v=u.length,f=void 0===i?" ":o(i);return p<=v||""==f?u:((d=c(f,l((s=p-v)/f.length))).length>s&&(d=h(d,0,s)),t?u+d:d+u)}};t.exports={start:d(!1),end:d(!0)}},361:function(t,e,r){"use strict";var i=r(85),n=r(61),o=r(74),s=RangeError;t.exports=function(t){var e=n(o(this)),r="",a=i(t);if(a<0||a==1/0)throw s("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(r+=e);return r}},362:function(t,e,r){var i=r(69);t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)},377:function(t,e,r){var i,n,o;n=[t,e],void 0===(o="function"==typeof(i=function(t,e){"use strict";var r,i,n="function"==typeof Map?new Map:(r=[],i=[],{has:function(t){return r.indexOf(t)>-1},get:function(t){return i[r.indexOf(t)]},set:function(t,e){-1===r.indexOf(t)&&(r.push(t),i.push(e))},delete:function(t){var e=r.indexOf(t);e>-1&&(r.splice(e,1),i.splice(e,1))}}),o=function(t){return new Event(t,{bubbles:!0})};try{new Event("test")}catch(t){o=function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!1),e}}function s(t){if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!n.has(t)){var e,r=null,i=null,s=null,a=function(){t.clientWidth!==i&&d()},c=function(e){window.removeEventListener("resize",a,!1),t.removeEventListener("input",d,!1),t.removeEventListener("keyup",d,!1),t.removeEventListener("autosize:destroy",c,!1),t.removeEventListener("autosize:update",d,!1),Object.keys(e).forEach((function(r){t.style[r]=e[r]})),n.delete(t)}.bind(t,{height:t.style.height,resize:t.style.resize,overflowY:t.style.overflowY,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",c,!1),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",d,!1),window.addEventListener("resize",a,!1),t.addEventListener("input",d,!1),t.addEventListener("autosize:update",d,!1),t.style.overflowX="hidden",t.style.wordWrap="break-word",n.set(t,{destroy:c,update:d}),"vertical"===(e=window.getComputedStyle(t,null)).resize?t.style.resize="none":"both"===e.resize&&(t.style.resize="horizontal"),r="content-box"===e.boxSizing?-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)):parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth),isNaN(r)&&(r=0),d()}function h(e){var r=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=r,t.style.overflowY=e}function l(){if(0!==t.scrollHeight){var e=function(t){for(var e=[];t&&t.parentNode&&t.parentNode instanceof Element;)t.parentNode.scrollTop&&e.push({node:t.parentNode,scrollTop:t.parentNode.scrollTop}),t=t.parentNode;return e}(t),n=document.documentElement&&document.documentElement.scrollTop;t.style.height="",t.style.height=t.scrollHeight+r+"px",i=t.clientWidth,e.forEach((function(t){t.node.scrollTop=t.scrollTop})),n&&(document.documentElement.scrollTop=n)}}function d(){l();var e=Math.round(parseFloat(t.style.height)),r=window.getComputedStyle(t,null),i="content-box"===r.boxSizing?Math.round(parseFloat(r.height)):t.offsetHeight;if(i<e?"hidden"===r.overflowY&&(h("scroll"),l(),i="content-box"===r.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight):"hidden"!==r.overflowY&&(h("hidden"),l(),i="content-box"===r.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight),s!==i){s=i;var n=o("autosize:resized");try{t.dispatchEvent(n)}catch(t){}}}}function a(t){var e=n.get(t);e&&e.destroy()}function c(t){var e=n.get(t);e&&e.update()}var h=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((h=function(t){return t}).destroy=function(t){return t},h.update=function(t){return t}):((h=function(t,e){return t&&Array.prototype.forEach.call(t.length?t:[t],(function(t){return s(t)})),t}).destroy=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],a),t},h.update=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],c),t}),e.default=h,t.exports=e.default})?i.apply(e,n):i)||(t.exports=o)},398:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));r(25);function i(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class n{constructor(t,e){i(this,"$activity",void 0),i(this,"$selector",void 0),i(this,"interactionFunctions",void 0),this.interactionFunctions=e,this.$activity=t}getUserAnswers(){return this.interactionFunctions.getUserAnswers(this.$selector)}showAnswers(t){this.interactionFunctions.showAnswers(this.$selector,t)}setInteractionMode(t,e){this.interactionFunctions.setInteractionMode(this.$selector,t,e)}getTeacherFeedback(){return this.interactionFunctions.getTeacherFeedback(this.$selector)}isComplete(){return!this.interactionFunctions.isComplete||this.interactionFunctions.isComplete(this.$selector)}reset(){this.interactionFunctions.reset&&this.interactionFunctions.reset(this.$selector)}}},417:function(t,e){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},430:function(t,e,r){"use strict";var i=r(19),n=r(513),o=r(50),s=r(21),a=r(89),c=r(88),h=r(49).f,l=r(54),d=r(241),u=r(41),p=r(150),v=r(26),f=r(514),g=r(237),b=r(417),w=r(240),m=r(63),y=r(42),E=r(46),C=o("Error"),O=o("DOMException")||function(){try{(new(o("MessageChannel")||n("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(t){if("DATA_CLONE_ERR"==t.name&&25==t.code)return t.constructor}}(),S=O&&O.prototype,A=C.prototype,T=m.set,R=m.getterFor("DOMException"),$="stack"in C("DOMException"),D=function(t){return u(b,t)&&b[t].m?b[t].c:0},z=function(){p(this,P);var t=arguments.length,e=g(t<1?void 0:arguments[0]),r=g(t<2?void 0:arguments[1],"Error"),i=D(r);if(T(this,{type:"DOMException",name:r,message:e,code:i}),y||(this.name=r,this.message=e,this.code=i),$){var n=C(e);n.name="DOMException",h(this,"stack",c(1,w(n.stack,1)))}},P=z.prototype=a(A),k=function(t){return{enumerable:!0,configurable:!0,get:t}},x=function(t){return k((function(){return R(this)[t]}))};y&&(d(P,"code",x("code")),d(P,"message",x("message")),d(P,"name",x("name"))),h(P,"constructor",c(1,z));var j=s((function(){return!(new O instanceof C)})),_=j||s((function(){return A.toString!==f||"2: 1"!==String(new O(1,2))})),B=j||s((function(){return 25!==new O(1,"DataCloneError").code})),I=j||25!==O.DATA_CLONE_ERR||25!==S.DATA_CLONE_ERR,N=E?_||B||I:j;i({global:!0,constructor:!0,forced:N},{DOMException:N?z:O});var M=o("DOMException"),F=M.prototype;for(var L in _&&(E||O===M)&&l(F,"toString",f),B&&y&&O===M&&d(F,"code",k((function(){return D(v(this).name)}))),b)if(u(b,L)){var U=b[L],W=U.s,H=c(6,U.c);u(M,W)||h(M,W,H),u(F,W)||h(F,W,H)}},431:function(t,e,r){"use strict";var i=r(19),n=r(50),o=r(88),s=r(49).f,a=r(41),c=r(150),h=r(160),l=r(237),d=r(417),u=r(240),p=r(46),v=n("Error"),f=n("DOMException"),g=function(){c(this,b);var t=arguments.length,e=l(t<1?void 0:arguments[0]),r=l(t<2?void 0:arguments[1],"Error"),i=new f(e,r),n=v(e);return n.name="DOMException",s(i,"stack",o(1,u(n.stack,1))),h(i,this,g),i},b=g.prototype=f.prototype,w="stack"in v("DOMException"),m="stack"in new f(1,2),y=w&&!m;i({global:!0,constructor:!0,forced:p||y},{DOMException:y?g:f});var E=n("DOMException"),C=E.prototype;if(C.constructor!==E)for(var O in p||s(C,"constructor",o(1,E)),d)if(a(d,O)){var S=d[O],A=S.s;a(E,A)||s(E,A,o(6,S.c))}},432:function(t,e,r){var i=r(50);r(127)(i("DOMException"),"DOMException")},513:function(t,e,r){var i=r(108);t.exports=function(t){try{if(i)return Function('return require("'+t+'")')()}catch(t){}}},514:function(t,e,r){"use strict";var i=r(42),n=r(21),o=r(26),s=r(89),a=r(237),c=Error.prototype.toString,h=n((function(){if(i){var t=s(Object.defineProperty({},"name",{get:function(){return this===t}}));if("true"!==c.call(t))return!0}return"2: 1"!==c.call({message:1,name:2})||"Error"!==c.call({})}));t.exports=h?function(){var t=o(this),e=a(t.name,"Error"),r=a(t.message);return e?r?e+": "+r:e:r}:c},691:function(t,e,r){"use strict";r.r(e);r(25),r(31),r(6),r(11);var i=r(5),n=r.n(i),o=(r(59),r(100),r(4));r(32),r(33);const s=[],a=t=>{const e=new Set;return[()=>{const r=s[s.length-1];return r&&e.add(r),t},r=>{t=r;for(const t of e)t()}]},c="pencil",h="highlighter",l=3,d=8,u=15;r(106),r(13),r(15),r(16),r(430),r(431),r(432);function p(t){try{const e={},r=[...t],i=[];let n=r[0],o=256;for(let t=1;t<r.length;t++){const s=r[t];void 0!==e["".concat(n).concat(s)]?n+=s:(i.push(n.length>1?e[n]:n.charCodeAt(0)),e["".concat(n).concat(s)]=o,o++,n=s)}return i.push(n.length>1?e[n]:n.charCodeAt(0)),function(t){return window.btoa(unescape(encodeURIComponent(t)))}(i.map(t=>String.fromCharCode(t)).join(""))}catch(t){return console.error("Failed to compress string - return empty string",t),""}}function v(t){try{const r=(e=t,decodeURIComponent(escape(window.atob(e)))),i={},n=[...r];let o=n[0],s=o;const a=[o];let c,h=256;for(let t=1;t<n.length;t++){const e=n[t].charCodeAt(0);c=e<256?n[t]:i[e]||s+o,a.push(c),o=c.charAt(0),i[h]=s+o,h++,s=c}return a.join("")}catch(t){return console.error("Failed to unzip string, returning empty string",t),""}var e}function f(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function g(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?f(Object(r),!0).forEach((function(e){b(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function b(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const w="pencil",m="highlighter";var y=class{constructor(t,e){b(this,"_originalAnswer",void 0),b(this,"container",void 0),b(this,"canvas",void 0),b(this,"ctx",void 0),b(this,"createdWidth",void 0),b(this,"createdHeight",void 0),b(this,"isDrawing",void 0),b(this,"paths",void 0),b(this,"rzTimeout",void 0),b(this,"redo",void 0),b(this,"readonly",void 0),b(this,"opts",void 0),b(this,"brushType",void 0),this.opts={width:600,height:600,size:void 0,color:"#000000",brushSize:3,fullSize:!0,fullscreen:!1,lineCap:"round",lineJoin:"round"},this.brushType=w,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.isDrawing=!1,this.paths=[],this.redo=[],this.opts=g(g({},this.opts),e),this.initializeContainer(t),this.initializeOptions(),this.initializeCanvas(),this.canvas.addEventListener("mousedown",this.handleStart.bind(this)),this.canvas.addEventListener("mousemove",this.handleMove.bind(this)),document.addEventListener("mouseup",this.handleEnd.bind(this)),this.canvas.addEventListener("touchstart",this.handleStart.bind(this)),this.canvas.addEventListener("touchmove",this.handleMove.bind(this)),document.addEventListener("touchend",this.handleEnd.bind(this)),document.addEventListener("keydown",this.handleKeypress.bind(this)),window.addEventListener("resize",this.handleResize.bind(this))}destroy(){this.canvas.removeEventListener("mousedown",this.handleStart.bind(this)),this.canvas.removeEventListener("mousemove",this.handleMove.bind(this)),document.removeEventListener("mouseup",this.handleEnd.bind(this)),this.canvas.removeEventListener("touchstart",this.handleStart.bind(this)),this.canvas.removeEventListener("touchmove",this.handleMove.bind(this)),document.removeEventListener("touchend",this.handleEnd.bind(this)),document.removeEventListener("keydown",this.handleKeypress.bind(this)),window.removeEventListener("resize",this.handleResize.bind(this))}handleKeypress(t){const e=t.ctrlKey||t.metaKey;this.readonly||(this._originalAnswer="",e&&"KeyZ"===t.code&&this.undoPaint(),e&&"KeyY"===t.code&&(this.redoPaint(),t.preventDefault(),t.stopPropagation()))}getBrush(){return{color:this.opts.color,brushSize:this.opts.brushSize,lineCap:this.opts.lineCap,lineJoin:this.opts.lineJoin}}handleStart(t){t.preventDefault(),this.readonly||(this._originalAnswer="",(1===t.buttons||t.touches)&&(this.isDrawing=!0,this.paths.push([[...this.coordinates(t),this.getBrush()]]),this.draw()))}handleMove(t){if(t.preventDefault(),this.readonly)return;this._originalAnswer="";const e=this.coordinates(t);this.isDrawing&&(this.paths[this.paths.length-1].push(e),this.draw())}handleEnd(){this.readonly||(this._originalAnswer="",this.isDrawing&&this.drawingChanged(),this.isDrawing=!1)}handleResize(){this.rzTimeout&&(window.clearTimeout(this.rzTimeout),this.rzTimeout=null),this.rzTimeout=setTimeout(()=>{this.rescaleDrawing(this.opts.height||600,this.opts.width||600)},200)}rescaleDrawing(t,e){this.createdHeight=t,this.createdWidth=e;const{width:r,height:i}=this.container.getBoundingClientRect();this.opts.width=r,this.opts.height=i,this.initializeCanvasSize();const n=this.createdWidth,o=this.createdHeight,s=this.canvas.width,a=this.canvas.height,c=s/n,h=a/o,l=Math.sqrt(c*h);this.paths.forEach(t=>{t.forEach(t=>{t[0]=Math.round(t[0]*c),t[1]=Math.round(t[1]*h),t.settings&&(t.settings.brushSize=Math.round(t.settings.brushSize*l))})}),this.draw()}initializeContainer(t){this.container=t,this.container.style.overflow="hidden",this._originalAnswer=""}initializeOptions(){const{width:t,height:e}=this.container.getBoundingClientRect();this.opts.width=t,this.opts.height=e,this.createdHeight=this.opts.height,this.createdWidth=this.opts.width}initializeCanvas(){this.initializeCanvasSize(),this.container.appendChild(this.canvas)}initializeCanvasSize(){this.canvas.width=this.opts.width||600,this.canvas.height=this.opts.height||600}coordinates(t){const e=this.canvas.getBoundingClientRect(),r="touches"in t,[i,n]=r?[t.touches[0].clientX,t.touches[0].clientY]:[t.clientX,t.clientY];return[i-e.left,n-e.top]}draw(){this.clearOnlyScreen(),this.drawPath()}drawPath(){for(let t=0;t<this.paths.length;t++){const e=this.paths[t],r=e[0];this.ctx.lineWidth=r[2].brushSize,this.ctx.strokeStyle=r[2].color,this.ctx.beginPath(),this.ctx.moveTo(...r);for(let t=0;t<e.length;t++)this.ctx.lineTo(e[t][0],e[t][1]);this.ctx.lineCap=r[2].lineCap,this.ctx.lineJoin=r[2].lineJoin,this.ctx.stroke()}}set brushSize(t){this.opts.brushSize=t}get brushSize(){return this.opts.brushSize}set brushColor(t){this.brushType!=m?this.opts.color=t:this.opts.color=t+"55"}get brushColor(){return this.opts.color}pencil(){this.brushType=w,this.opts.lineCap="round",this.opts.lineJoin="round"}highlighter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;this.brushType=m,this.brushSize=t;const e=this.brushColor;this.brushColor=e,this.opts.lineCap="butt",this.opts.lineJoin="round"}redraw(){this.draw()}clearOnlyScreen(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.clearOnlyScreen(),this.paths=[],this.isDrawing=!1,this.drawingChanged(),this._originalAnswer=""}undoPaint(){this.paths.length>0&&(this._originalAnswer="",this.redo.push({type:"path",data:this.paths[this.paths.length-1]}),this.paths.pop(),this.redraw(),this.drawingChanged())}redoPaint(){const t=this.redo[this.redo.length-1];t&&"path"==t.type&&(this._originalAnswer="",this.paths.push(t.data),this.redraw(),this.redo.pop(),this.drawingChanged())}canUndo(){return this.paths.length>0}canRedo(){return this.redo.length>0}drawingChanged(){const t=new CustomEvent("rcf.drawing.changed",{bubbles:!1,cancelable:!0,composed:!1});this.container.dispatchEvent(t)}getUserAnswer(){if(0===this.paths.length)return"";if(this.readonly&&this._originalAnswer)return this._originalAnswer;const t={sizeWhenSaved:{width:this.canvas.width,height:this.canvas.height},paths:this.paths};return p(JSON.stringify(t))}setUserAnswer(t){this._originalAnswer=t;const e=v(t),r=JSON.parse(e),{sizeWhenSaved:i,paths:n}=r;n&&(Array.isArray(n)||console.error("Invalid answers for drawing paths:",t),this.paths=n,this.draw(),this.rescaleDrawing(i.height,i.width))}setReadOnly(t){this.readonly&&(this._originalAnswer=""),this.readonly=t}};var E=r(8);var C=t=>{const e=t.attr("data-rcfinteraction");switch(e){case"recording":return E.a.openGradableRecording;case"writing":return E.a.openGradableWriting;case"teacherGradedTask":return E.a.openGradableTeacherGradedTask;case"freeDrawing":return E.a.openGradableFreeDrawing;default:throw new Error("Unknown open-gradable interaction type: "+e)}},O=r(17);var S=t=>{const e=C(t),r=E.d.byFeedback,i=Object(O.a)(t,"data-maxscore")||"";return{elm:Object(o.v)(t)||"",type:e,markType:r,max_score:i,value:{}}};function A(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function T(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var R=t=>{const e=t.find(".teacherScoreInput").val()||void 0;return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?A(Object(r),!0).forEach((function(e){T(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({comment:t.find(".teacherInteractionCommentTextArea").val()||""},(!!e||"0"===e)&&{score:Number(e)})};function $(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function D(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$(Object(r),!0).forEach((function(e){z(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function z(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var P=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{$interaction:r,$textAnswer:i,drawingTablet:n}=t,o=S(r),s=n.getUserAnswer(),a=i.val().toString();return D(D({},o),{},{value:D({user:{drawing:s,textAnswer:a}},e&&{teacher:R(r)})})};var k=t=>{let{state:e,drawingTablet:r}=t;r.brushSize=e.brushSize()};var x=t=>{let{state:e,drawingTablet:r,$pencilButton:i,$highlighterButton:n}=t;i.removeClass("active"),n.removeClass("active"),e.brushType()===c?(i.addClass("active"),r.pencil()):(n.addClass("active"),r.highlighter(4*e.brushSize()))};r(354),r(48);const j=t=>t.toLowerCase().startsWith("rgb")?"#".concat(t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/).slice(1).map(t=>parseInt(t,10).toString(16).padStart(2,"0")).join("")):t;var _=t=>{let{state:e,drawingTablet:r}=t;r.brushColor=j(e.color())};var B=t=>{let{$interaction:e,state:r,$colorButtons:i,brushSizeSelect:n}=t;const o=r.color(),s=r.colorIndex();let a=0,c=0;switch(Number(n.value)){case l:a=3,c=3;break;case d:a=5,c=5;break;case u:a=7,c=10}i.removeClass("active"),i.filter('[data-color="'.concat(s,'"]')).addClass("active");const h=e.find(".highlighter .color-indicator"),p=e.find(".pencil .color-indicator");h.attr({stroke:o,fill:o,"stroke-width":c}),p.attr({stroke:o,fill:o,r:a})};var I=t=>{let{state:e,$undoButton:r,$redoButton:i,$colorButtons:n,$pencilButton:o,$highlighterButton:s,$promptForClearAllButton:a,$colorPicker:c,brushSizeSelect:h}=t;const l=e.isReadOnly(),d=e.canUndo(),u=e.canRedo();r.prop("disabled",!d||l),i.prop("disabled",!u||l),n.prop("disabled",l),o.prop("disabled",l),s.prop("disabled",l),a.prop("disabled",l||!d),c.prop("disabled",l),h.disabled=l};var N=t=>{let{drawingTablet:e,state:r}=t;e.setReadOnly(r.isReadOnly())};var M=t=>{let{$interaction:e,state:r}=t;const i=r.isPromptingForClear();e.toggleClass("showPrompt",i),i&&e.find(".clearDrawingPrompt").focus()};var F=t=>{k(t),x(t),B(t),_(t),M(t),N(t),I(t)};var L=t=>{const{$interaction:e,$canvasContainer:r,$promptForClearAllButton:i,$colorPicker:n,$undoButton:o,$redoButton:s,$pencilButton:a,$highlighterButton:c,$confirmClearDrawing:h,$cancelClearDrawing:l,brushSizeSelect:d}=t;r.get(0).addEventListener("rcf.drawing.changed",t.drawingChanged.bind(t)),e.on("click","button.rcfColorButton",t.chooseColor.bind(t)),i.on("click",t.promptToClearDrawing.bind(t)),h.on("click",t.clearAll.bind(t)),l.on("click",t.cancelClearAll.bind(t)),n.on("input",t.chooseColorFromPicker.bind(t)),n.on("change",t.chooseColorFromPicker.bind(t)),o.on("click",t.undo.bind(t)),s.on("click",t.redo.bind(t)),a.on("click",t.setPencil.bind(t)),c.on("click",t.setHighlighter.bind(t)),d.addEventListener("change",t.brushSizeChange.bind(t)),e.on("keydown",e=>{27!==e.keyCode&&27!==e.which||t.cancelClearAll()})},U=r(403);function W(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const H=[],Y=t=>{const e=G(t);let r=H.find(t=>t.id===e);return r||(r=new J(t),H.push(r)),r},G=t=>{const e=t.closest(".activity");return"".concat(e[0].id,"-").concat(Object(o.v)(t)||"")};class J{constructor(t){W(this,"id",void 0),W(this,"$activity",void 0),W(this,"$interaction",void 0),W(this,"$canvasContainer",void 0),W(this,"drawingTablet",void 0),W(this,"$pencilButton",void 0),W(this,"$highlighterButton",void 0),W(this,"$promptForClearAllButton",void 0),W(this,"$colorButtons",void 0),W(this,"$colorPicker",void 0),W(this,"$redoButton",void 0),W(this,"$undoButton",void 0),W(this,"$textAnswer",void 0),W(this,"$reviewStudentAnswer",void 0),W(this,"$confirmClearDrawing",void 0),W(this,"$cancelClearDrawing",void 0),W(this,"brushSizeSelect",void 0),W(this,"state",void 0),this.$interaction=t,this.$canvasContainer=t.find(".freeDrawing-canvasContainer"),this.$activity=t.closest(".activity"),this.id=G(t)}initialise(){const{$interaction:t}=this;this.$colorButtons=t.find(".rcfColorButton"),this.$pencilButton=t.find(".freeDrawing-button.pencil"),this.$highlighterButton=t.find(".freeDrawing-button.highlighter"),this.$promptForClearAllButton=t.find(".freeDrawing-button.promptForClearAll"),this.$redoButton=t.find(".freeDrawing-button.redo"),this.$undoButton=t.find(".freeDrawing-button.undo"),this.$colorPicker=t.find(".freeDrawing-colorPicker"),this.$confirmClearDrawing=t.find("button.confirmClearDrawing"),this.$cancelClearDrawing=t.find("button.cancelClearDrawing"),this.$textAnswer=t.find("textArea.supplementaryTextAnswerTextArea"),this.$reviewStudentAnswer=t.find(".freeDrawingReview.reviewStudentAnswer"),this.brushSizeSelect=t.find(".freeDrawing-select.brushSize")[0];const e=this.$colorButtons.eq(0).css("background-color");Object(U.a)(this.$interaction.find(".rcfTextArea")),this.$colorButtons.eq(0).addClass("active"),this.state=(()=>{const[t,e]=a(c),[r,i]=a("#000000"),[n,o]=a("color1"),[s,h]=a(d),[l,u]=a(!1),[p,v]=a(!1),[f,g]=a(!1),[b,w]=a(!1);return{brushType:t,setBrushType:e,color:r,setColor:i,colorIndex:n,setColorIndex:o,brushSize:s,setBrushSize:h,canUndo:l,setCanUndo:u,canRedo:p,setCanRedo:v,isReadOnly:f,setReadOnly:g,isPromptingForClear:b,setPromptingForClear:w}})(),this.drawingTablet=new y(this.$canvasContainer[0],{logs:!0,fullSize:!0,brushSize:Number(this.brushSizeSelect.value)||8,color:e}),this.setInitialState(),(t=>{const e=()=>{s.push(e);try{t()}finally{s.pop()}};e()})(()=>{F(this)}),L(this)}setInitialState(){const t=this.$colorButtons.eq(0).data("color"),e=this.$colorButtons.eq(0).css("background-color");this.$colorButtons.eq(0).addClass("active"),this.brushSizeSelect.value="8",this.state.setBrushType(c),this.state.setColor(e),this.state.setColorIndex(t),this.state.setBrushSize(8),this.state.setReadOnly(!1)}showAnswers(t){var e,r;const{$textAnswer:i,$reviewStudentAnswer:n}=this,s=t.value,a=null==s||null===(e=s.user)||void 0===e?void 0:e.drawing,c=(null==s||null===(r=s.user)||void 0===r?void 0:r.textAnswer)||"";if(a&&this.drawingTablet.setUserAnswer(a),i.val(c),n.html(Object(o.h)(c).replace(/(?:\r\n|\r|\n)/g," <br/>")),c.length>0&&(this.$activity.hasClass("marked")||this.$activity.hasClass("disabled"))){const t=this.$interaction.find('[data-rcfinteraction="collapsibleBlock"]');t.hasClass("collapsibleOpen")||t.find("button.singleButton.collapsibleButton").click(),Object(U.a)(i)}}getUserAnswers(){return P(this)}getTeacherFeedback(){return P(this,!0)}drawingChanged(){this.state.setCanUndo(this.drawingTablet.canUndo()),this.state.setCanRedo(this.drawingTablet.canRedo())}setPencil(){const t=Number(this.brushSizeSelect.value);this.state.setBrushType(c),this.state.setBrushSize(t)}setHighlighter(){this.state.setBrushType(h)}brushSizeChange(t){const e=t.target.value;this.state.setBrushSize(e)}undo(){this.drawingTablet.undoPaint()}redo(){this.drawingTablet.redoPaint()}promptToClearDrawing(){this.state.setPromptingForClear(!0)}clearAll(){this.drawingTablet.clear(),this.state.setPromptingForClear(!1)}cancelClearAll(){this.state.setPromptingForClear(!1)}chooseColorFromPicker(t){const e=(t.target.value||"#000000").toString();this.state.setColor(e),this.state.setColorIndex("colorPicker")}chooseColor(t){const e=n()(t.currentTarget),r=e.data("color"),i=e.css("background-color");this.state.setColor(i),this.state.setColorIndex(r)}setReadOnly(t){this.state.setReadOnly(t)}isReadOnly(){return this.state.isReadOnly()}reset(){this.clearAll(),this.setInitialState()}destroy(){this.$canvasContainer&&this.$canvasContainer[0].removeEventListener("rcf.drawing.changed",this.drawingChanged.bind(this)),this.brushSizeSelect&&this.brushSizeSelect.removeEventListener("change",this.brushSizeChange.bind(this)),this.$pencilButton&&this.$pencilButton.off("click",this.setPencil.bind(this)),this.$highlighterButton&&this.$highlighterButton.off("click",this.setHighlighter.bind(this)),this.$promptForClearAllButton&&this.$promptForClearAllButton.off("click",this.clearAll.bind(this)),this.$interaction&&this.$interaction.off("click","button.rcfColorButton",this.chooseColor.bind(this)),this.$colorPicker&&this.$colorPicker.off("input",this.chooseColorFromPicker.bind(this)),this.$undoButton&&this.$undoButton.off("click",this.undo.bind(this)),this.$redoButton&&this.$redoButton.off("click",this.redo.bind(this)),this.$interaction.find(".clearDrawingPrompt").off("keydown"),this.drawingTablet&&this.drawingTablet.destroy()}}var K=r(398),X=r(70);var q=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.each((t,r)=>{const i=n()(r),o=Y(i);o&&o.setReadOnly(e)})},V=r(353);var Q=(t,e)=>{const r=Object(o.i)(t),i=e.id,n=r.attr("id");if(i!==n)throw"Invalid JSON answers provided for activity [".concat(n,"]");Object(V.a)(t,e).forEach(t=>{const e=Y(t.$interaction);e&&e.showAnswers(t)})};var Z=t=>Object(o.i)(t).hasClass(X.a.answerKeyMode)?[]:t.map((t,e)=>(t=>{const e=n()(t),r=Y(e);return r?r.getUserAnswers():null})(e)).get();var tt=t=>t.map((t,e)=>(t=>{const e=n()(t),r=Y(e);return r?r.getTeacherFeedback():null})(e)).get(),et=r(473),rt=r(463),it=r(464);var nt=(t,e)=>{const{$interaction:r}=t;Object(rt.a)(r,t),Object(it.a)(r,t,e)};var ot=(t,e,r)=>{switch(e){case X.a.default:q(t,!1);break;case X.a.leaveTeacherFeedback:case X.a.reviewTeacherFeedback:q(t,!0)}Object(et.a)(t,e,r,Q,nt)};r(86);const st=t=>{var e;return((null==t||null===(e=t.value)||void 0===e||null===(e=e.user)||void 0===e?void 0:e.drawing)||"").length>0};var at=t=>{const e=Z(t);if(0===e.length)return!1;return e.some(st)},ct=r(465),ht=r(466);var lt=t=>{const e=Object(ct.a)(t),r=t.find(".teacherScoreInput");t.find(".scoreResult").text(0),r.val(""),Object(ht.a)(e)};var dt=t=>{const e=Y(t);e&&e.reset()};var ut=t=>{lt(t),dt(t)};var pt=t=>{t.each((t,e)=>{const r=n()(e);ut(r)})};function vt(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class ft extends K.a{constructor(t){super(t,{getUserAnswers:Z,showAnswers:Q,setInteractionMode:ot,getTeacherFeedback:tt,isComplete:at,reset:pt}),vt(this,"$activity",void 0),vt(this,"$selector",void 0),this.$activity=t}async initialise(){const t=this.$activity.find('div[data-rcfinteraction="freeDrawing"]');this.$selector=t,t.each((t,e)=>{const r=n()(e);Y(r).initialise()})}enable(){this.$activity.hasClass(X.a.default)&&q(this.$selector,!1)}disable(){q(this.$selector,!0)}close(){this.$selector.each((t,e)=>{const r=n()(e);Y(r)&&(t=>{const e=G(t),r=H.findIndex(t=>t.id===e);if(r<0)return;H[r].destroy(),H.splice(r,1)})(r)})}}e.default=ft}}]);
/* build created on 15/08/2025 16:19 */
//# sourceMappingURL=http://localhost:4000/source-maps/interactions/openGradable/rcfOpenGradableFreeDrawing.js.map