(window.rcfRunTime_24113=window.rcfRunTime_24113||[]).push([["interactions/openGradable/rcfOpenGradableWriting"],{354:function(e,t,n){"use strict";var r=n(19),o=n(360).start;r({target:"String",proto:!0,forced:n(362)},{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},360:function(e,t,n){var r=n(20),o=n(125),a=n(61),i=n(361),c=n(74),s=r(i),l=r("".slice),d=Math.ceil,u=function(e){return function(t,n,r){var i,u,v=a(c(t)),f=o(n),p=v.length,h=void 0===r?" ":a(r);return f<=p||""==h?v:((u=s(h,d((i=f-p)/h.length))).length>i&&(u=l(u,0,i)),e?v+u:u+v)}};e.exports={start:u(!1),end:u(!0)}},361:function(e,t,n){"use strict";var r=n(85),o=n(61),a=n(74),i=RangeError;e.exports=function(e){var t=o(a(this)),n="",c=r(e);if(c<0||c==1/0)throw i("Wrong number of repetitions");for(;c>0;(c>>>=1)&&(t+=t))1&c&&(n+=t);return n}},362:function(e,t,n){var r=n(69);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)},377:function(e,t,n){var r,o,a;o=[e,t],void 0===(a="function"==typeof(r=function(e,t){"use strict";var n,r,o="function"==typeof Map?new Map:(n=[],r=[],{has:function(e){return n.indexOf(e)>-1},get:function(e){return r[n.indexOf(e)]},set:function(e,t){-1===n.indexOf(e)&&(n.push(e),r.push(t))},delete:function(e){var t=n.indexOf(e);t>-1&&(n.splice(t,1),r.splice(t,1))}}),a=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(e){a=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}function i(e){if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!o.has(e)){var t,n=null,r=null,i=null,c=function(){e.clientWidth!==r&&u()},s=function(t){window.removeEventListener("resize",c,!1),e.removeEventListener("input",u,!1),e.removeEventListener("keyup",u,!1),e.removeEventListener("autosize:destroy",s,!1),e.removeEventListener("autosize:update",u,!1),Object.keys(t).forEach((function(n){e.style[n]=t[n]})),o.delete(e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",s,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",u,!1),window.addEventListener("resize",c,!1),e.addEventListener("input",u,!1),e.addEventListener("autosize:update",u,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",o.set(e,{destroy:s,update:u}),"vertical"===(t=window.getComputedStyle(e,null)).resize?e.style.resize="none":"both"===t.resize&&(e.style.resize="horizontal"),n="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(n)&&(n=0),u()}function l(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,e.style.overflowY=t}function d(){if(0!==e.scrollHeight){var t=function(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}(e),o=document.documentElement&&document.documentElement.scrollTop;e.style.height="",e.style.height=e.scrollHeight+n+"px",r=e.clientWidth,t.forEach((function(e){e.node.scrollTop=e.scrollTop})),o&&(document.documentElement.scrollTop=o)}}function u(){d();var t=Math.round(parseFloat(e.style.height)),n=window.getComputedStyle(e,null),r="content-box"===n.boxSizing?Math.round(parseFloat(n.height)):e.offsetHeight;if(r<t?"hidden"===n.overflowY&&(l("scroll"),d(),r="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight):"hidden"!==n.overflowY&&(l("hidden"),d(),r="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight),i!==r){i=r;var o=a("autosize:resized");try{e.dispatchEvent(o)}catch(e){}}}}function c(e){var t=o.get(e);t&&t.destroy()}function s(e){var t=o.get(e);t&&t.update()}var l=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((l=function(e){return e}).destroy=function(e){return e},l.update=function(e){return e}):((l=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],(function(e){return i(e)})),e}).destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],c),e},l.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],s),e}),t.default=l,e.exports=t.default})?r.apply(t,o):r)||(e.exports=a)},398:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n(25);function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o{constructor(e,t){r(this,"$activity",void 0),r(this,"$selector",void 0),r(this,"interactionFunctions",void 0),this.interactionFunctions=t,this.$activity=e}getUserAnswers(){return this.interactionFunctions.getUserAnswers(this.$selector)}showAnswers(e){this.interactionFunctions.showAnswers(this.$selector,e)}setInteractionMode(e,t){this.interactionFunctions.setInteractionMode(this.$selector,e,t)}getTeacherFeedback(){return this.interactionFunctions.getTeacherFeedback(this.$selector)}isComplete(){return!this.interactionFunctions.isComplete||this.interactionFunctions.isComplete(this.$selector)}reset(){this.interactionFunctions.reset&&this.interactionFunctions.reset(this.$selector)}}},686:function(e,t,n){"use strict";n.r(t);n(6),n(11);var r=n(5),o=n.n(r);var a=e=>e.closest('[data-rcfinteraction="writing"]'),i=n(17);var c=e=>"y"===Object(i.a)(e,"data-showCharacterCount");n(354);var s=e=>Number(Object(i.a)(e,"data-maxCharacters")||0);var l=e=>e.find(".charactersCounter");var d=e=>{const t=a(e),n=e.parent().get(0),r=s(t),o=l(t),i=e.get(0).value.length,c=parseInt(i/r*100),d=c>100?"100":"".concat(c).padStart(3,"0");n.className="studentInteractions maxCharPercentageValue_".concat(d),o.text("".concat(i," / ").concat(r))};var u=e=>{const t=a(e),n=e.get(0),r=c(t),o=n.value.length;e.toggleClass("populated",o>0),r&&d(e)};var v=n(403);var f=e=>{const t=e.$activity.find('[data-rcfinteraction="writing"]');e.$selector=t;const n=t.find("textarea.rcfTextArea");Object(v.a)(n),e.$activity.on("input keyup change paste",".writing.rcfTextArea",e=>{u(o()(e.currentTarget))})},p=(n(48),n(4)),h=n(8);function m(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.find(".writing.rcfTextArea"),r=e.find(".teacherScoreInput").val()||void 0,a=e.find(".teacherInteractionCommentTextArea").val()||"",c=e.find(".reviewStudentAnswer");let s={elm:Object(p.v)(e)||"",type:h.a.openGradableWriting,markType:h.d.byFeedback,max_score:Object(i.a)(e,"data-maxscore")||"",value:{user:{value:n.val()||""}}},l={comment:a,comments:c.find(".teacherComment").map((e,t)=>{const n=o()(t);return{elm:Object(i.a)(n,"data-wordid")||"",text:n.text()}}).get()};return(r||0===r)&&(l.score=Number(r)),t&&(s.value.teacher=l),s}var w=n(70);function g(e){return Object(p.i)(e).hasClass(w.a.answerKeyMode)?[]:e.map((e,t)=>m(o()(t))).get()}var b=n(465),y=n(466);n(59),n(100);var x=e=>{e.each((e,t)=>{const n=o()(t),r=n.attr("data-presetAnswer")||"";r.length>0&&n.val(r.replace(/\|/g,"\n"))})};n(15),n(16);var C=n(353);var O=e=>{const t=e.$interaction,n=e.value.user&&e.value.user.value||"",r=t.find(".writing.rcfTextArea");r.val(n),r.toggleClass("populated",n.length>0),r.trigger("autosize.resize"),d(r)};function j(e,t){const n=Object(p.i)(e),r=t.id,o=n.attr("id");if(r!==o)throw"Invalid JSON answers provided for activity ["+o+"]";Object(C.a)(e,t).forEach(e=>O(e))}var E=n(473),T=n(463),F=n(464);n(102);var k=e=>"y"===e.attr("data-disableopengradableteachercomments");var S=e=>e.find(".reviewStudentAnswer p");var A=e=>Object(p.h)(e).replace(/\n/g," <br/> ").match(/\s*(\S+)\s*/g);var z=(e,t)=>{e.find('.studentWord[data-wordid="'.concat(t.elm,'"]')).addClass("commented").append('<span class="teacherComment" data-wordid="'.concat(t.elm,'">').concat(Object(p.h)(t.text),"</span>"))};var I=(e,t)=>{var n;const r=(null==t||null===(n=t.value)||void 0===n||null===(n=n.teacher)||void 0===n?void 0:n.comments)||[];r.length<1||r.forEach(t=>{z(e,t)})};var W=(e,t)=>{var n;const r=Object(p.i)(e),o=k(r),a=S(e);let i=0,c=(null==t||null===(n=t.value)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.value)||"";c=c.length>0?A(c):[];const s=c?c.map(e=>{let t;if(e.indexOf("<br")<0){const n=e.indexOf(" ")>-1;n&&(e=e.trim()),t='<span class="eSpan selectable studentWord" data-wordid="word_'.concat(++i,'"><span class="item">').concat(e,"</span></span>").concat(n?" ":"")}else t="<br>";return t}).join(""):"";a.html(s),o||I(e,t)};function N(e,t){const{$interaction:n}=e;Object(T.a)(n,e),Object(F.a)(n,e,t),W(n,e)}var P=n(421),$=n(521);function M(e){const t=e.find(".teacherFeedbackInteractions"),n=t.find(".reviewPopupPrompt");t.removeClass("leavingInlineComment"),n.removeClass("above below"),n.off("click",".okButton"),n.off("click",".cancelButton"),n.find(".reviewPopupText.text").off("keyup"),e.find(".reviewStudentAnswer .studentWord.selected").removeClass("selected"),Object($.a)(e)}var L=n(469),B=n(560);var H=e=>e.find(".teacherFeedbackInteractions .reviewPopupPrompt .reviewPopupText.text").val().toString();var R=(e,t)=>{e.find('.reviewStudentAnswer .teacherComment[data-wordid="'.concat(t,'"]')).remove()};var Y=e=>{const t=a(e),n=H(t),r=e.attr("data-wordid");if(R(t,r),e.removeClass("commented"),n.length<1)return;z(t,{elm:r,text:n})};var _=e=>{e.closest(".reviewStudentAnswer").find("span.studentWord.selected").removeClass("selected"),e.addClass("selected"),function(e){var t=e.closest(".teacherFeedbackInteractions"),n=e.find(".teacherComment"),r=t.closest(".activity"),o=t.find(".reviewPopupPrompt"),a="";n.length>0&&(a=n.text()),t.addClass("leavingInlineComment"),o.position({my:"left top",at:"left bottom",of:e});var i=parseInt(o.css("left")),c=parseInt(o.css("width"));i+c>parseInt(r.css("width"))+c/2&&o.position({my:"right top",at:"left bottom",of:e});var s,l=o.position(),d=e.position();s=l.top<d.top?"above":"below",o.addClass(s).find(".reviewPopupText").val(a).focus(),Object(B.a)(r)}(e),function(e){const t=e.closest(".teacherFeedbackInteractions"),n=t.find(".reviewPopupPrompt"),r=Object(p.i)(e);t.addClass("leavingInlineComment"),n.on("click",".okButton",()=>{Y(e),M(r)}),n.on("click",".cancelButton",()=>{M(r)})}(e)};var X=e=>{Object(p.i)(e).off("click","span.studentWord")};n(180);var G=e=>{const t=g(e);if(0===t.length)return!1;return t.every(e=>{var t;return(null==e||null===(t=e.value)||void 0===t||null===(t=t.user)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.length)>0})};var U={getUserAnswers:g,showAnswers:j,setInteractionMode:function(e,t,n){switch(t){case w.a.default:return void j(e,n);case w.a.leaveTeacherFeedback:return void Object(E.a)(e,t,n,j,N,()=>{!function(e){const t=Object(p.i)(e);if(!k(t)){const e=Object(P.a)(t);t.off("click","span.studentWord").on("click","span.studentWord",e=>{const t=o()(e.currentTarget);_(t)}),e.on("click",(function(){Object($.a)(t),M(t)}))}Object(L.a)(e)}(e)});case w.a.reviewTeacherFeedback:return void Object(E.a)(e,t,n,j,N,()=>{X(e)})}},getTeacherFeedback:function(e){return e.map((e,t)=>m(o()(t),!0)).get()},isComplete:G,reset:function(e){e.each((e,t)=>{!function(e){const t=Object(b.a)(e),n=e.find(".scoreResult"),r=e.find(".teacherScoreInput"),o=e.find(".reviewStudentAnswer p"),a=e.find(".reviewTeacherInteractionComment"),i=e.find(".noComment");n.text(0),r.val(""),Object(y.a)(t),x(t),o.html(""),a.html(""),i.removeClass("noComment")}(o()(t))})}},V=n(398);n.d(t,"default",(function(){return J}));class J extends V.a{constructor(e){super(e,U),f(this)}}}}]);
/* build created on 15/08/2025 16:19 */
//# sourceMappingURL=http://localhost:4000/source-maps/interactions/openGradable/rcfOpenGradableWriting.js.map