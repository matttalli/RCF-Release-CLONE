(window.rcfRunTime_24113=window.rcfRunTime_24113||[]).push([["interactions/marked/rcfMatching"],{335:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(25);var i=n(339);function o(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class r{constructor(t,e){o(this,"$activity",void 0),o(this,"$selector",void 0),o(this,"interactionFunctions",void 0),this.$activity=t,this.interactionFunctions=e}clearMarkedAnswers(){Object(i.a)(this.$selector)}getUserAnswers(t){return Object(i.b)(this,this.interactionFunctions.getUserAnswer,t)}isComplete(t){return Object(i.c)(this,this.interactionFunctions.isComplete,t)}showAnswers(t,e,n){Object(i.d)(this,t,e,this.interactionFunctions.showAnswer,n)}showMarkedAnswers(t,e){Object(i.e)(this,t,this.interactionFunctions.showMarkedAnswer,e)}showUserAnswers(t){Object(i.f)(this,this.interactionFunctions.showAnswer,t)}reset(){this.interactionFunctions.reset(this.$selector)}}},337:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));n(6),n(13);var i=n(5),o=n.n(i),r=n(4);function s(t,e){return Object(r.y)(e)?o()([]):t.filter((t,n)=>{let i=o()(n).closest(".itemBasedQuestion");return Object(r.v)(i)===e})}},476:function(t,e,n){var i,o;!function(r,s){"use strict";i=[n(477)],void 0===(o=function(t){return function(t,e){var n=t.jQuery,i=t.console;function o(t,e){for(var n in e)t[n]=e[n];return t}var r=Array.prototype.slice;function s(t,e,a){if(!(this instanceof s))return new s(t,e,a);var l,c=t;("string"==typeof t&&(c=document.querySelectorAll(t)),c)?(this.elements=(l=c,Array.isArray(l)?l:"object"==typeof l&&"number"==typeof l.length?r.call(l):[l]),this.options=o({},this.options),"function"==typeof e?a=e:o(this.options,e),a&&this.on("always",a),this.getImages(),n&&(this.jqDeferred=new n.Deferred),setTimeout(this.check.bind(this))):i.error("Bad element for imagesLoaded "+(c||t))}s.prototype=Object.create(e.prototype),s.prototype.options={},s.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},s.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),!0===this.options.background&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&a[e]){for(var n=t.querySelectorAll("img"),i=0;i<n.length;i++){var o=n[i];this.addImage(o)}if("string"==typeof this.options.background){var r=t.querySelectorAll(this.options.background);for(i=0;i<r.length;i++){var s=r[i];this.addElementBackgroundImages(s)}}}};var a={1:!0,9:!0,11:!0};function l(t){this.img=t}function c(t,e){this.url=t,this.element=e,this.img=new Image}return s.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var n=/url\((['"])?(.*?)\1\)/gi,i=n.exec(e.backgroundImage);null!==i;){var o=i&&i[2];o&&this.addBackground(o,t),i=n.exec(e.backgroundImage)}},s.prototype.addImage=function(t){var e=new l(t);this.images.push(e)},s.prototype.addBackground=function(t,e){var n=new c(t,e);this.images.push(n)},s.prototype.check=function(){var t=this;function e(e,n,i){setTimeout((function(){t.progress(e,n,i)}))}this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?this.images.forEach((function(t){t.once("progress",e),t.check()})):this.complete()},s.prototype.progress=function(t,e,n){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&i&&i.log("progress: "+n,t,e)},s.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},l.prototype=Object.create(e.prototype),l.prototype.check=function(){this.getIsImageComplete()?this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.src)},l.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},l.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},l.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},l.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},l.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},l.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},c.prototype=Object.create(l.prototype),c.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},c.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},c.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},s.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((n=e).fn.imagesLoaded=function(t,e){return new s(this,t,e).jqDeferred.promise(n(this))})},s.makeJQueryPlugin(),s}(r,t)}.apply(e,i))||(t.exports=o)}("undefined"!=typeof window?window:this)},477:function(t,e,n){var i,o;"undefined"!=typeof window&&window,void 0===(o="function"==typeof(i=function(){"use strict";function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var n=this._events=this._events||{},i=n[t]=n[t]||[];return-1==i.indexOf(e)&&i.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var n=this._onceEvents=this._onceEvents||{};return(n[t]=n[t]||{})[e]=!0,this}},e.off=function(t,e){var n=this._events&&this._events[t];if(n&&n.length){var i=n.indexOf(e);return-1!=i&&n.splice(i,1),this}},e.emitEvent=function(t,e){var n=this._events&&this._events[t];if(n&&n.length){n=n.slice(0),e=e||[];for(var i=this._onceEvents&&this._onceEvents[t],o=0;o<n.length;o++){var r=n[o];i&&i[r]&&(this.off(t,r),delete i[r]),r.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t})?i.call(e,n,e,t):i)||(t.exports=o)},680:function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"showAnswer",(function(){return is})),n.d(i,"showMarkedAnswer",(function(){return as})),n.d(i,"getUserAnswer",(function(){return ds})),n.d(i,"isComplete",(function(){return ps})),n.d(i,"reset",(function(){return gs}));n(31),n(6),n(13),n(15),n(16);var o=n(5),r=n.n(o);function s(t,e,n){return"*"===t||(t.length>0?-1!==t.indexOf(e):!n)}function a(t,e,n){var i,o=t=t||{},r=e=e||{};if(n)for(i=0;i<n.length;i++)o[n[i]]=r[n[i]];else for(i in r)o[i]=r[i];return t}function l(t){return"[object Number]"===Object.prototype.toString.call(t)}function c(t){return"string"==typeof t}function u(t){return"boolean"==typeof t}function h(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function d(t){return"[object Function]"===Object.prototype.toString.call(t)}function p(t){if(c(t))return""+t;if(u(t))return!!t;if(r=t,"[object Date]"===Object.prototype.toString.call(r))return new Date(t.getTime());if(d(t))return t;if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(p(t[n]));return e}if(h(t)){var i={};for(var o in t)i[o]=p(t[o]);return i}return t;var r}function f(t,e,n,i){var o,r,s={},a={};for(n=n||[],i=i||[],r=0;r<n.length;r++)s[n[r]]=!0;for(r=0;r<i.length;r++)a[i[r]]=!0;var f=p(t);for(r in e)if(null==f[r]||a[r])f[r]=e[r];else if(s[r])(o=[]).push.apply(o,Array.isArray(f[r])?f[r]:[f[r]]),o.push(e[r]),f[r]=o;else if(c(e[r])||u(e[r])||d(e[r])||l(e[r]))f[r]=e[r];else if(Array.isArray(e[r]))o=[],Array.isArray(f[r])&&o.push.apply(o,f[r]),o.push.apply(o,e[r]),f[r]=o;else if(h(e[r]))for(var v in h(f[r])||(f[r]={}),e[r])f[r][v]=e[r][v];return f}function v(t,e,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===e)return o}return t}function y(t,e,n,i){return function t(o){if(null!=o){if(c(o))return function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=e[n[i].substring(2,n[i].length-1)]||"";null!=o&&(t=t.replace(n[i],o))}if(null!=(n=t.match(/({{.*?}})/g)))for(var r=0;r<n.length;r++){var s=e[n[r].substring(2,n[r].length-2)]||"";null!=s&&(t=t.replace(n[r],s))}return t}(o);if(!d(o)||i||null!=n&&0!==(o.name||"").indexOf(n)){if(Array.isArray(o)){for(var r=[],s=0;s<o.length;s++)r.push(t(o[s]));return r}if(h(o)){var a={};for(var l in o)a[l]=t(o[l]);return a}return o}return o(e)}}(t)}function g(t,e){if(!t)return null;for(var n=0;n<t.length;n++)e(t[n])}function m(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function _(t,e){var n=m(t,e);return-1===n?null:t[n]}function x(t,e){var n=null;return t.forEach((function(t){e(t)&&(n=t)})),n}function k(t,e){var n=m(t,e);return n>-1&&t.splice(n,1),-1!==n}function b(t){if(null!=Array.fromArray)return Array.from(t);var e=[];return Array.prototype.push.apply(e,t),e}function C(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),-1!==n}function E(t,e,n,i){var o=t[e];return null==o&&(o=[],t[e]=o),o[i?"unshift":"push"](n),o}function P(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)}for(var w=[],S=0;S<256;S++)w[S]=(S<16?"0":"")+S.toString(16);function j(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return w[255&t]+w[t>>8&255]+w[t>>16&255]+w[t>>24&255]+"-"+w[255&e]+w[e>>8&255]+"-"+w[e>>16&15|64]+w[e>>24&255]+"-"+w[63&n|128]+w[n>>8&255]+"-"+w[n>>16&255]+w[n>>24&255]+w[255&i]+w[i>>8&255]+w[i>>16&255]+w[i>>24&255]}function A(t,e,n){var i=t.x-e.x,o=t.y-e.y,r=Math.cos(n/360*Math.PI*2),s=Math.sin(n/360*Math.PI*2);return{x:i*r-o*s+e.x,y:o*r+i*s+e.y,cr:r,sr:s}}function M(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;n.test(e.charAt(--i)););return e.slice(0,i+1)}function D(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i]));return n}function T(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(t){}}function I(t){return t<0?-1:t>0?1:0}function O(t,e,n){return function(){var i=null;try{null!=e&&(i=e.apply(this,arguments))}catch(t){T("jsPlumb function failed : "+t)}if(null!=t&&(null==n||i!==n))try{i=t.apply(this,arguments)}catch(t){T("wrapped function failed : "+t)}return i}}function G(t,e,n){return t.has(e)||t.set(e,n()),t.get(e)}function L(t,e){for(var n=t.__proto__;null!=n;){if(n instanceof e)return!0;n=n.__proto__}return!1}function F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function R(t,e,n){return e&&B(t.prototype,e),n&&B(t,n),t}function H(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function N(t){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function z(t,e){return(z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function V(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=N(t);if(e){var o=N(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return V(this,n)}}var X,Y,U=function(){function t(){F(this,t),H(this,"_listeners",{}),H(this,"eventsSuspended",!1),H(this,"tick",!1),H(this,"eventsToDieOn",{ready:!0}),H(this,"queue",[])}return R(t,[{key:"fire",value:function(t,e,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var o=this._listeners[t].length,r=0,s=!1;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n))for(;!s&&r<o&&!1!==i;){if(this.eventsToDieOn[t])this._listeners[t][r].apply(this,[e,n]);else try{i=this._listeners[t][r].apply(this,[e,n])}catch(e){T("jsPlumb: fire failed for event "+t+" : "+(e.message||e))}r++,null!=this._listeners&&null!=this._listeners[t]||(s=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var t=this.queue.pop();t&&this.fire.apply(this,t)}},{key:"unbind",value:function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n;for(var i in t.__jsPlumb)n=t.__jsPlumb[i],C(this._listeners[n]||[],t)}}else 2===arguments.length&&C(this._listeners[t]||[],e);return this}},{key:"getListener",value:function(t){return this._listeners[t]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(t){this.eventsSuspended=t}},{key:"bind",value:function(t,e,n){var i=this,o=function(t){E(i._listeners,t,e,n),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[j()]=t};if("string"==typeof t)o(t);else if(null!=t.length)for(var r=0;r<t.length;r++)o(t[r]);return this}},{key:"silently",value:function(t){this.setSuspendEvents(!0);try{t()}catch(t){T("Cannot execute silent function "+t)}this.setSuspendEvents(!1)}}]),t}(),q=(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(n,t);var e=W(n);function n(){return F(this,n),e.apply(this,arguments)}R(n,[{key:"shouldFireEvent",value:function(t,e,n){return!0}}])}(U),[null,[1,-1],[1,1],[-1,1],[-1,-1]]),Z=[null,[-1,-1],[-1,1],[1,1],[1,-1]],J=2*Math.PI;function $(t,e){return e.x===t.x?e.y>t.y?1/0:-1/0:e.y===t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)}function Q(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function K(t,e){return e.x>t.x||e.x==t.x?e.y>t.y?2:1:e.y>t.y?3:4}function tt(t,e){var n=t.x,i=t.x+t.w,o=t.y,r=t.y+t.h,s=e.x,a=e.x+e.w,l=e.y,c=e.y+e.h;return n<=s&&s<=i&&o<=l&&l<=r||n<=a&&a<=i&&o<=l&&l<=r||n<=s&&s<=i&&o<=c&&c<=r||n<=a&&s<=i&&o<=c&&c<=r||s<=n&&n<=a&&l<=o&&o<=c||s<=i&&i<=a&&l<=o&&o<=c||s<=n&&n<=a&&l<=r&&r<=c||s<=i&&n<=a&&l<=r&&r<=c}function et(t,e,n){var i=$(t,e),o=K(t,e),r=n>0?q[o]:Z[o],s=Math.atan(i),a=Math.abs(n*Math.sin(s))*r[1],l=Math.abs(n*Math.cos(s))*r[0];return{x:t.x+l,y:t.y+a}}function nt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function it(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.Circle="Circle",t.Ellipse="Ellipse",t.Triangle="Triangle",t.Diamond="Diamond",t.Rectangle="Rectangle",t.Square="Square"}(X||(X={})),function(t){t.Assign="Assign",t.AutoDefault="AutoDefault",t.Bottom="Bottom",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight",t.Center="Center",t.Continuous="Continuous",t.ContinuousBottom="ContinuousBottom",t.ContinuousLeft="ContinuousLeft",t.ContinuousRight="ContinuousRight",t.ContinuousTop="ContinuousTop",t.ContinuousLeftRight="ContinuousLeftRight",t.ContinuousTopBottom="ContinuousTopBottom",t.Left="Left",t.Perimeter="Perimeter",t.Right="Right",t.Top="Top",t.TopLeft="TopLeft",t.TopRight="TopRight"}(Y||(Y={}));var ot=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e,it(this,"x1",void 0),it(this,"x2",void 0),it(this,"y1",void 0),it(this,"y2",void 0),it(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),it(this,"type",void 0),this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}var e,n,i;return e=t,(n=[{key:"findClosestPointOnPath",value:function(t,e){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return[]}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}},{key:"boundingBoxIntersection",value:function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}}])&&nt(e.prototype,n),i&&nt(e,i),t}(),rt="default";function st(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function lt(t,e,n){return e&&at(t.prototype,e),n&&at(t,n),t}function ct(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ut(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dt(t,e)}function ht(t){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function dt(t,e){return(dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function pt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ft(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?pt(t):e}function vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=ht(t);if(e){var o=ht(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ft(this,n)}}function yt(t,e,n){return(yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ht(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function gt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}(t,e)||_t(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(t){return function(t){if(Array.isArray(t))return xt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_t(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _t(t,e){if(t){if("string"==typeof t)return xt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xt(t,e):void 0}}function xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var kt={},bt={},Ct={},Et={get:function(t,e,n){var i=kt[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown endpoint type '"+e+"'"}},clone:function(t){var e=Ct[t.type];return Et.get(t.endpoint,t.type,e.getParams(t))},compute:function(t,e,n,i){var o=bt[t.type];if(null!=o)return o(t,e,n,i);T("jsPlumb: cannot find endpoint calculator for endpoint of type ",t.type)},registerHandler:function(t){Ct[t.type]=t,kt[t.type]=t.cls,bt[t.type]=t.compute}},Pt=function(){function t(e,n){st(this,t),this.endpoint=e,ct(this,"typeId",void 0),ct(this,"x",void 0),ct(this,"y",void 0),ct(this,"w",void 0),ct(this,"h",void 0),ct(this,"computedValue",void 0),ct(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),ct(this,"classes",[]),ct(this,"instance",void 0),ct(this,"type",void 0),n=n||{},this.instance=e.instance,e.cssClass&&this.classes.push(e.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return lt(t,[{key:"addClass",value:function(t){this.classes.push(t),this.instance.addEndpointClass(this.endpoint,t)}},{key:"removeClass",value:function(t){this.classes=this.classes.filter((function(e){return e!==t})),this.instance.removeEndpointClass(this.endpoint,t)}},{key:"compute",value:function(t,e,n){this.computedValue=Et.compute(this,t,e,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(t){this.instance.setEndpointVisible(this.endpoint,t)}}]),t}(),wt=function(t){ut(n,t);var e=vt(n);function n(t,i){var o;return st(this,n),ct(pt(o=e.call(this,t,i)),"radius",void 0),ct(pt(o),"defaultOffset",void 0),ct(pt(o),"defaultInnerRadius",void 0),ct(pt(o),"type",n.type),i=i||{},o.radius=i.radius||5,o.defaultOffset=.5*o.radius,o.defaultInnerRadius=o.radius/3,o}return n}(Pt);ct(wt,"type","Dot");var St={type:wt.type,cls:wt,compute:function(t,e,n,i){var o=e.curX-t.radius,r=e.curY-t.radius,s=2*t.radius,a=2*t.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,r-=l,s+=2*l,a+=2*l}return t.x=o,t.y=r,t.w=s,t.h=a,[o,r,s,a,t.radius]},getParams:function(t){return{radius:t.radius}}},jt=function(t){ut(n,t);var e=vt(n);function n(t,i){var o;return st(this,n),ct(pt(o=e.call(this,t,i)),"type",n.type),o}return n}(Pt);ct(jt,"type","Blank");var At={type:jt.type,cls:jt,compute:function(t,e,n,i){return t.x=e.curX,t.y=e.curY,t.w=10,t.h=0,[e.curX,e.curY,10,0]},getParams:function(t){return{}}},Mt=function(t){ut(n,t);var e=vt(n);function n(t,i){var o;return st(this,n),ct(pt(o=e.call(this,t,i)),"width",void 0),ct(pt(o),"height",void 0),ct(pt(o),"type",n.type),i=i||{},o.width=i.width||10,o.height=i.height||10,o}return lt(n,null,[{key:"_getParams",value:function(t){return{width:t.width,height:t.height}}}]),n}(Pt);ct(Mt,"type","Rectangle");var Dt={type:Mt.type,cls:Mt,compute:function(t,e,n,i){var o=i.width||t.width,r=i.height||t.height,s=e.curX-o/2,a=e.curY-r/2;return t.x=s,t.y=a,t.w=o,t.h=r,[s,a,o,r]},getParams:function(t){return{width:t.width,height:t.height}}},Tt=function(){function t(e,n){st(this,t),this.connection=e,ct(this,"type",void 0),ct(this,"edited",!1),ct(this,"stub",void 0),ct(this,"sourceStub",void 0),ct(this,"targetStub",void 0),ct(this,"maxStub",void 0),ct(this,"typeId",void 0),ct(this,"gap",void 0),ct(this,"sourceGap",void 0),ct(this,"targetGap",void 0),ct(this,"segments",[]),ct(this,"totalLength",0),ct(this,"segmentProportions",[]),ct(this,"segmentProportionalLengths",[]),ct(this,"paintInfo",null),ct(this,"strokeWidth",void 0),ct(this,"x",void 0),ct(this,"y",void 0),ct(this,"w",void 0),ct(this,"h",void 0),ct(this,"segment",void 0),ct(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),ct(this,"cssClass",void 0),ct(this,"hoverClass",void 0),ct(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return lt(t,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(t,e){this.geometry=t,this.edited=null!=t&&!e}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(t){return this.geometry=t,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(t,e,n){return{x:t.x,y:t.y,ox:t.ox,oy:t.oy,curX:t.curX+e,curY:t.curY+n}}},{key:"resetBounds",value:function(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(t,e);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(t,e,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].lineIntersection(t,e,n,i));return o}},{key:"boxIntersection",value:function(t,e,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].boxIntersection(t,e,n,i));return o}},{key:"boundingBoxIntersection",value:function(t){for(var e=[],n=0;n<this.segments.length;n++)e.push.apply(e,this.segments[n].boundingBoxIntersection(t));return e}},{key:"_updateSegmentProportions",value:function(){for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e].getLength();this.segmentProportionalLengths[e]=n/this.totalLength,this.segmentProportions[e]=[t,t+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(t,e){var n,i,o;if(e&&(t=t>0?t/this.totalLength:(this.totalLength+t)/this.totalLength),1===t)n=this.segments.length-1,o=1;else if(0===t)o=0,n=0;else if(t>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=t&&this.segmentProportions[i][0]<=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(t,e){if(e.x1!==e.x2||e.y1!==e.y2){var n=new t(e);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(t){this.strokeWidth=t.strokeWidth;var e=t.sourcePos.curX,n=t.targetPos.curX,i=t.sourcePos.curY,o=t.targetPos.curY,r=K({x:e,y:i},{x:n,y:o}),s=n<e,a=o<i,l=[t.sourcePos.ox,t.sourcePos.oy],c=[t.targetPos.ox,t.targetPos.oy],u=s?n:e,h=a?o:i,d=Math.abs(n-e),p=Math.abs(o-i),f=0===l[0]&&0===l[1],v=0===c[0]&&0===c[1];if(f||v){var y=d>p?0:1,g=[1,0][y],m=0===y?e:i,_=0===y?n:o;f&&(l[y]=m>_?-1:1,l[g]=0),v&&(c[y]=m>_?1:-1,c[g]=0)}var x=s?d+this.sourceGap*l[0]:this.sourceGap*l[0],k=a?p+this.sourceGap*l[1]:this.sourceGap*l[1],b=s?this.targetGap*c[0]:d+this.targetGap*c[0],C=a?this.targetGap*c[1]:p+this.targetGap*c[1],E=l[0]*c[0]+l[1]*c[1],P={sx:x,sy:k,tx:b,ty:C,xSpan:Math.abs(b-x),ySpan:Math.abs(C-k),mx:(x+b)/2,my:(k+C)/2,so:l,to:c,x:u,y:h,w:d,h:p,segment:r,startStubX:x+l[0]*this.sourceStub,startStubY:k+l[1]*this.sourceStub,endStubX:b+c[0]*this.targetStub,endStubY:C+c[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(x-b)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(k-C)>this.sourceStub+this.targetStub,opposite:-1===E,perpendicular:0===E,orthogonal:1===E,sourceAxis:0===l[0]?"y":"x",points:[u,h,d,p,x,k,b,C],stubs:[this.sourceStub,this.targetStub]};return P.anchorOrientation=P.opposite?"opposite":P.orthogonal?"orthogonal":"perpendicular",P}},{key:"updateBounds",value:function(t){var e=t.extents;this.bounds.xmin=Math.min(this.bounds.xmin,e.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,e.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,e.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,e.ymax)}},{key:"dumpSegmentsToConsole",value:function(){T("SEGMENTS:");for(var t=0;t<this.segments.length;t++)T(this.segments[t].type,""+this.segments[t].getLength(),""+this.segmentProportions[t])}},{key:"pointOnPath",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this._findSegmentForLocation(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,!1)||{x:0,y:0}}},{key:"compute",value:function(t){this.paintInfo=this._prepareCompute(t),this._clearSegments(),this._compute(this.paintInfo,t),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(t,e){}}]),t}(),It=function(t){ut(n,t);var e=vt(n);function n(t){var i;return st(this,n),ct(pt(i=e.call(this,t)),"length",void 0),ct(pt(i),"m",void 0),ct(pt(i),"m2",void 0),ct(pt(i),"type",n.segmentType),i._setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),i}return lt(n,[{key:"getPath",value:function(t){return(t?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=$({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this._recalc()}},{key:"pointOnPath",value:function(t,e){if(0!==t||e){if(1!==t||e){var n=e?t>0?t:this.length+t:t*this.length;return et({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(t,e){return this.m}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return e<=0&&Math.abs(e)>1&&(e*=-1),et(i,o,e)}},{key:"within",value:function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)}},{key:"closest",value:function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e}},{key:"findClosestPointOnPath",value:function(t,e){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,t)?t:this.closest(this.x1,this.x2,t);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,e)?e:this.closest(this.y1,this.y2,e);else{var i=this.y1-this.m*this.x1,o=(e-this.m2*t-i)/(this.m-this.m2),r=this.m*o+i;n.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),n.y=this.within(this.y1,this.y2,r)?r:this.closest(this.y1,this.y2,r)}var s=Q({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=Q({x:t,y:e},n),n.l=s/length,n}},{key:"_pointLiesBetween",value:function(t,e,n){return n>e?e<=t&&t<=n:e>=t&&t>=n}},{key:"lineIntersection",value:function(t,e,n,i){var o=Math.abs($({x:t,y:e},{x:n,y:i})),r=Math.abs(this.m),s=r===1/0?this.x1:this.y1-r*this.x1,a=[],l=o===1/0?t:e-o*t;if(o!==r)if(o===1/0&&0===r)this._pointLiesBetween(t,this.x1,this.x2)&&this._pointLiesBetween(this.y1,e,i)&&a.push({x:t,y:this.y1});else if(0===o&&r===1/0)this._pointLiesBetween(e,this.y1,this.y2)&&this._pointLiesBetween(this.x1,t,n)&&a.push({x:this.x1,y:e});else{var c,u;o===1/0?(c=t,this._pointLiesBetween(c,this.x1,this.x2)&&(u=r*t+s,this._pointLiesBetween(u,e,i)&&a.push({x:c,y:u}))):0===o?(u=e,this._pointLiesBetween(u,this.y1,this.y2)&&(c=(e-s)/r,this._pointLiesBetween(c,t,n)&&a.push({x:c,y:u}))):(u=r*(c=(l-s)/(r-o))+s,this._pointLiesBetween(c,this.x1,this.x2)&&this._pointLiesBetween(u,this.y1,this.y2)&&a.push({x:c,y:u}))}return a}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}}]),n}(ot);ct(It,"segmentType","Straight");var Ot=function(t){ut(n,t);var e=vt(n);function n(){var t;st(this,n);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return ct(pt(t=e.call.apply(e,[this].concat(o))),"type",n.type),t}return lt(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){this._addSegment(It,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),this._addSegment(It,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),this._addSegment(It,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty}),this.geometry={source:e.sourcePos,target:e.targetPos}}},{key:"transformGeometry",value:function(t,e,n){return{source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}}]),n}(Tt);ct(Ot,"type","Straight");var Gt={},Lt=function(t,e,n){var i=Gt[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown connector type '"+e+"'"}},Ft=function(t,e){Gt[t]=e};function Bt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return"."+t})).join(",")}function Rt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return"["+t+"]"})).join(",")}var Ht="data-jtk-scope-",Nt="jtk-endpoint",zt="jtk-floating-endpoint",Vt=Rt("data-jtk-managed");function Wt(t){var e=null;return(e=c(t)?{type:t,options:{}}:t).options.id=e.options.id||j(),e}var Xt=function(t){ut(n,t);var e=vt(n);function n(t,i,o){var r;for(var s in st(this,n),(r=e.call(this)).instance=t,r.component=i,ct(pt(r),"id",void 0),ct(pt(r),"type",void 0),ct(pt(r),"cssClass",void 0),ct(pt(r),"visible",!0),ct(pt(r),"location",void 0),ct(pt(r),"events",void 0),ct(pt(r),"attributes",void 0),o=o||{},r.id=o.id||j(),r.cssClass=o.cssClass||"",r.setLocation(o.location),r.events=o.events||{},r.attributes=o.attributes||{},r.events)r.bind(s,r.events[s]);return r}return lt(n,[{key:"setLocation",value:function(t){var e=null==this.location?.5:this.location;if(null!=t)try{var n="string"==typeof t?parseFloat(t):t;isNaN(n)||(e=n)}catch(t){}this.location=e}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"setVisible",value:function(t){this.visible=t,this.instance.setOverlayVisible(this,t)}},{key:"isVisible",value:function(){return this.visible}}]),n}(U),Yt={},Ut=function(t,e,n,i){var o=Yt[e];if(o)return new o(t,n,i);throw{message:"jsPlumb: unknown overlay type '"+e+"'"}},qt=function(t,e){Yt[t]=e},Zt=function(t){ut(n,t);var e=vt(n);function n(t,i,o){var r;return st(this,n),(r=e.call(this,t,i,o)).instance=t,r.component=i,ct(pt(r),"label",void 0),ct(pt(r),"labelText",void 0),ct(pt(r),"type",n.type),ct(pt(r),"cachedDimensions",void 0),o=o||{label:""},r.setLabel(o.label),r}return lt(n,[{key:"getLabel",value:function(){return d(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(t){this.label=t,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(t){null!=t.label&&this.setLabel(t.label),null!=t.location&&(this.setLocation(t.location),this.instance.updateLabel(this))}}]),n}(Xt);function Jt(t){return t.type===Zt.type}function $t(t){return null==t?null:t.split(" ").filter((function(t){return null!=t&&t.length>0}))}function Qt(t,e,n){for(var i in e)t[i]=n}ct(Zt,"type","Label"),qt(Zt.type,Zt);function Kt(t,e){if(t.getDefaultType){var n=t.getTypeDescriptor(),i={},o=t.getDefaultType(),r=a({},o);Qt(i,o,"__default"),t._types.forEach((function(e){if("__default"!==e){var o=t.instance.getType(e,n);if(null!=o){var s=new Set(["connector","anchor","anchors"]);if("override"===o.mergeStrategy)for(var a in o)s.add(a);r=f(r,o,["cssClass"],(l=[],s.forEach((function(t){l.push(t)})),l)),Qt(i,o,e)}}var l})),e&&(r=y(r,e,"_")),t.applyType(r,i)}}function te(t,e){var n=t.instance.getType(e,t.getTypeDescriptor());null!=n&&n.cssClass&&t.removeClass(n.cssClass)}function ee(t){if(t.paintStyle&&t.hoverPaintStyle){var e={};a(e,t.paintStyle),a(e,t.hoverPaintStyle),t.hoverPaintStyle=e}}var ne,ie,oe,re,se=function(t){ut(n,t);var e=vt(n);function n(t,i){var o;if(st(this,n),(o=e.call(this)).instance=t,ct(pt(o),"defaultLabelLocation",.5),ct(pt(o),"overlays",{}),ct(pt(o),"overlayPositions",{}),ct(pt(o),"overlayPlacements",{}),ct(pt(o),"clone",void 0),ct(pt(o),"deleted",void 0),ct(pt(o),"segment",void 0),ct(pt(o),"x",void 0),ct(pt(o),"y",void 0),ct(pt(o),"w",void 0),ct(pt(o),"h",void 0),ct(pt(o),"id",void 0),ct(pt(o),"visible",!0),ct(pt(o),"typeId",void 0),ct(pt(o),"params",{}),ct(pt(o),"paintStyle",void 0),ct(pt(o),"hoverPaintStyle",void 0),ct(pt(o),"paintStyleInUse",void 0),ct(pt(o),"_hover",!1),ct(pt(o),"lastPaintedAt",void 0),ct(pt(o),"data",void 0),ct(pt(o),"_defaultType",void 0),ct(pt(o),"events",void 0),ct(pt(o),"parameters",void 0),ct(pt(o),"_types",void 0),ct(pt(o),"_typeCache",void 0),ct(pt(o),"cssClass",void 0),ct(pt(o),"hoverClass",void 0),ct(pt(o),"beforeDetach",void 0),ct(pt(o),"beforeDrop",void 0),i=i||{},o.cssClass=i.cssClass||"",o.hoverClass=i.hoverClass||t.defaults.hoverClass,o.beforeDetach=i.beforeDetach,o.beforeDrop=i.beforeDrop,o._types=new Set,o._typeCache={},o.parameters=p(i.parameters||{}),o.id=i.id||o.getIdPrefix()+(new Date).getTime(),o._defaultType={parameters:o.parameters,scope:i.scope||o.instance.defaultScope,overlays:{}},i.events)for(var r in i.events)o.bind(r,i.events[r]);o.clone=function(){var e=Object.create(o.constructor.prototype);return o.constructor.apply(e,[t,i]),e},o.overlays={},o.overlayPositions={};var s=i.overlays||[],a={},l=o.getDefaultOverlayKey();if(l){var c=o.instance.defaults[l];c&&s.push.apply(s,mt(c));for(var u=0;u<s.length;u++){var h=Wt(s[u]);a[h.options.id]=h}}return o._defaultType.overlays=a,i.label&&(o.getDefaultType().overlays.__label={type:Zt.type,options:{label:i.label,location:i.labelLocation||o.defaultLabelLocation,id:"__label",cssClass:"jtk-default-label"}}),o}return lt(n,[{key:"isDetachAllowed",value:function(t){var e=!0;if(this.beforeDetach)try{e=this.beforeDetach(t)}catch(t){T("jsPlumb: beforeDetach callback failed",t)}return e}},{key:"isDropAllowed",value:function(t,e,n,i,o){var r,s={sourceId:t,targetId:e,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{r=this.beforeDrop(s)}catch(t){T("jsPlumb: beforeDrop callback failed",t)}else r=this.instance.checkCondition("beforeDrop",s);return r}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(t){for(var e in t)this._defaultType[e]=t[e]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(t,e,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][t]=e}},{key:"getCachedTypeItem",value:function(t,e){return this._typeCache[e]?this._typeCache[e][t]:null}},{key:"setType",value:function(t,e){this.clearTypes(),($t(t)||[]).forEach(this._types.add,this._types),Kt(this,e)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(t){Kt(this,t)}},{key:"hasType",value:function(t){return this._types.has(t)}},{key:"addType",value:function(t,e){var n=$t(t),i=!1;if(null!=n){for(var o=0,r=n.length;o<r;o++)this._types.has(n[o])||(this._types.add(n[o]),i=!0);i&&Kt(this,e)}}},{key:"removeType",value:function(t,e){var n,i=this,o=$t(t),r=!1;if(null!=o){for(var s=0,a=o.length;s<a;s++)n=o[s],r=!!i._types.has(n)&&(te(i,n),i._types.delete(n),!0)||r;r&&Kt(this,e)}}},{key:"clearTypes",value:function(t){var e=this;this._types.forEach((function(t){te(e,t)})),this._types.clear(),Kt(this,t)}},{key:"toggleType",value:function(t,e){var n=$t(t);if(null!=n){for(var i=0,o=n.length;i<o;i++)this._types.has(n[i])?(te(this,n[i]),this._types.delete(n[i])):this._types.add(n[i]);Kt(this,e)}}},{key:"applyType",value:function(t,e){if(this.setPaintStyle(t.paintStyle),this.setHoverPaintStyle(t.hoverPaintStyle),this.mergeParameters(t.parameters),this.paintStyleInUse=this.getPaintStyle(),t.overlays){var n,i={};for(n in t.overlays){var o=this.overlays[t.overlays[n].options.id];if(o)o.updateFrom(t.overlays[n].options),i[t.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var r=this.getCachedTypeItem("overlay",t.overlays[n].options.id);null!=r?(this.instance.reattachOverlay(r,this),r.setVisible(!0),r.updateFrom(t.overlays[n].options),this.overlays[r.id]=r):r=this.addOverlay(t.overlays[n]),i[r.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(t){this.paintStyle=t,this.paintStyleInUse=this.paintStyle,ee(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(t){this.hoverPaintStyle=t,ee(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(t){null!=t&&a(this.parameters,t)}},{key:"setVisible",value:function(t){this.visible=t,t?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(t,e){this.overlayPositions[t.id]=e}},{key:"getAbsoluteOverlayPosition",value:function(t){return this.overlayPositions?this.overlayPositions[t.id]:null}},{key:"_clazzManip",value:function(t,e){for(var n in this.overlays)"add"===t?this.instance.addOverlayClass(this.overlays[n],e):"remove"===t&&this.instance.removeOverlayClass(this.overlays[n],e)}},{key:"addClass",value:function(t,e){var n=(this.cssClass||"").split(" ");n.push(t),this.cssClass=n.join(" "),this._clazzManip("add",t)}},{key:"removeClass",value:function(t,e){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter((function(e){return e!==t})).join(" "),this._clazzManip("remove",t)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(t){this.data=t||{}}},{key:"mergeData",value:function(t){this.data=a(this.data,t)}},{key:"addOverlay",value:function(t){var e=function(t,e){var n=null;if(c(e))n=Ut(t.instance,e,t,{});else if(null!=e.type&&null!=e.options){var i=e,o=a({},i.options);n=Ut(t.instance,i.type,t,o)}else n=e;return n.id=n.id||j(),t.cacheTypeItem("overlay",n,n.id),t.overlays[n.id]=n,n}(this,t);if(this.getData&&e.type===Zt.type&&!c(t)){var n=this.getData(),i=t.options;if(n){var o=n[i.labelLocationAttribute||"labelLocation"];o&&(e.location=o)}}return e}},{key:"getOverlay",value:function(t){return this.overlays[t]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)0!==e.length&&-1===e.indexOf(i)||this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!0)}},{key:"showOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)0!==e.length&&-1===e.indexOf(i)||this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(t,e){var n=this.overlays[t];n&&(n.setVisible(!1),e||this.instance.destroyOverlay(n),delete this.overlays[t],this.overlayPositions&&delete this.overlayPositions[t],this.overlayPlacements&&delete this.overlayPlacements[t])}},{key:"removeOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,o=e.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var t=this.getLabelOverlay();return null!=t?t.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay("__label")}},{key:"setLabel",value:function(t){var e,n,i,o=this.getLabelOverlay();if(o)if(c(t)||d(t))o.setLabel(t);else{var r=t;r.label&&o.setLabel(r.label),r.location&&(o.location=r.location)}else{var s=c(t)||d(t)?{label:t}:t;e=this,i=a({cssClass:(n=s).cssClass,id:"__label",component:e},n),o=new Zt(e.instance,e,i),this.overlays.__label=o}}}]),n}(U);!function(t){t.top="top",t.left="left",t.right="right",t.bottom="bottom"}(re||(re={}));var ae=re.top,le=re.left,ce=re.right,ue=re.bottom,he=[le,ce],de=[ae,ue],pe=function(){function t(e,n,i){st(this,t),this.instance=e,this.element=n,ct(this,"isFloating",!0),ct(this,"isContinuous",void 0),ct(this,"isDynamic",void 0),ct(this,"locations",[]),ct(this,"currentLocation",0),ct(this,"locked",!1),ct(this,"cssClass",""),ct(this,"timestamp",null),ct(this,"type","Floating"),ct(this,"id",j()),ct(this,"orientation",[0,0]),ct(this,"size",void 0),this.size=e.viewport.getPosition(i),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return lt(t,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(t){this.orientation=this.instance.router.getEndpointOrientation(t),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),t}(),fe=(ct(ne={},ae,ue),ct(ne,ce,le),ct(ne,le,ce),ct(ne,ue,ae),ne),ve=(ct(ie={},ae,ce),ct(ie,ce,ue),ct(ie,le,ae),ct(ie,ue,le),ie),ye=(ct(oe={},ae,le),ct(oe,ce,ae),ct(oe,le,ue),ct(oe,ue,ce),oe);function ge(t){return 0===t.faces.length?ae:t.faces[0]}function me(t,e){return-1!==t.faces.indexOf(e)}function _e(t,e){return null==t.lockedAxis?null==t.lockedFace?!0===me(t,e):t.lockedFace===e:-1!==t.lockedAxis.indexOf(e)}function xe(t,e){if(me(t,e))return e;if(me(t,fe[e]))return fe[e];var n=function(t,e){return(t.clockwise?ve:ye)[e]}(t,e);if(me(t,n))return n;var i=function(t,e){return(t.clockwise?ye:ve)[e]}(t,e);return me(t,i)?i:e}var ke={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},be={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Ce={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},Ee={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},Pe={Top:[ke],Bottom:[be],Left:[Ce],Right:[Ee],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[ke,Ce,be,Ee]},we={Continuous:{faces:[ae,le,ue,ce]},ContinuousTop:{faces:[ae]},ContinuousRight:{faces:[ce]},ContinuousBottom:{faces:[ue]},ContinuousLeft:{faces:[le]},ContinuousLeftRight:{faces:[le,ce]},ContinuousTopBottom:{faces:[ae,ue]}};function Se(t,e){if(e=e||{},t===Y.Perimeter)return function(t){var e=(t=t||{}).anchorCount||60,n=t.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");if(!Oe.has(n))throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var i=Oe.get(n)(e);t.rotation&&(i=function(t,e){for(var n=[],i=e/180*Math.PI,o=0;o<t.length;o++){var r=t[o].x-.5,s=t[o].y-.5;n.push({x:r*Math.cos(i)-s*Math.sin(i)+.5,y:r*Math.sin(i)+s*Math.cos(i)+.5,ox:t[o].ox,oy:t[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(i,t.rotation));return a(je(Y.Perimeter,i,t),{shape:n})}(e);var n=Pe[t];if(null!=n)return je(t,D(n,(function(t){return a({iox:t.ox,ioy:t.oy},t)})),e);if(null!=(n=we[t]))return function(t,e,n){var i={type:t,locations:[],currentLocation:0,locked:!1,id:j(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||e,lockedFace:null,lockedAxis:null,clockwise:!(!1===n.clockwise),__currentFace:null};return Object.defineProperty(i,"currentFace",{get:function(){return this.__currentFace},set:function(t){this.__currentFace=xe(this,t)}}),i}(t,n.faces,e);throw{message:"jsPlumb: unknown anchor type '"+t+"'"}}function je(t,e,n){return{type:t,locations:e,currentLocation:0,locked:!1,id:j(),isFloating:!1,isContinuous:!1,isDynamic:e.length>1,timestamp:null,cssClass:n.cssClass||""}}function Ae(t){return t.length<7&&t.every(l)||7===t.length&&t.slice(0,5).every(l)&&c(t[6])}function Me(t){if(c(t))return Se(t,null);if(Array.isArray(t)){if(Ae(t)){var e=t;return je(null,[{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}],{cssClass:e[6]||""})}return je("Dynamic",D(t,(function(t){if(c(t)){var e=Pe[t];return null!=e?a({iox:e[0].ox,ioy:e[0].oy,cls:""},e[0]):null}if(Ae(t))return{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}})).filter((function(t){return null!=t})),{})}var n=t;return Se(n.type,n.options)}function De(t){for(var e=.5,n=2*Math.PI/t,i=[],o=0,r=0;r<t;r++){var s=e+e*Math.sin(o),a=e+e*Math.cos(o);i.push({x:s,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),o+=n}return i}function Te(t,e){for(var n=[],i=0;i<t.length;i++)n.push([t[i][0],t[i][1],t[i][2],t[i][3],1/t.length,t[i][4],t[i][5]]);return function(t,e){for(var n=e/t.length,i=[],o=function(t,o,r,s,a,l,c){for(var u=(r-t)/(n=e*a),h=(s-o)/n,d=0;d<n;d++)i.push({x:t+u*d,y:o+h*d,ox:null==l?0:l,oy:null==c?0:c,offx:0,offy:0,iox:0,ioy:0,cls:""})},r=0;r<t.length;r++)o.apply(null,t[r]);return i}(n,e)}function Ie(t){return Te([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],t)}var Oe=new Map;Oe.set(X.Circle,De),Oe.set(X.Ellipse,De),Oe.set(X.Rectangle,Ie),Oe.set(X.Square,Ie),Oe.set(X.Diamond,(function(t){return Te([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],t)})),Oe.set(X.Triangle,(function(t){return Te([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],t)}));function Ge(t,e,n,i,o,r,s){var a;if(e)t.endpoints[n]=e,e.addConnection(t);else{var l=s||t.endpointSpec||t.endpointsSpec[n]||t.instance.defaults.endpoints[n]||t.instance.defaults.endpoint,c=t.endpointStyles[n]||t.endpointStyle||t.instance.defaults.endpointStyles[n]||t.instance.defaults.endpointStyle;null==c.fill&&null!=t.paintStyle&&(c.fill=t.paintStyle.stroke),null==c.outlineStroke&&null!=t.paintStyle&&(c.outlineStroke=t.paintStyle.outlineStroke),null==c.outlineWidth&&null!=t.paintStyle&&(c.outlineWidth=t.paintStyle.outlineWidth);var u=t.endpointHoverStyles[n]||t.endpointHoverStyle||t.endpointHoverStyle||t.instance.defaults.endpointHoverStyles[n]||t.instance.defaults.endpointHoverStyle;null!=t.hoverPaintStyle&&(null==u&&(u={}),null==u.fill&&(u.fill=t.hoverPaintStyle.stroke));var h=t.uuids?t.uuids[n]:null;i=null!=i?i:null!=t.instance.defaults.anchors?t.instance.defaults.anchors[n]:t.instance.defaults.anchor,a=t.instance._internal_newEndpoint({paintStyle:c,hoverPaintStyle:u,endpoint:l,connections:[t],uuid:h,element:o,scope:t.scope,anchor:i,reattachConnections:t.reattach||t.instance.defaults.reattachConnections,connectionsDetachable:t.detachable||t.instance.defaults.connectionsDetachable}),t.instance._refreshEndpoint(a),null==e&&(a.deleteOnEmpty=!0),t.endpoints[n]=a}return a}var Le=function(t){ut(n,t);var e=vt(n);function n(t,i){var o;st(this,n),(o=e.call(this,t,i)).instance=t,ct(pt(o),"connector",void 0),ct(pt(o),"defaultLabelLocation",.5),ct(pt(o),"scope",void 0),ct(pt(o),"typeId","_jsplumb_connection"),ct(pt(o),"previousConnection",void 0),ct(pt(o),"sourceId",void 0),ct(pt(o),"targetId",void 0),ct(pt(o),"source",void 0),ct(pt(o),"target",void 0),ct(pt(o),"detachable",!0),ct(pt(o),"reattach",!1),ct(pt(o),"uuids",void 0),ct(pt(o),"cost",1),ct(pt(o),"directed",void 0),ct(pt(o),"endpoints",[null,null]),ct(pt(o),"endpointStyles",void 0),ct(pt(o),"endpointSpec",void 0),ct(pt(o),"endpointsSpec",void 0),ct(pt(o),"endpointStyle",{}),ct(pt(o),"endpointHoverStyle",{}),ct(pt(o),"endpointHoverStyles",void 0),ct(pt(o),"suspendedEndpoint",void 0),ct(pt(o),"suspendedIndex",void 0),ct(pt(o),"suspendedElement",void 0),ct(pt(o),"suspendedElementId",void 0),ct(pt(o),"suspendedElementType",void 0),ct(pt(o),"_forceReattach",void 0),ct(pt(o),"_forceDetach",void 0),ct(pt(o),"proxies",[]),ct(pt(o),"pending",!1),o.id=i.id,o.previousConnection=i.previousConnection,o.source=i.source,o.target=i.target,i.sourceEndpoint?(o.source=i.sourceEndpoint.element,o.sourceId=i.sourceEndpoint.elementId):o.sourceId=t.getId(o.source),i.targetEndpoint?(o.target=i.targetEndpoint.element,o.targetId=i.targetEndpoint.elementId):o.targetId=t.getId(o.target),o.scope=i.scope;var r=i.anchors?i.anchors[0]:i.anchor,s=i.anchors?i.anchors[1]:i.anchor;t.manage(o.source),t.manage(o.target),o.visible=!0,o.params={cssClass:i.cssClass,hoverClass:i.hoverClass,"pointer-events":i["pointer-events"],overlays:i.overlays},o.lastPaintedAt=null,i.type&&(i.endpoints=i.endpoints||o.instance._deriveEndpointAndAnchorSpec(i.type).endpoints),o.endpointSpec=i.endpoint,o.endpointsSpec=i.endpoints||[null,null],o.endpointStyle=i.endpointStyle,o.endpointHoverStyle=i.endpointHoverStyle,o.endpointStyles=i.endpointStyles||[null,null],o.endpointHoverStyles=i.endpointHoverStyles||[null,null],o.paintStyle=i.paintStyle,o.hoverPaintStyle=i.hoverPaintStyle,o.uuids=i.uuids,o.makeEndpoint(!0,o.source,o.sourceId,r,i.sourceEndpoint),o.makeEndpoint(!1,o.target,o.targetId,s,i.targetEndpoint),o.scope||(o.scope=o.endpoints[0].scope),null!=i.deleteEndpointsOnEmpty&&(o.endpoints[0].deleteOnEmpty=i.deleteEndpointsOnEmpty,o.endpoints[1].deleteOnEmpty=i.deleteEndpointsOnEmpty);var l=o.instance.defaults.connectionsDetachable;!1===i.detachable&&(l=!1),!1===o.endpoints[0].connectionsDetachable&&(l=!1),!1===o.endpoints[1].connectionsDetachable&&(l=!1),o.endpointsSpec=i.endpoints||[null,null],o.endpointSpec=i.endpoint||null;var c=i.reattach||o.endpoints[0].reattachConnections||o.endpoints[1].reattachConnections||o.instance.defaults.reattachConnections,u=a({},o.endpoints[0].connectorStyle||o.endpoints[1].connectorStyle||i.paintStyle||o.instance.defaults.paintStyle);if(o.appendToDefaultType({detachable:l,reattach:c,paintStyle:u,hoverPaintStyle:a({},o.endpoints[0].connectorHoverStyle||o.endpoints[1].connectorHoverStyle||i.hoverPaintStyle||o.instance.defaults.hoverPaintStyle)}),i.outlineWidth&&(u.outlineWidth=i.outlineWidth),i.outlineColor&&(u.outlineStroke=i.outlineColor),i.lineWidth&&(u.strokeWidth=i.lineWidth),i.color&&(u.stroke=i.color),!o.instance._suspendDrawing){var d=o.instance._suspendedAt||j();o.instance._paintEndpoint(o.endpoints[0],{timestamp:d}),o.instance._paintEndpoint(o.endpoints[1],{timestamp:d})}o.cost=i.cost||o.endpoints[0].connectionCost,o.directed=i.directed,null==i.directed&&(o.directed=o.endpoints[0].connectionsDirected);var p=a({},o.endpoints[1].parameters);a(p,o.endpoints[0].parameters),a(p,o.parameters),o.parameters=p,o.paintStyleInUse=o.getPaintStyle()||{},o._setConnector(o.endpoints[0].connector||o.endpoints[1].connector||i.connector||o.instance.defaults.connector,!0);var f=null!=i.data&&h(i.data)?i.data:{};o.setData(f);var v=[rt,o.endpoints[0].edgeType,o.endpoints[1].edgeType,i.type].join(" ");return/[^\s]/.test(v)&&o.addType(v,i.data),o}return lt(n,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(t,e,n,i,o){return n=n||this.instance.getId(e),Ge(this,o,t?0:1,i,e)}},{key:"getTypeDescriptor",value:function(){return n.type}},{key:"isDetachable",value:function(t){return!1!==this.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(t){this.detachable=!0===t}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(t){this.reattach=!0===t}},{key:"applyType",value:function(t,e){var i=null;null!=t.connector&&(null==(i=this.getCachedTypeItem("connector",e.connector))&&(i=this.prepareConnector(t.connector,e.connector),this.cacheTypeItem("connector",i,e.connector)),this.setPreparedConnector(i)),yt(ht(n.prototype),"applyType",this).call(this,t,e),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope);var o=null;t.anchor?null==(o=this.getCachedTypeItem("anchors",e.anchor))&&(o=[Me(t.anchor),Me(t.anchor)],this.cacheTypeItem("anchors",o,e.anchor)):t.anchors&&null==(o=this.getCachedTypeItem("anchors",e.anchors))&&(o=[Me(t.anchors[0]),Me(t.anchors[1])],this.cacheTypeItem("anchors",o,e.anchors)),null!=o&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,t)}},{key:"addClass",value:function(t,e){yt(ht(n.prototype),"addClass",this).call(this,t),e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.instance.addConnectorClass(this.connector,t)}},{key:"removeClass",value:function(t,e){yt(ht(n.prototype),"removeClass",this).call(this,t),e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.instance.removeConnectorClass(this.connector,t)}},{key:"setVisible",value:function(t){yt(ht(n.prototype),"setVisible",this).call(this,t),this.connector&&this.instance.setConnectorVisible(this.connector,t),this.instance._paintConnection(this)}},{key:"destroy",value:function(){yt(ht(n.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(t,e){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(c(t))n=this.instance._makeConnector(this,t,i);else{var o=t;n=this.instance._makeConnector(this,o.type,f(o.options||{},i))}return null!=e&&(n.typeId=e),n}},{key:"setPreparedConnector",value:function(t,e,n,i){if(this.connector!==t){var o,r="";if(null!=this.connector&&(o=this.connector,r=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=t,i&&this.cacheTypeItem("connector",t,i),this.addClass(r),null!=o){var s=this.getOverlays();for(var a in s)this.instance.reattachOverlay(s[a],this)}e||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(t,e,n,i){var o=this.prepareConnector(t,i);this.setPreparedConnector(o,e,n,i)}},{key:"replaceEndpoint",value:function(t,e){var n=this.endpoints[t],i=(n.elementId,this.instance.getEndpoints(n.element)),o=i.indexOf(n),r=Ge(this,null,t,null,n.element,0,e);this.endpoints[t]=r,i.splice(o,1,r),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire("endpoint:replaced",{previous:n,current:r})}}]),n}(se);ct(Le,"type","connection");var Fe=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],Be=function(t){ut(n,t);var e=vt(n);function n(t,i){var o;st(this,n),(o=e.call(this,t,i)).instance=t,ct(pt(o),"connections",[]),ct(pt(o),"endpoint",void 0),ct(pt(o),"element",void 0),ct(pt(o),"elementId",void 0),ct(pt(o),"dragAllowedWhenFull",!0),ct(pt(o),"timestamp",void 0),ct(pt(o),"portId",void 0),ct(pt(o),"maxConnections",void 0),ct(pt(o),"proxiedBy",void 0),ct(pt(o),"connectorClass",void 0),ct(pt(o),"connectorHoverClass",void 0),ct(pt(o),"finalEndpoint",void 0),ct(pt(o),"enabled",!0),ct(pt(o),"isSource",void 0),ct(pt(o),"isTarget",void 0),ct(pt(o),"isTemporarySource",void 0),ct(pt(o),"connectionCost",1),ct(pt(o),"connectionsDirected",void 0),ct(pt(o),"connectionsDetachable",void 0),ct(pt(o),"reattachConnections",void 0),ct(pt(o),"currentAnchorClass",void 0),ct(pt(o),"referenceEndpoint",void 0),ct(pt(o),"edgeType",void 0),ct(pt(o),"connector",void 0),ct(pt(o),"connectorOverlays",void 0),ct(pt(o),"connectorStyle",void 0),ct(pt(o),"connectorHoverStyle",void 0),ct(pt(o),"deleteOnEmpty",void 0),ct(pt(o),"uuid",void 0),ct(pt(o),"scope",void 0),ct(pt(o),"_anchor",void 0),ct(pt(o),"defaultLabelLocation",[.5,.5]),o.appendToDefaultType({edgeType:i.edgeType,maxConnections:null==i.maxConnections?o.instance.defaults.maxConnections:i.maxConnections,paintStyle:i.paintStyle||o.instance.defaults.endpointStyle,hoverPaintStyle:i.hoverPaintStyle||o.instance.defaults.endpointHoverStyle,connectorStyle:i.connectorStyle,connectorHoverStyle:i.connectorHoverStyle,connectorClass:i.connectorClass,connectorHoverClass:i.connectorHoverClass,connectorOverlays:i.connectorOverlays,connector:i.connector}),o.enabled=!(!1===i.enabled),o.visible=!0,o.element=i.element,o.uuid=i.uuid,o.portId=i.portId,o.elementId=i.elementId,o.connectionCost=null==i.connectionCost?1:i.connectionCost,o.connectionsDirected=i.connectionsDirected,o.currentAnchorClass="",o.events={},o.connectorOverlays=i.connectorOverlays,o.connectorStyle=i.connectorStyle,o.connectorHoverStyle=i.connectorHoverStyle,o.connector=i.connector,o.edgeType=i.edgeType,o.connectorClass=i.connectorClass,o.connectorHoverClass=i.connectorHoverClass,o.deleteOnEmpty=!0===i.deleteOnEmpty,o.isSource=i.source||!1,o.isTemporarySource=i.isTemporarySource||!1,o.isTarget=i.target||!1,o.connections=i.connections||[],o.scope=i.scope||t.defaultScope,o.timestamp=null,o.reattachConnections=i.reattachConnections||t.defaults.reattachConnections,o.connectionsDetachable=t.defaults.connectionsDetachable,!1===i.connectionsDetachable&&(o.connectionsDetachable=!1),o.dragAllowedWhenFull=!1!==i.dragAllowedWhenFull,i.onMaxConnections&&o.bind("maxConnections",i.onMaxConnections);var r=i.endpoint||i.existingEndpoint||t.defaults.endpoint;if(o.setEndpoint(r),null!=i.preparedAnchor)o.setPreparedAnchor(i.preparedAnchor);else{var s=i.anchor?i.anchor:i.anchors?i.anchors:t.defaults.anchor||Y.Top;o.setAnchor(s)}var a=[rt,i.type||""].join(" ");return o.addType(a,i.data),o}return lt(n,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var t=this._anchor&&this._anchor.cssClass;if(null!=t&&t.length>0){var e=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=t;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");e!==n&&(this.removeClass(e),this.addClass(n),this.instance.removeClass(this.element,e),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(t){return this.instance.router.setAnchor(this,t),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(t){this.fire("anchor:changed",{endpoint:this,anchor:t}),this._updateAnchorClass()}},{key:"setAnchor",value:function(t){var e=this.instance.router.prepareAnchor(t);return this.setPreparedAnchor(e),this}},{key:"addConnection",value:function(t){this.connections.push(t),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(t,e,n){(e=null==e?this.connections.indexOf(t):e)>=0&&(this.connections.splice(e,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(t){for(var e=this.connections.length,n=0;n<e;n++)this.instance.deleteConnection(this.connections[0],t)}},{key:"detachFrom",value:function(t){for(var e=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==t&&this.connections[n].endpoints[0]!==t||e.push(this.connections[n]);for(var i=0,o=e.length;i<o;i++)this.instance.deleteConnection(e[0]);return this}},{key:"setVisible",value:function(t,e,i){if(yt(ht(n.prototype),"setVisible",this).call(this,t),this.endpoint.setVisible(t),t?this.showOverlays():this.hideOverlays(),!e)for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(t),!i){var r=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[r].connections.length&&this.connections[o].endpoints[r].setVisible(t,!0,!0)}}},{key:"applyType",value:function(t,e){yt(ht(n.prototype),"applyType",this).call(this,t,e),this.setPaintStyle(t.endpointStyle||t.paintStyle),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle),this.connectorStyle=t.connectorStyle,this.connectorHoverStyle=t.connectorHoverStyle,this.connector=t.connector,this.connectorOverlays=t.connectorOverlays,this.edgeType=t.edgeType,null!=t.maxConnections&&(this.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),a(t,Fe),this.instance.applyEndpointType(this,t)}},{key:"destroy",value:function(){yt(ht(n.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e}},{key:"setDragAllowedWhenFull",value:function(t){this.dragAllowedWhenFull=t}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(t,e){var n,i={cssClass:this.cssClass,endpoint:this};if(L(t,Pt)){var o=t;(n=Et.clone(o)).classes=i.cssClass.split(" ")}else if(c(t))n=Et.get(this,t,i);else{var r=t;a(i,r.options||{}),n=Et.get(this,r.type,i)}return n.typeId=e,n}},{key:"setEndpoint",value:function(t){var e=this.prepareEndpoint(t);this.setPreparedEndpoint(e)}},{key:"setPreparedEndpoint",value:function(t){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=t}},{key:"addClass",value:function(t,e){yt(ht(n.prototype),"addClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.addClass(t)}},{key:"removeClass",value:function(t,e){yt(ht(n.prototype),"removeClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.removeClass(t)}}]),n}(se),Re=function t(e,n){st(this,t),this.instance=e,this.el=n,ct(this,"group",void 0)},He=function(t){ut(n,t);var e=vt(n);function n(t,i,o){var r;st(this,n),(r=e.call(this,t,i)).instance=t,ct(pt(r),"children",[]),ct(pt(r),"collapsed",!1),ct(pt(r),"droppable",void 0),ct(pt(r),"enabled",void 0),ct(pt(r),"orphan",void 0),ct(pt(r),"constrain",void 0),ct(pt(r),"proxied",void 0),ct(pt(r),"ghost",void 0),ct(pt(r),"revert",void 0),ct(pt(r),"prune",void 0),ct(pt(r),"dropOverride",void 0),ct(pt(r),"anchor",void 0),ct(pt(r),"endpoint",void 0),ct(pt(r),"connections",{source:[],target:[],internal:[]}),ct(pt(r),"manager",void 0),ct(pt(r),"id",void 0),ct(pt(r),"elId",void 0);var s=r.el;return s._isJsPlumbGroup=!0,s._jsPlumbGroup=pt(r),r.elId=t.getId(i),r.orphan=!0===o.orphan,r.revert=!0!==r.orphan&&!1!==o.revert,r.droppable=!1!==o.droppable,r.ghost=!0===o.ghost,r.enabled=!1!==o.enabled,r.prune=!0!==r.orphan&&!0===o.prune,r.constrain=r.ghost||!0===o.constrain,r.proxied=!1!==o.proxied,r.id=o.id||j(),r.dropOverride=!0===o.dropOverride,r.anchor=o.anchor,r.endpoint=o.endpoint,r.anchor=o.anchor,t.setAttribute(i,"data-jtk-group",""),r}return lt(n,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(t,e){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(t,e){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(t,e){return this.endpoint||{type:wt.type,options:{radius:10}}}},{key:"add",value:function(t,e){var n=this.instance.getGroupContentArea(this),i=t;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(t,!0,e,!1)}i._jsPlumbParentGroup=this,this.children.push(new Re(this.instance,t)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(t){return null==t?null:_(this.children,(function(e){return e.el===t}))}},{key:"remove",value:function(t,e,n,i,o){var r=this.resolveNode(t);null!=r&&this._doRemove(r,e,n,i,o)}},{key:"_doRemove",value:function(t,e,n,i,o){var r=t.el;if(delete r._jsPlumbParentGroup,k(this.children,(function(e){return e===t})),e)try{this.instance.getGroupContentArea(this).removeChild(r)}catch(t){T("Could not remove element from Group "+t)}if(!n){var s={group:this,el:r};o&&(s.targetGroup=o),this.instance.fire("group:member:removed",s)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(t,e){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,t,e,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var t={},e=0;e<this.children.length;e++){var n=this.manager.orphan(this.children[e].el,!1);t[n.id]=n.pos}return this.children.length=0,t}},{key:"addGroup",value:function(t){if(this.instance.allowNestedGroups&&t!==this){if(this.instance.groupManager.isAncestor(this,t))return!1;null!=t.group&&t.group.removeGroup(t);var e=this.instance.getId(t.el);this.instance.getManagedElements()[e].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(t.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));t.el._jsPlumbParentGroup=this,this.children.push(t),this.instance._appendElementToGroup(this,t.el),t.group=this;var o={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(t.el,o),this.instance.fire("group:nested:added",{parent:this,child:t}),!0}return!1}},{key:"removeGroup",value:function(t){if(t.group===this){var e=t.el,n=this.instance.getGroupContentArea(this);n===e.parentNode&&n.removeChild(t.el);var i=this.instance.getId(t.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter((function(e){return e.id!==t.id})),delete t.group,delete e._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:t})}}},{key:"getGroups",value:function(){return this.children.filter((function(t){return t.constructor===n}))}},{key:"getNodes",value:function(){return this.children.filter((function(t){return t.constructor===Re}))}},{key:"collapseParent",get:function(){var t=null;if(null==this.group)return null;for(var e=this.group;null!=e;)e.collapsed&&(t=e),e=e.group;return t}}]),n}(Re),Ne=function(){function t(e){var n=this;st(this,t),this.instance=e,ct(this,"groupMap",{}),ct(this,"_connectionSourceMap",{}),ct(this,"_connectionTargetMap",{}),e.bind("internal.connection",(function(t){var e=n.getGroupFor(t.source),i=n.getGroupFor(t.target);null!=e&&null!=i&&e===i?(n._connectionSourceMap[t.connection.id]=e,n._connectionTargetMap[t.connection.id]=e,P(e.connections.internal,t.connection)):(null!=e&&(t.target._jsPlumbGroup===e?P(e.connections.internal,t.connection):P(e.connections.source,t.connection),n._connectionSourceMap[t.connection.id]=e),null!=i&&(t.source._jsPlumbGroup===i?P(i.connections.internal,t.connection):P(i.connections.target,t.connection),n._connectionTargetMap[t.connection.id]=i))})),e.bind("internal.connection:detached",(function(t){n._cleanupDetachedConnection(t.connection)})),e.bind("connection:move",(function(t){var e=t.originalEndpoint.element,i=n.getGroupFor(e),o=t.connection.endpoints[t.index].element,r=n.getGroupFor(o),s=0===t.index?n._connectionSourceMap:n._connectionTargetMap,a=0===t.index?n._connectionTargetMap:n._connectionSourceMap;null!=r?(s[t.connection.id]=r,t.connection.source===t.connection.target&&(a[t.connection.id]=r)):(delete s[t.connection.id],t.connection.source===t.connection.target&&delete a[t.connection.id]),null!=i&&n._updateConnectionsForGroup(i),null!=r&&n._updateConnectionsForGroup(r)}))}return lt(t,[{key:"_cleanupDetachedConnection",value:function(t){t.proxies.length=0;var e,n=this._connectionSourceMap[t.id];null!=n&&(e=function(e){return e.id===t.id},k(n.connections.source,e),k(n.connections.target,e),k(n.connections.internal,e),delete this._connectionSourceMap[t.id]),null!=(n=this._connectionTargetMap[t.id])&&(e=function(e){return e.id===t.id},k(n.connections.source,e),k(n.connections.target,e),k(n.connections.internal,e),delete this._connectionTargetMap[t.id])}},{key:"addGroup",value:function(t){var e=t.el;if(null!=this.groupMap[t.id])throw new Error("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=e._isJsPlumbGroup)throw new Error("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new He(this.instance,t.el,t);return this.groupMap[n.id]=n,t.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,"jtk-group-expanded"),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire("group:added",{group:n}),n}},{key:"getGroup",value:function(t){var e=t;if(c(t)&&null==(e=this.groupMap[t]))throw new Error("No such group ["+t+"]");return e}},{key:"getGroupFor",value:function(t){for(var e=t,n=this.instance.getContainer(),i=!1,o=null;!i;)null==e||e===n?i=!0:e._jsPlumbParentGroup?(o=e._jsPlumbParentGroup,i=!0):e=e.parentNode;return o}},{key:"getGroups",value:function(){var t=[];for(var e in this.groupMap)t.push(this.groupMap[e]);return t}},{key:"removeGroup",value:function(t,e,n,i){var o=this,r=this.getGroup(t);this.expandGroup(r,!0);var s={};return g(r.children,(function(t){var e=o.instance.getManagedElements()[o.instance.getId(t.el)];e&&delete e.group})),e?(g(r.getGroups(),(function(t){return o.removeGroup(t,e,n)})),r.removeAll(n,i)):(r.group&&g(r.children,(function(t){return r.group.add(t.el)})),s=r.orphanAll()),r.group&&r.group.removeGroup(r),this.instance.unmanage(r.el,!0),delete this.groupMap[r.id],this.instance.fire("group:removed",{group:r}),s}},{key:"removeAllGroups",value:function(t,e,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],t,e,n)}},{key:"forEach",value:function(t){for(var e in this.groupMap)t(this.groupMap[e])}},{key:"orphan",value:function(t,e){var n=t;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,o=this.instance.getId(n),r=this.instance.getOffset(t);return!0!==e&&i.group?this.instance._appendElementToGroup(i.group,t):this.instance._appendElementToContainer(t),this.instance.setPosition(t,r),delete n._jsPlumbParentGroup,{id:o,pos:r}}}},{key:"_updateConnectionsForGroup",value:function(t){var e=this;t.connections.source.length=0,t.connections.target.length=0,t.connections.internal.length=0;var n=t.children.slice().map((function(t){return t.el})),i=[];if(g(n,(function(t){Array.prototype.push.apply(i,e.instance.getSelector(t,Vt))})),Array.prototype.push.apply(n,i),n.length>0){var o,r,s=this.instance.getConnections({source:n,scope:"*"},!0),a=this.instance.getConnections({target:n,scope:"*"},!0),l={},c=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=e.getGroupFor(n[i].source),r=e.getGroupFor(n[i].target),n[i].source===t.el&&r===t||n[i].target===t.el&&o===t?t.connections.internal.push(n[i]):o===t?(r!==t?t.connections.source.push(n[i]):t.connections.internal.push(n[i]),e._connectionSourceMap[n[i].id]=t):r===t&&(t.connections.target.push(n[i]),e._connectionTargetMap[n[i].id]=t))};c(s),c(a)}}},{key:"_collapseConnection",value:function(t,e,n){var i=t.endpoints[0===e?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=t.endpoints[0].element._jsPlumbParentGroup,r=null!=o?o.collapseParent||o:null,s=t.endpoints[1].element._jsPlumbParentGroup,a=null!=s?s.collapseParent||s:null;if(null==r||null==a||r.id!==a.id){var l=n.el;return this.instance.getId(l),this.instance.proxyConnection(t,e,l,(function(t,e){return n.getEndpoint(t,e)}),(function(t,e){return n.getAnchor(t,e)})),!0}return!1}},{key:"_expandConnection",value:function(t,e,n){this.instance.unproxyConnection(t,e)}},{key:"isElementDescendant",value:function(t,e){for(var n=this.instance.getContainer();;){if(null==t||t===n)return!1;if(t===e)return!0;t=t.parentNode}}},{key:"collapseGroup",value:function(t){var e=this,n=this.getGroup(t);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,"jtk-group-expanded"),this.instance.addClass(i,"jtk-group-collapsed"),n.proxied){var o=new Set,r=function(t,i){for(var r=0;r<t.length;r++){var s=t[r];!0===e._collapseConnection(s,i,n)&&o.add(s.id)}};r(n.connections.source,0),r(n.connections.target,1),g(n.getGroups(),(function(t){e.cascadeCollapse(n,t,o)}))}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire("group:collapse",{group:n})}else n.collapsed=!0,this.instance.removeClass(i,"jtk-group-expanded"),this.instance.addClass(i,"jtk-group-collapsed")}}},{key:"cascadeCollapse",value:function(t,e,n){var i=this;if(t.proxied){var o=function(e,o){for(var r=0;r<e.length;r++){var s=e[r];n.has(s.id)||!0===i._collapseConnection(s,o,t)&&n.add(s.id)}};o(e.connections.source,0),o(e.connections.target,1)}g(e.getGroups(),(function(e){i.cascadeCollapse(t,e,n)}))}},{key:"expandGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,"jtk-group-expanded"),this.instance.removeClass(o,"jtk-group-collapsed"),i.proxied){var r=function(t,e){for(var o=0;o<t.length;o++){var r=t[o];n._expandConnection(r,e,i)}};r(i.connections.source,0),r(i.connections.target,1);g(i.getGroups(),(function t(e,i){if(i||e.collapsed){var o=function(t,i){for(var o=0;o<t.length;o++){var r=t[o];n._collapseConnection(r,i,e.collapseParent||e)}};o(e.connections.source,0),o(e.connections.target,1),g(e.connections.internal,(function(t){return t.setVisible(!1)})),g(e.getGroups(),(function(e){return t(e,!0)}))}else n.expandGroup(e,!0)}))}this.instance.revalidate(o),this.repaintGroup(i),e||this.instance.fire("group:expand",{group:i})}else i.collapsed=!1,this.instance.addClass(o,"jtk-group-expanded"),this.instance.removeClass(o,"jtk-group-collapsed")}}},{key:"toggleGroup",value:function(t){null!=(t=this.getGroup(t))&&(t.collapsed?this.expandGroup(t):this.collapseGroup(t))}},{key:"repaintGroup",value:function(t){for(var e=this.getGroup(t).children,n=0;n<e.length;n++)this.instance.revalidate(e[n].el)}},{key:"addToGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=i.el,r=function(t){var r=t,s=null!=r._isJsPlumbGroup,a=r._jsPlumbGroup,l=r._jsPlumbParentGroup;if(l!==i){var c=n.instance.manage(t),u=n.instance.getOffset(t),h=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));c.group=i.elId,null!=l&&(l.remove(t,!1,e,!1,i),n._updateConnectionsForGroup(l)),s?i.addGroup(a):i.add(t,e);var d=function(t,e){var o=0===e?1:0;t.each((function(t){t.setVisible(!1),t.endpoints[o].element._jsPlumbGroup===i?(t.endpoints[o].setVisible(!1),n._expandConnection(t,o,i)):(t.endpoints[e].setVisible(!1),n._collapseConnection(t,e,i))}))};i.collapsed&&(d(n.instance.select({source:t}),0),d(n.instance.select({target:t}),1)),n.instance.getId(t);var p={x:u.x-h.x,y:u.y-h.y};if(n.instance.setPosition(t,p),n._updateConnectionsForGroup(i),n.instance.revalidate(t),!e){var f={group:i,el:t,pos:p};l&&(f.sourceGroup=l),n.instance.fire("group:member:added",f)}}},s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];g(a,r)}}},{key:"removeFromGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=function(t){if(i.collapsed){var o=function(e,o){for(var r=0;r<e.length;r++){var s=e[r];if(s.proxies)for(var a=0;a<s.proxies.length;a++)if(null!=s.proxies[a]){var l=s.proxies[a].originalEp.element;(l===t||n.isElementDescendant(l,t))&&n._expandConnection(s,o,i)}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(t,null,e);var r=n.instance.getManagedElements()[n.instance.getId(t)];r&&delete r.group},r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];g(s,o)}}},{key:"getAncestors",value:function(t){for(var e=[],n=t.group;null!=n;)e.push(n),n=n.group;return e}},{key:"isAncestor",value:function(t,e){return null!=t&&null!=e&&-1!==this.getAncestors(t).indexOf(e)}},{key:"getDescendants",value:function(t){var e=[];return function t(n){var i=n.getGroups();e.push.apply(e,mt(i)),g(i,t)}(t),e}},{key:"isDescendant",value:function(t,e){return null!=t&&null!=e&&-1!==this.getDescendants(e).indexOf(t)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),t}(),ze=function(){function t(e,n){st(this,t),this.instance=e,this.entries=n}return lt(t,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(t){return g(this.entries,(function(e){return t(e)})),this}},{key:"get",value:function(t){return this.entries[t]}},{key:"addClass",value:function(t,e){return this.each((function(n){return n.addClass(t,e)})),this}},{key:"removeClass",value:function(t,e){return this.each((function(n){return n.removeClass(t,e)})),this}},{key:"removeAllOverlays",value:function(){return this.each((function(t){return t.removeAllOverlays()})),this}},{key:"setLabel",value:function(t){return this.each((function(e){return e.setLabel(t)})),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(t){var e=[];return this.each((function(n){return e.push(t(n))})),e}},{key:"addOverlay",value:function(t){return this.each((function(e){return e.addOverlay(t)})),this}},{key:"removeOverlay",value:function(t){return this.each((function(e){return e.removeOverlay(t)})),this}},{key:"removeOverlays",value:function(){return this.each((function(t){return t.removeOverlays()})),this}},{key:"showOverlay",value:function(t){return this.each((function(e){return e.showOverlay(t)})),this}},{key:"hideOverlay",value:function(t){return this.each((function(e){return e.hideOverlay(t)})),this}},{key:"setPaintStyle",value:function(t){return this.each((function(e){return e.setPaintStyle(t)})),this}},{key:"setHoverPaintStyle",value:function(t){return this.each((function(e){return e.setHoverPaintStyle(t)})),this}},{key:"setSuspendEvents",value:function(t){return this.each((function(e){return e.setSuspendEvents(t)})),this}},{key:"setParameter",value:function(t,e){return this.each((function(n){return n.parameters[t]=e})),this}},{key:"setParameters",value:function(t){return this.each((function(e){return e.parameters=t})),this}},{key:"setVisible",value:function(t){return this.each((function(e){return e.setVisible(t)})),this}},{key:"addType",value:function(t){return this.each((function(e){return e.addType(t)})),this}},{key:"toggleType",value:function(t){return this.each((function(e){return e.toggleType(t)})),this}},{key:"removeType",value:function(t){return this.each((function(e){return e.removeType(t)})),this}},{key:"bind",value:function(t,e){return this.each((function(n){return n.bind(t,e)})),this}},{key:"unbind",value:function(t,e){return this.each((function(n){return n.unbind(t,e)})),this}},{key:"setHover",value:function(t){var e=this;return this.each((function(n){return e.instance.setHover(n,t)})),this}}]),t}(),Ve=function(t){ut(n,t);var e=vt(n);function n(){return st(this,n),e.apply(this,arguments)}return lt(n,[{key:"setEnabled",value:function(t){return this.each((function(e){return e.enabled=t})),this}},{key:"setAnchor",value:function(t){return this.each((function(e){return e.setAnchor(t)})),this}},{key:"deleteEveryConnection",value:function(){return this.each((function(t){return t.deleteEveryConnection()})),this}},{key:"deleteAll",value:function(){var t=this;return this.each((function(e){return t.instance.deleteEndpoint(e)})),this.clear(),this}}]),n}(ze),We=function(t){ut(n,t);var e=vt(n);function n(){return st(this,n),e.apply(this,arguments)}return lt(n,[{key:"setDetachable",value:function(t){return this.each((function(e){return e.setDetachable(t)})),this}},{key:"setReattach",value:function(t){return this.each((function(e){return e.setReattach(t)})),this}},{key:"setConnector",value:function(t){return this.each((function(e){return e._setConnector(t)})),this}},{key:"deleteAll",value:function(){var t=this;this.each((function(e){return t.instance.deleteConnection(e)})),this.clear()}},{key:"repaint",value:function(){var t=this;return this.each((function(e){return t.instance._paintConnection(e)})),this}}]),n}(ze),Xe=function t(){st(this,t),ct(this,"affectedElements",new Set)};function Ye(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var Ue=function(t,e){var n=0;return e[1]>t[1]?n=-1:e[1]<t[1]&&(n=1),n},qe=function(t,e){return-1*Ue(t,e)};function Ze(t,e,n,i){!function(t,e,n,i){if(0===e.length)e.push(t);else{for(var o=i?-1:1,r=0,s=e.length,a=Math.floor((r+s)/2);s>r;){n(t,e[a])*o<0?s=a:r=a+1,a=Math.floor((r+s)/2)}e.splice(a,0,t)}}([t,e],n,Ue,i)}function Je(t,e){var n=m(e,(function(e){return e[0]===t}));n>-1&&e.splice(n,1)}var $e,Qe=function(t){ut(n,t);var e=vt(n);function n(t){var i;return st(this,n),(i=e.call(this)).instance=t,ct(pt(i),"_currentTransaction",null),ct(pt(i),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),ct(pt(i),"_elementMap",new Map),ct(pt(i),"_transformedElementMap",new Map),ct(pt(i),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),i}return lt(n,[{key:"_updateBounds",value:function(t,e,n){null!=e&&(Je(t,this._sortedElements.xmin),Je(t,this._sortedElements.xmax),Je(t,this._sortedElements.ymin),Je(t,this._sortedElements.ymax),Ze(t,e.t.x,this._sortedElements.xmin,!1),Ze(t,e.t.x+e.t.w,this._sortedElements.xmax,!0),Ze(t,e.t.y,this._sortedElements.ymin,!1),Ze(t,e.t.y+e.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var t=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach((function(e,n){t._sortedElements.xmin.push([n,e.t.x]),t._sortedElements.xmax.push([n,e.t.x+e.t.w]),t._sortedElements.ymin.push([n,e.t.y]),t._sortedElements.ymax.push([n,e.t.y+e.t.h])})),this._sortedElements.xmin.sort(Ue),this._sortedElements.ymin.sort(Ue),this._sortedElements.xmax.sort(qe),this._sortedElements.ymax.sort(qe),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(t,e,n){var i,o,r,s,a,l,c,u,h,d,p,f,v,y,g,m,_,x,k;e.t=(i=e.x,o=e.y,r=e.w,s=e.h,a=e.r,l=i+r/2,c=o+s/2,u=Math.cos(a/360*Math.PI*2),h=Math.sin(a/360*Math.PI*2),p=(d=function(t,e){return{x:l+Math.round((t-l)*u-(e-c)*h),y:c+Math.round((e-c)*u-(t-l)*h)}})(i,o),f=d(i+r,o),v=d(i+r,o+s),y=d(i,o+s),g=d(i+r/2,o+s/2),m=Math.min(p.x,f.x,v.x,y.x),_=Math.max(p.x,f.x,v.x,y.x),x=Math.min(p.y,f.y,v.y,y.y),k=Math.max(p.y,f.y,v.y,y.y),{x:m,y:x,w:_-m,h:k-x,c:g,r:a,x2:_,y2:k,cr:u,sr:h}),this._transformedElementMap.set(t,e.t),!0!==n&&this._updateBounds(t,e,n)}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new Xe}},{key:"endTransaction",value:function(){var t=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach((function(e){var n=t.getPosition(e);t._finaliseUpdate(e,n,!0)})),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(t){var e=this;g(t,(function(t){return e.updateElement(t.id,t.x,t.y,t.width,t.height,t.rotation)}))}},{key:"updateElement",value:function(t,e,n,i,o,r,s){var a=G(this._elementMap,t,Ye);return a.dirty=null==e&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=e&&(a.x=e),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=r&&(a.r=r||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(t,a,s):this._currentTransaction.affectedElements.add(t),a}},{key:"refreshElement",value:function(t,e){var n=this.instance.getManagedElements(),i=n[t]?n[t].el:null;if(null!=i){var o=this.getSize(i),r=this.getOffset(i);return this.updateElement(t,r.x,r.y,o.w,o.h,null,e)}return null}},{key:"getSize",value:function(t){return this.instance.getSize(t)}},{key:"getOffset",value:function(t){return this.instance.getOffset(t)}},{key:"registerElement",value:function(t,e){return this.updateElement(t,0,0,0,0,0,e)}},{key:"addElement",value:function(t,e,n,i,o,r){return this.updateElement(t,e,n,i,o,r)}},{key:"rotateElement",value:function(t,e){var n=G(this._elementMap,t,Ye);return n.r=e||0,this._finaliseUpdate(t,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,null,null,e,n,null)}},{key:"setPosition",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,e,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(t){Je(t,this._sortedElements.xmin),Je(t,this._sortedElements.xmax),Je(t,this._sortedElements.ymin),Je(t,this._sortedElements.ymax),this._elementMap.delete(t),this._transformedElementMap.delete(t),this._recalculateBounds()}},{key:"getPosition",value:function(t){return this._elementMap.get(t)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),n}(U);function Ke(t,e){return e.theta-t.theta}function tn(t,e){return(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)-(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)}var en=(ct($e={},ae,tn),ct($e,ce,Ke),ct($e,ue,Ke),ct($e,le,tn),$e);function nn(t){return!0===t.isContinuous}function on(t){return!0===t.isContinuous}function rn(t){return t.locations.length>1}function sn(t){return[t.currentLocation,t.locations[t.currentLocation]]}var an=function(){function t(e){var n=this;st(this,t),this.instance=e,ct(this,"anchorLists",new Map),ct(this,"anchorLocations",new Map),e.bind("internal.connection:detached",(function(t){t.sourceEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(t.sourceEndpoint),t.targetEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(t.targetEndpoint)})),e.bind("internal.endpoint:unregistered",(function(t){n._removeEndpointFromAnchorLists(t)}))}return lt(t,[{key:"getAnchorOrientation",value:function(t){var e=this.anchorLocations.get(t.id);return e?[e.ox,e.oy]:[0,0]}},{key:"_distance",value:function(t,e,n,i,o,r,s){var a=i.x+t.x*o.w,l=i.y+t.y*o.h,c=i.x+o.w/2,u=i.y+o.h/2;if(null!=r&&r.length>0){var h=this.instance._applyRotations([a,l,0,0],r);a=h.x,l=h.y}return Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(c-a,2)+Math.pow(u-l,2))}},{key:"_anchorSelector",value:function(t,e,n,i,o,r,s){for(var a=n.x+i.w/2,l=n.y+i.h/2,c=-1,u=1/0,h=0;h<s.length;h++){var d=this._distance(s[h],a,l,t,e,o,r);d<u&&(c=h+0,u=d)}return[c,s[c]]}},{key:"_floatingAnchorCompute",value:function(t,e){var n=e.xy,i={curX:n.x+t.size.w/2,curY:n.y+t.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(t,i)}},{key:"_setComputedPosition",value:function(t,e,n){return this.anchorLocations.set(t.id,e),t.computedPosition=e,n&&(t.timestamp=n),e}},{key:"_computeSingleLocation",value:function(t,e,n,i){var o,r=i.rotation,s={curX:e.x+t.x*n.w+t.offx,curY:e.y+t.y*n.h+t.offy,x:t.x,y:t.y,ox:0,oy:0};if(null!=r&&r.length>0){var l=[t.iox,t.ioy],c={x:s.curX,y:s.curY,cr:0,sr:0};g(r,(function(t){c=A(c,t.c,t.r);var e=[Math.round(l[0]*c.cr-l[1]*c.sr),Math.round(l[1]*c.cr+l[0]*c.sr)];l=e.slice()})),t.ox=l[0],t.oy=l[1],o={curX:c.x,curY:c.y,x:t.x,y:t.y,ox:l[0],oy:l[1]}}else t.ox=t.iox,t.oy=t.ioy,o=a({ox:t.iox,oy:t.ioy},s);return o}},{key:"_singleAnchorCompute",value:function(t,e){var n=e.xy,i=e.wh,o=e.timestamp,r=this.anchorLocations.get(t.id);if(null!=r&&o&&o===t.timestamp)return r;var s=gt(sn(t),2);s[0];var a=s[1];return r=this._computeSingleLocation(a,n,i,e),this._setComputedPosition(t,r,o)}},{key:"_defaultAnchorCompute",value:function(t,e){var n;if(1===t.locations.length)return this._singleAnchorCompute(t,e);var i=e.xy,o=e.wh,r=e.txy,s=e.twh,a=gt(sn(t),2),l=a[0],c=a[1];if(t.locked||null==r||null==s)n=this._computeSingleLocation(c,i,o,e);else{var u=gt(this._anchorSelector(i,o,r,s,e.rotation,e.tRotation,t.locations),2),h=u[0],d=u[1];t.currentLocation=h,h!==l&&(t.cssClass=d.cls||t.cssClass,e.element._anchorLocationChanged(t)),n=this._computeSingleLocation(d,i,o,e)}return this._setComputedPosition(t,n,e.timestamp)}},{key:"_placeAnchors",value:function(t,e){var n=this,i=this.instance.viewport.getPosition(t),o=function(e,o,r,s,a,l){if(r.length>0)for(var c=r.sort(en[e]),u=function(t,e,n,i,o){for(var r=n?t.w:t.h,s=n?t.h:t.w,a=[],l=r/(e.length+1),c=0;c<e.length;c++){var u=(c+1)*l,h=i*s;o&&(u=r-u);var d=n?u:h,p=t.x+d,f=d/t.w,v=n?h:u,y=t.y+v,g=v/t.h;if(0!==t.r&&null!=t.r){var m=A({x:p,y:y},t.c,t.r);p=m.x,y=m.y}a.push({x:p,y:y,xLoc:f,yLoc:g,c:e[c].c})}return a}(i,c,s,a,e===ce||e===ae),h=0;h<u.length;h++){var d=u[h].c,p=d.endpoints[0].elementId===t?d.endpoints[0]:d.endpoints[1];n._setComputedPosition(p._anchor,{curX:u[h].x,curY:u[h].y,x:u[h].xLoc,y:u[h].yLoc,ox:l[0],oy:l[1]})}};o(ue,0,e.bottom,!0,1,[0,1]),o(ae,0,e.top,!0,0,[0,-1]),o(le,0,e.left,!1,0,[-1,0]),o(ce,0,e.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(t,e,n,i,o,r,s,a,l,c,u){var h,d=i.endpoints[s],p=d.id,f=[1,0][s],v={theta:e,order:n,c:i,b:o,elId:r,epId:p},y=t[l],g=d._continuousAnchorEdge?t[d._continuousAnchorEdge]:null;if(g){var _=m(g,(function(t){return t.epId===p}));if(-1!==_){g.splice(_,1);for(var x=0;x<g.length;x++)!0!==(h=g[x].c).placeholder&&c.add(h),u.add(g[x].c.endpoints[s]),u.add(g[x].c.endpoints[f])}}for(var k=0;k<y.length;k++)!0!==(h=y[k].c).placeholder&&c.add(h),u.add(y[k].c.endpoints[s]),u.add(y[k].c.endpoints[f]);var b=a?0:y.length;y.splice(b,0,v),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(t){var e=this.anchorLists.get(t.elementId),n=0;!function(t,e){if(t){var i=function(t){return t.epId===e};k(t.top,i),k(t.left,i),k(t.bottom,i),k(t.right,i),n+=t.top.length,n+=t.left.length,n+=t.bottom.length,n+=t.right.length}}(e,t.id),0===n&&this.anchorLists.delete(t.elementId),this.anchorLocations.delete(t._anchor.id)}},{key:"computeAnchorLocation",value:function(t,e){var n;return n=nn(t)?this.anchorLocations.get(t.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:on(t)?this._floatingAnchorCompute(t,e):this._defaultAnchorCompute(t,e),t.timestamp=e.timestamp,n}},{key:"computePath",value:function(t,e){var n=this.instance.viewport.getPosition(t.sourceId),i=this.instance.viewport.getPosition(t.targetId),o=t.endpoints[0],r=t.endpoints[1],s=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:e,rotation:this.instance._getRotations(t.sourceId)}),a=this.getEndpointLocation(r,{xy:i,wh:i,element:r,timestamp:e,rotation:this.instance._getRotations(t.targetId)});t.connector.resetBounds(),t.connector.compute({sourcePos:s,targetPos:a,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1],strokeWidth:t.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(t,e){e=e||{};var n=t._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=e.timestamp&&n.timestamp!==e.timestamp)&&(i=this.computeAnchorLocation(n,e),this._setComputedPosition(n,i,e.timestamp)),i}},{key:"getEndpointOrientation",value:function(t){return t._anchor?this.getAnchorOrientation(t._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(t,e){var n=this.anchorLocations.get(t.id);null!=n&&(n.ox=e[0],n.oy=e[1])}},{key:"isDynamicAnchor",value:function(t){return!!t._anchor&&(!nn(t._anchor)&&t._anchor.locations.length>1)}},{key:"isFloating",value:function(t){return!!t._anchor&&on(t._anchor)}},{key:"prepareAnchor",value:function(t){return Me(t)}},{key:"redraw",value:function(t,e,n){var i=this,o=new Set,r=new Set,s=new Set;if(!this.instance._suspendDrawing){var a=this.instance.endpointsByElement[t]||[];e=e||j();for(var l,c,u={},h=0;h<a.length;h++)if(c=a[h],r.add(c),l=c._anchor,0===c.connections.length)nn(l)&&(this.anchorLists.has(t)||this.anchorLists.set(t,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(t),-Math.PI/2,0,{endpoints:[c,c],placeholder:!0},!1,t,0,!1,ge(l),o,r),s.add(t));else for(var d=0;d<c.connections.length;d++){var p=c.connections[d],f=p.sourceId,v=p.targetId,y=nn(p.endpoints[0]._anchor),g=nn(p.endpoints[1]._anchor);if(y||g){var m=[f,(p.endpoints[0]._anchor.faces||[]).join("-"),v,(p.endpoints[1]._anchor.faces||[]).join("-")].join("-"),_=u[m],x=p.sourceId===t?1:0;y&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]}),g&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]});var k=this.instance.viewport.getPosition(v),b=this.instance.viewport.getPosition(f);if(v===f&&(y||g))this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,v,0,!1,ae,o,r),this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,p,!1,f,1,!1,ae,o,r);else{var C=this.instance._getRotations(f),E=this.instance._getRotations(v);_||(_=this._calculateOrientation(f,v,b,k,p.endpoints[0]._anchor,p.endpoints[1]._anchor,C,E),u[m]=_),y&&this._updateAnchorList(this.anchorLists.get(f),_.theta,0,p,!1,v,0,!1,_.a[0],o,r),g&&this._updateAnchorList(this.anchorLists.get(v),_.theta2,-1,p,!0,f,1,!0,_.a[1],o,r)}y&&s.add(f),g&&s.add(v),o.add(p),(y&&0===x||g&&1===x)&&r.add(p.endpoints[x])}else{var P=c.connections[d].endpoints[p.sourceId===t?1:0];if(rn(P._anchor)){this.instance._paintEndpoint(P,{elementWithPrecedence:t,timestamp:e}),o.add(c.connections[d]);for(var w=0;w<P.connections.length;w++)P.connections[w]!==c.connections[d]&&o.add(P.connections[w])}else o.add(c.connections[d])}}s.forEach((function(t){i._placeAnchors(t,i.anchorLists.get(t))})),r.forEach((function(t){var n=i.instance.viewport.getPosition(t.elementId);i.instance._paintEndpoint(t,{timestamp:e,offset:n})})),o.forEach((function(t){i.instance._paintConnection(t,{timestamp:e})}))}return{c:o,e:r}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(t,e){null!=e&&(t._anchor=e)}},{key:"setConnectionAnchors",value:function(t,e){t.endpoints[0]._anchor=e[0],t.endpoints[1]._anchor=e[1]}},{key:"_calculateOrientation",value:function(t,e,n,i,o,r,s,a){var l=this;if(t===e)return{orientation:"identity",a:[ae,ae]};var c=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),u=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),h=[],d={};!function(t,e){for(var n=0;n<t.length;n++){var i;if(d[t[n]]=(ct(i={},le,{x:e[n][0].x,y:e[n][0].c.y}),ct(i,ce,{x:e[n][0].x+e[n][0].w,y:e[n][0].c.y}),ct(i,ae,{x:e[n][0].c.x,y:e[n][0].y}),ct(i,ue,{x:e[n][0].c.x,y:e[n][0].y+e[n][0].h}),i),null!=e[n][1]&&e[n][1].length>0)for(var o in d[t[n]])d[t[n]][o]=l.instance._applyRotationsXY(d[t[n]][o],e[n][1])}}(["source","target"],[[n,s],[i,a]]);for(var p=[ae,le,ce,ue],f=0;f<p.length;f++)for(var v=0;v<p.length;v++)h.push({source:p[f],target:p[v],dist:Q(d.source[p[f]],d.target[p[v]])});h.sort((function(t,e){if(t.dist<e.dist)return-1;if(e.dist<t.dist)return 1;var n,i=(ct(n={},le,0),ct(n,ae,1),ct(n,ce,2),ct(n,ue,3),n),o=i[t.source],r=i[e.source],s=i[t.target],a=i[e.target];return o<r?-1:r<o?1:s<a?-1:a<s?1:0}));for(var y=h[0].source,g=h[0].target,m=0;m<h.length&&(y=nn(o)&&o.locked?o.currentFace:!o.isContinuous||_e(o,h[m].source)?h[m].source:null,g=r.isContinuous&&r.locked?r.currentFace:!r.isContinuous||_e(r,h[m].target)?h[m].target:null,null==y||null==g);m++);return o.isContinuous&&this.setCurrentFace(o,y),r.isContinuous&&this.setCurrentFace(r,g),{a:[y,g],theta:c,theta2:u}}},{key:"setCurrentFace",value:function(t,e,n){t.currentFace=e,n&&null!=t.lockedFace&&(t.lockedFace=t.currentFace)}},{key:"lock",value:function(t){t.locked=!0,nn(t)&&(t.lockedFace=t.currentFace)}},{key:"unlock",value:function(t){t.locked=!1,nn(t)&&(t.lockedFace=null)}},{key:"selectAnchorLocation",value:function(t,e){var n=m(t.locations,(function(t){return t.x===e.x&&t.y===e.y}));return-1!==n&&(t.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(t){null!=t.currentFace&&(t.lockedAxis=t.currentFace===le||t.currentFace===ce?he:de)}},{key:"unlockCurrentAxis",value:function(t){t.lockedAxis=null}},{key:"anchorsEqual",value:function(t,e){if(!t||!e)return!1;var n=t.locations[t.currentLocation],i=e.locations[e.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),t}(),ln=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];st(this,t),this.selector=e,this.def=n,this.exclude=i,ct(this,"id",void 0),ct(this,"redrop",void 0),this.id=j(),this.redrop=n.def.redrop||cn}return lt(t,[{key:"setEnabled",value:function(t){this.def.enabled=t}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),t}(),cn="strict";function un(t,e,n){var i=[],o=function(e){return c(e)?e:t.getId(e)};if(e)if("string"==typeof e){if("*"===e)return e;i.push(e)}else{var r;if(n)i=e;else if(null!=e.length)(r=i).push.apply(r,mt(mt(e).map(o)));else i.push(o(e))}return i}function hn(t,e,n){null!=e&&(e.connections.push(t),1===e.connections.length&&t.instance.addClass(t.source,t.instance.connectedClass)),null!=n&&(null!=e&&t.sourceId===t.targetId||(n.connections.push(t),1===n.connections.length&&t.instance.addClass(t.target,t.instance.connectedClass)))}function dn(t,e,n){if(null!=e){var i=e.connections.length;k(e.connections,(function(e){return t.id===e.id})),i>0&&0===e.connections.length&&t.instance.removeClass(t.source,t.instance.connectedClass)}if(null!=n){var o=n.connections.length;null!=e&&t.sourceId===t.targetId||k(n.connections,(function(e){return t.id===e.id})),o>0&&0===n.connections.length&&t.instance.removeClass(t.target,t.instance.connectedClass)}}var pn=function(t){ut(n,t);var e=vt(n);function n(t,i){var o;return st(this,n),(o=e.call(this))._instanceIndex=t,ct(pt(o),"defaults",void 0),ct(pt(o),"_initialDefaults",{}),ct(pt(o),"isConnectionBeingDragged",!1),ct(pt(o),"currentlyDragging",!1),ct(pt(o),"hoverSuspended",!1),ct(pt(o),"_suspendDrawing",!1),ct(pt(o),"_suspendedAt",null),ct(pt(o),"connectorClass","jtk-connector"),ct(pt(o),"connectorOutlineClass","jtk-connector-outline"),ct(pt(o),"connectedClass","jtk-connected"),ct(pt(o),"endpointClass",Nt),ct(pt(o),"endpointConnectedClass","jtk-endpoint-connected"),ct(pt(o),"endpointFullClass","jtk-endpoint-full"),ct(pt(o),"endpointFloatingClass",zt),ct(pt(o),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),ct(pt(o),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),ct(pt(o),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),ct(pt(o),"overlayClass","jtk-overlay"),ct(pt(o),"connections",[]),ct(pt(o),"endpointsByElement",{}),ct(pt(o),"endpointsByUUID",new Map),ct(pt(o),"sourceSelectors",[]),ct(pt(o),"targetSelectors",[]),ct(pt(o),"allowNestedGroups",void 0),ct(pt(o),"_curIdStamp",1),ct(pt(o),"viewport",new Qe(pt(o))),ct(pt(o),"router",void 0),ct(pt(o),"groupManager",void 0),ct(pt(o),"_connectionTypes",new Map),ct(pt(o),"_endpointTypes",new Map),ct(pt(o),"_container",void 0),ct(pt(o),"_managedElements",{}),ct(pt(o),"DEFAULT_SCOPE",void 0),ct(pt(o),"_zoom",1),o.defaults={anchor:Y.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:Ot.type,container:null,endpoint:wt.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},i&&a(o.defaults,i),a(o._initialDefaults,o.defaults),null!=o._initialDefaults.paintStyle&&(o._initialDefaults.paintStyle.strokeWidth=o._initialDefaults.paintStyle.strokeWidth||2),o.DEFAULT_SCOPE=o.defaults.scope,o.allowNestedGroups=!1!==o._initialDefaults.allowNestedGroups,o.router=new an(pt(o)),o.groupManager=new Ne(pt(o)),o.setContainer(o._initialDefaults.container),o}return lt(n,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(t){return null!=t&&null!=t[0]&&null!=t[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(t,e){return this._zoom=t,this.fire("zoom",this._zoom),e&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(t,e){var n=this.getListener(t),i=!0;if(n&&n.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var r=0,s=n.length;r<s;r++)i=i&&n[r].apply(n[r],o)}catch(e){T("cannot check condition ["+t+"]"+e)}}return i}},{key:"getId",value:function(t,e){if(null==t)return null;var n=this.getAttribute(t,"data-jtk-managed");return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=e:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(t,"data-jtk-managed",n)),n}},{key:"getConnections",value:function(t,e){t?t.constructor===String&&(t={scope:t}):t={};for(var n=un(this,t.scope||this.defaultScope,!0),i=un(this,t.source),o=un(this,t.target),r=!e&&n.length>1?{}:[],a=function(t,i){if(!e&&n.length>1){var o=r[t];null==o&&(o=r[t]=[]),o.push(i)}else r.push(i)},l=0,c=this.connections.length;l<c;l++){var u=this.connections[l],h=u.proxies&&u.proxies[0]?u.proxies[0].originalEp.elementId:u.sourceId,d=u.proxies&&u.proxies[1]?u.proxies[1].originalEp.elementId:u.targetId;s(n,u.scope)&&s(i,h)&&s(o,d)&&a(u.scope,u)}return r}},{key:"select",value:function(t){return(t=t||{}).scope=t.scope||"*",new We(this,t.connections||this.getConnections(t,!0))}},{key:"selectEndpoints",value:function(t){(t=t||{}).scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":un(this,t.element),i=e?"*":un(this,t.source),o=e?"*":un(this,t.target),r=un(this,t.scope,!0),a=[];for(var l in this.endpointsByElement){var c=s(n,l,!0),u=s(i,l,!0),h="*"!==i,d=s(o,l,!0),p="*"!==o;if(c||u||d)t:for(var f=0,v=this.endpointsByElement[l].length;f<v;f++){var y=this.endpointsByElement[l][f];if(s(r,y.scope,!0)){var g=h&&i.length>0&&!y.isSource,m=p&&o.length>0&&!y.isTarget;if(g||m)continue t;a.push(y)}}}return new Ve(this,a)}},{key:"setContainer",value:function(t){this._container=t,this.fire("container:change",this._container)}},{key:"_set",value:function(t,e,n){var i,o,r=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],s=t[r.elId],a=t.endpoints[n],l={index:n,originalEndpoint:a,originalSourceId:0===n?s:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?s:t.targetId,newTargetId:t.targetId,connection:t,newEndpoint:a};return e instanceof Be?(i=e).addConnection(t):i=(o=this.getId(e))===t[r.elId]?null:t.makeEndpoint(0===n,e,o),null!=i&&(l.newEndpoint=i,a.detachFromConnection(t),t.endpoints[n]=i,t[r.el]=i.element,t[r.elId]=i.elementId,l[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(l),this._paintConnection(t)),l}},{key:"setSource",value:function(t,e){dn(t,this._managedElements[t.sourceId]);var n=this._set(t,e,0);hn(t,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(t,e){dn(t,this._managedElements[t.targetId]);var n=this._set(t,e,1);hn(t,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function(t,e,n){t.setType(e,n),this._paintConnection(t)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(t,e){var n=this._suspendDrawing;return this._suspendDrawing=t,t?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),e&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(t,e){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),t(),n||this.setSuspendDrawing(!1,!e)}},{key:"each",value:function(t,e){if(null!=t){if(null!=t.length)for(var n=0;n<t.length;n++)e(t[n]);else e(t);return this}}},{key:"updateOffset",value:function(t){var e=t.elId;return t.recalc?this.viewport.refreshElement(e):this.viewport.getPosition(e)}},{key:"deleteConnection",value:function(t,e){if(null!=t&&!0!==t.deleted&&((e=e||{}).force||v(!0,!1,[[t.endpoints[0],"isDetachAllowed",[t]],[t.endpoints[1],"isDetachAllowed",[t]],[t,"isDetachAllowed",[t]],[this,"checkCondition",["beforeDetach",t]]]))){dn(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this.fireDetachEvent(t,!t.pending&&!1!==e.fireEvent,e.originalEvent);var n=t.endpoints[0],i=t.endpoints[1];return n!==e.endpointToIgnore&&n.detachFromConnection(t,null,!0),i!==e.endpointToIgnore&&i.detachFromConnection(t,null,!0),k(this.connections,(function(e){return t.id===e.id})),t.destroy(),n!==e.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==e.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(t){var e=this;t=t||{};var n=this.connections.length,i=0;return this.batch((function(){for(var o=0;o<n;o++)i+=e.deleteConnection(e.connections[0],t)?1:0})),i}},{key:"deleteConnectionsForElement",value:function(t,e){var n=this.getId(t),i=this._managedElements[n];if(i)for(var o=i.connections.length,r=0;r<o;r++)this.deleteConnection(i.connections[0],e);return this}},{key:"fireDetachEvent",value:function(t,e,n){var i=null!=t.id?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&this.fire("connection:detach",i,n),this.fire("internal.connection:detached",i,n)}},{key:"fireMoveEvent",value:function(t,e){this.fire("connection:move",t,e)}},{key:"manageAll",value:function(t,e){for(var n=c(t)?this.getSelector(this.getContainer(),t):t,i=0;i<n.length;i++)this.manage(n[i],null,e)}},{key:"manage",value:function(t,e,n){null==this.getAttribute(t,"data-jtk-managed")&&(e=e||this.getAttribute(t,"id")||j(),this.setAttribute(t,"data-jtk-managed",e));var i=this.getId(t);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:t,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire("element:manage",{el:t})}return this._managedElements[i]}},{key:"getManagedData",value:function(t,e,n){if(this._managedElements[t]){var i=this._managedElements[t].data[e];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(t,e,n,i){this._managedElements[t]&&(this._managedElements[t].data[e]=this._managedElements[t].data[e]||{},this._managedElements[t].data[e][n]=i)}},{key:"getManagedElement",value:function(t){return this._managedElements[t]?this._managedElements[t].el:null}},{key:"unmanage",value:function(t,e){var n=this;this.removeAllEndpoints(t,!0);var i=function(t){var i=n.getId(t);n.removeAttribute(t,"data-jtk-managed"),delete n._managedElements[i],n.viewport.remove(i),n.fire("element:unmanage",{el:t,id:i}),t&&e&&n._removeElement(t)};this._getAssociatedElements(t).map(i),i(t)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]&&(this._managedElements[i].rotation=e,this.viewport.rotateElement(i,e),!0!==n)?this.revalidate(t):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(t){var e=this._managedElements[t];return null!=e&&e.rotation||0}},{key:"_getRotations",value:function(t){var e=this,n=[],i=this._managedElements[t];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function t(i){if(null!=i.group){var o=e._managedElements[i.group];null!=o&&(n.push({r:o.viewportElement.r,c:o.viewportElement.c}),t(o))}}(i)),n}},{key:"_applyRotations",value:function(t,e){var n=t.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return g(e,(function(t){i=A(i,t.c,t.r)})),i}},{key:"_applyRotationsXY",value:function(t,e){return g(e,(function(e){t=A(t,e.c,e.r)})),t}},{key:"_internal_newEndpoint",value:function(t){var e=a({},t),n=this.manage(e.element);e.elementId=this.getId(e.element),e.id="ep_"+this._idstamp();var i=new Be(this,e);return function(t,e){null!=t&&t.endpoints.push(e)}(n,i),t.uuid&&this.endpointsByUUID.set(t.uuid,i),E(this.endpointsByElement,i.elementId,i),this._suspendDrawing||this._paintEndpoint(i,{timestamp:this._suspendedAt}),i}},{key:"_deriveEndpointAndAnchorSpec",value:function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),i=null,o=null,r=null,s=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(s=l.anchors),l.anchor&&(r=l.anchor))}return{endpoints:i||[o,o],anchors:s||[r,r]}}},{key:"revalidate",value:function(t,e){var n=this.getId(t);return this.updateOffset({elId:n,recalc:!0,timestamp:e}),this.repaint(t)}},{key:"repaintEverything",value:function(){var t,e=j();for(t in this._managedElements)this.viewport.refreshElement(t,!0);for(t in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(t,e,n){var i=this.getId(t);return this.viewport.setPosition(i,e,n),this.repaint(t)}},{key:"repaint",value:function(t,e,n){var i={c:new Set,e:new Set},o=function(t){t.c.forEach((function(t){return i.c.add(t)})),t.e.forEach((function(t){return i.e.add(t)}))};if(!this._suspendDrawing){var r=this.getId(t);if(null!=t){var s=this._getAssociatedElements(t);if(null==e&&(e=j()),!n)for(var a=0;a<s.length;a++)this.updateOffset({elId:this.getId(s[a]),recalc:!0,timestamp:e});if(o(this.router.redraw(r,e,null)),s.length>0)for(var l=0;l<s.length;l++)o(this.router.redraw(this.getId(s[l]),e,null))}}return i}},{key:"unregisterEndpoint",value:function(t){var e=t.getUuid();e&&this.endpointsByUUID.delete(e),function(t,e){null!=t&&k(t.endpoints,(function(t){return t===e}))}(this._managedElements[t.elementId],t);var n=this.endpointsByElement[t.elementId];null!=n&&(n.length>1?this.endpointsByElement[t.elementId]=n.filter((function(e){return e!==t})):delete this.endpointsByElement[t.elementId]),this.fire("internal.endpoint:unregistered",t)}},{key:"_maybePruneEndpoint",value:function(t){return!(!t.deleteOnEmpty||0!==t.connections.length)&&(this.deleteEndpoint(t),!0)}},{key:"deleteEndpoint",value:function(t){var e=this,n="string"==typeof t?this.endpointsByUUID.get(t):t;if(n){var i=n.proxiedBy,o=n.connections.slice();g(o,(function(t){n.detachFromConnection(t,null,!0)})),this.unregisterEndpoint(n),n.destroy(),g(o,(function(t){e.deleteConnection(t,{force:!0,endpointToIgnore:n})})),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(t,e,n){var i=a({},n=n||{});a(i,e||{});var o=a({element:t},i);return this._internal_newEndpoint(o)}},{key:"addEndpoints",value:function(t,e,n){for(var i=[],o=0,r=e.length;o<r;o++)i.push(this.addEndpoint(t,e[o],n));return i}},{key:"reset",value:function(){var t=this;this.silently((function(){t.endpointsByElement={},t._managedElements={},t.endpointsByUUID.clear(),t.viewport.reset(),t.router.reset(),t.groupManager.reset(),t.connections.length=0}))}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(t){return this.endpointsByElement[this.getId(t)]||[]}},{key:"getEndpoint",value:function(t){return this.endpointsByUUID.get(t)}},{key:"setEndpointUuid",value:function(t,e){t.uuid&&this.endpointsByUUID.delete(t.uuid),t.uuid=e,this.endpointsByUUID.set(e,t)}},{key:"connect",value:function(t,e){try{var n=this._prepareConnectionParams(t,e),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(t){return void T(t)}}},{key:"_prepareConnectionParams",value:function(t,e){var n=a({},t);e&&a(n,e);var i=n;if(i.source&&i.source.endpoint&&(i.sourceEndpoint=i.source),i.target&&i.target.endpoint&&(i.targetEndpoint=i.target),t.uuids&&(i.sourceEndpoint=this.getEndpoint(t.uuids[0]),i.targetEndpoint=this.getEndpoint(t.uuids[1])),null!=i.sourceEndpoint){if(i.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(i.type||(i.type=i.sourceEndpoint.edgeType),i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var o=0,r=i.sourceEndpoint.connectorOverlays.length;o<r;o++)i.overlays.push(i.sourceEndpoint.connectorOverlays[o])}i.sourceEndpoint.scope&&(i.scope=i.sourceEndpoint.scope)}else if(null==i.source)throw"Cannot establish connection: source does not exist";if(null!=i.targetEndpoint){if(i.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(null==i.target)throw"Cannot establish connection: target does not exist";if(i.sourceEndpoint&&i.targetEndpoint&&!function(t,e){for(var n=t.scope.split(/\s/),i=e.scope.split(/\s/),o=0;o<n.length;o++)for(var r=0;r<i.length;r++)if(i[r]===n[o])return!0;return!1}(i.sourceEndpoint,i.targetEndpoint))throw"Cannot establish connection: scopes do not match";return i}},{key:"_newConnection",value:function(t){t.id="con_"+this._idstamp();var e=new Le(this,t);return hn(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this._paintConnection(e),e}},{key:"_finaliseConnection",value:function(t,e,n){e=e||{},t.suspendedEndpoint||this.connections.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,this.repaint(t.source);var i={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};this.fire("internal.connection",i,n),e.doNotFireConnectionEvent||!1===e.fireEvent||this.fire("connection",i,n)}},{key:"removeAllEndpoints",value:function(t,e){var n=this,i=function(t){var e,i,o=n.getId(t),r=n.endpointsByElement[o];if(r)for(e=0,i=r.length;e<i;e++)n.deleteEndpoint(r[e]);delete n.endpointsByElement[o]};return e&&this._getAssociatedElements(t).map(i),i(t),this}},{key:"_createSourceDefinition",value:function(t,e){var n=a({},e);a(n,t),n.edgeType=n.edgeType||rt;var i=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||i.endpoints[0],n.anchor=n.anchor||i.anchors[0];var o=n.maxConnections||-1;return{def:a({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createSourceDefinition(e),o=new ln(t,i,n);return this.sourceSelectors.push(o),o}},{key:"removeSourceSelector",value:function(t){k(this.sourceSelectors,(function(e){return e===t}))}},{key:"removeTargetSelector",value:function(t){k(this.targetSelectors,(function(e){return e===t}))}},{key:"addTargetSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createTargetDefinition(e),o=new ln(t,i,n);return this.targetSelectors.push(o),o}},{key:"_createTargetDefinition",value:function(t,e){var n=a({},e);a(n,t),n.edgeType=n.edgeType||rt;var i=n.maxConnections||-1;return{def:a({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:i,enabled:!0,endpoint:null}}},{key:"show",value:function(t,e){return this._setVisible(t,"block",e)}},{key:"hide",value:function(t,e){return this._setVisible(t,"none",e)}},{key:"_setVisible",value:function(t,e,n){var i="block"===e,o=null;n&&(o=function(t){t.setVisible(i,!0,!0)});var r=this.getId(t);return this._operation(t,(function(t){if(i&&n){var e=t.sourceId===r?1:0;t.endpoints[e].isVisible()&&t.setVisible(!0)}else t.setVisible(i)}),o),this}},{key:"toggleVisible",value:function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),this._operation(t,(function(t){var e=t.isVisible();t.setVisible(!e)}),n)}},{key:"_operation",value:function(t,e,n){var i=this.getId(t),o=this.endpointsByElement[i];if(o&&o.length)for(var r=0,s=o.length;r<s;r++){for(var a=0,l=o[r].connections.length;a<l;a++){if(e(o[r].connections[a]))return}n&&n(o[r])}}},{key:"registerConnectionType",value:function(t,e){if(this._connectionTypes.set(t,a({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=Wt(e.overlays[i]);n[o.options.id]=o}this._connectionTypes.get(t).overlays=n}}},{key:"registerConnectionTypes",value:function(t){for(var e in t)this.registerConnectionType(e,t[e])}},{key:"registerEndpointType",value:function(t,e){if(this._endpointTypes.set(t,a({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=Wt(e.overlays[i]);n[o.options.id]=o}this._endpointTypes.get(t).overlays=n}}},{key:"registerEndpointTypes",value:function(t){for(var e in t)this.registerEndpointType(e,t[e])}},{key:"getType",value:function(t,e){return"connection"===e?this.getConnectionType(t):this.getEndpointType(t)}},{key:"getConnectionType",value:function(t){return this._connectionTypes.get(t)}},{key:"getEndpointType",value:function(t){return this._endpointTypes.get(t)}},{key:"importDefaults",value:function(t){for(var e in t)this.defaults[e]=t[e];return null!=this.defaults.paintStyle&&(this.defaults.paintStyle.strokeWidth=this.defaults.paintStyle.strokeWidth||2),t.container&&this.setContainer(t.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=a({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(t,e,n,i,o){var r,s=null!=t.proxies[e],a=s?t.proxies[e].originalEp.elementId:t.endpoints[e].elementId,l=s?t.proxies[e].originalEp:t.endpoints[e],c=this.getId(n);t.proxies[e]?t.proxies[e].ep.elementId===c?r=t.proxies[e].ep:(t.proxies[e].ep.detachFromConnection(t,e),r=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}})):r=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}}),r.deleteOnEmpty=!0,t.proxies[e]={ep:r,originalEp:l},this.sourceOrTargetChanged(a,c,t,n,e),l.detachFromConnection(t,null,!0),r.connections=[t],t.endpoints[e]=r,l.proxiedBy=r,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(t,e){if(null!=t.proxies&&null!=t.proxies[e]){var n=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId,o=t.proxies[e].ep.elementId;t.endpoints[e]=t.proxies[e].originalEp,delete t.proxies[e].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,t,n,e),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),t.proxies[e]=null,-1===m(t.proxies,(function(t){return null!=t}))&&(t.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(t,e,n,i,o){t!==e&&(0===o?(n.sourceId=e,n.source=i):1===o&&(n.targetId=e,n.target=i),dn(n,this._managedElements[t]),hn(n,this._managedElements[e]))}},{key:"getGroup",value:function(t){return this.groupManager.getGroup(t)}},{key:"getGroupFor",value:function(t){return this.groupManager.getGroupFor(t)}},{key:"addGroup",value:function(t){return this.groupManager.addGroup(t)}},{key:"addToGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(e=this.groupManager).addToGroup.apply(e,[t,!1].concat(i))}},{key:"collapseGroup",value:function(t){this.groupManager.collapseGroup(t)}},{key:"expandGroup",value:function(t){this.groupManager.expandGroup(t)}},{key:"toggleGroup",value:function(t){this.groupManager.toggleGroup(t)}},{key:"removeGroup",value:function(t,e,n,i){return this.groupManager.removeGroup(t,e,n,i)}},{key:"removeAllGroups",value:function(t,e){this.groupManager.removeAllGroups(t,e,!1)}},{key:"removeFromGroup",value:function(t,e,n){this.groupManager.removeFromGroup(t,n,e),this._appendElement(e,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(e)})}},{key:"_paintEndpoint",value:function(t,e){var n=(e=e||{}).timestamp,i=!(!1===e.recalc);if(!n||t.timestamp!==n){var o=this.viewport.getPosition(t.elementId),r=e.offset?{x:e.offset.x,y:e.offset.y}:{x:o.x,y:o.y};if(null!=r){var s=e.anchorLoc;if(null==s){var a={xy:r,wh:o,element:t,timestamp:n};if(i&&this.router.isDynamicAnchor(t)&&t.connections.length>0){var l=function(t){var n=0;if(null!=e.elementWithPrecedence)for(var i=0;i<t.connections.length;i++)if(t.connections[i].sourceId===e.elementWithPrecedence||t.connections[i].targetId===e.elementWithPrecedence){n=i;break}return t.connections[n]}(t),c=l.endpoints[0]===t?1:0,u=0===c?l.sourceId:l.targetId,h=this.viewport.getPosition(u);a.index=0===c?1:0,a.connection=l,a.txy=h,a.twh=h,a.tElement=l.endpoints[c],a.tRotation=this._getRotations(u)}else t.connections.length>0&&(a.connection=t.connections[0]);a.rotation=this._getRotations(t.elementId),s=this.router.computeAnchorLocation(t._anchor,a)}for(var d in t.endpoint.compute(s,this.router.getEndpointOrientation(t),t.paintStyleInUse),this.renderEndpoint(t,t.paintStyleInUse),t.timestamp=n,t.overlays)if(t.overlays.hasOwnProperty(d)){var p=t.overlays[d];p.isVisible()&&(t.overlayPlacements[d]=this.drawOverlay(p,t.endpoint,t.paintStyleInUse,t.getAbsoluteOverlayPosition(p)),this._paintOverlay(p,t.overlayPlacements[d],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(t,e){if(!this._suspendDrawing&&!1!==t.visible){var n=(e=e||{}).timestamp;if(null!=n&&n===t.lastPaintedAt)return;if(null==n||n!==t.lastPaintedAt){this.router.computePath(t,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var o in t.overlays)if(t.overlays.hasOwnProperty(o)){var r=t.overlays[o];r.isVisible()&&(t.overlayPlacements[o]=this.drawOverlay(r,t.connector,t.paintStyleInUse,t.getAbsoluteOverlayPosition(r)),i.xmin=Math.min(i.xmin,t.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,t.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,t.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,t.overlayPlacements[o].ymax))}var s=parseFloat(""+t.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+t.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(t.connector.bounds.xmin-(s+a),i.xmin),ymin:Math.min(t.connector.bounds.ymin-(s+a),i.ymin),xmax:Math.max(t.connector.bounds.xmax+(s+a),i.xmax),ymax:Math.max(t.connector.bounds.ymax+(s+a),i.ymax)};for(var c in this.paintConnector(t.connector,t.paintStyleInUse,l),t.overlays)if(t.overlays.hasOwnProperty(c)){var u=t.overlays[c];u.isVisible()&&this._paintOverlay(u,t.overlayPlacements[c],l)}}t.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(t){t._anchor.isFloating||(t.connections.length>0?this.addEndpointClass(t,this.endpointConnectedClass):this.removeEndpointClass(t,this.endpointConnectedClass),t.isFull()?this.addEndpointClass(t,this.endpointFullClass):this.removeEndpointClass(t,this.endpointFullClass))}},{key:"_makeConnector",value:function(t,e,n){return Lt(t,e,n)}},{key:"addOverlay",value:function(t,e,n){if(t.addOverlay(e),!n){var i=t instanceof Be?t.element:t.source;this.revalidate(i)}}},{key:"removeOverlay",value:function(t,e){t.removeOverlay(e);var n=t instanceof Be?t.element:t.source;this.revalidate(n)}},{key:"setOutlineColor",value:function(t,e){t.paintStyleInUse.outlineStroke=e,this._paintConnection(t)}},{key:"setOutlineWidth",value:function(t,e){t.paintStyleInUse.outlineWidth=e,this._paintConnection(t)}},{key:"setColor",value:function(t,e){t.paintStyleInUse.stroke=e,this._paintConnection(t)}},{key:"setLineWidth",value:function(t,e){t.paintStyleInUse.strokeWidth=e,this._paintConnection(t)}},{key:"setLineStyle",value:function(t,e){null!=e.lineWidth&&(t.paintStyleInUse.strokeWidth=e.lineWidth),null!=e.outlineWidth&&(t.paintStyleInUse.outlineWidth=e.outlineWidth),null!=e.color&&(t.paintStyleInUse.stroke=e.color),null!=e.outlineColor&&(t.paintStyleInUse.outlineStroke=e.outlineColor),this._paintConnection(t)}},{key:"getPathData",value:function(t){for(var e="",n=0;n<t.segments.length;n++)e+=t.segments[n].getPath(0===n),e+=" ";return e}}]),n}(U);function fn(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<1e-10?e:n-t<1e-10?n:t}var vn=function(t){ut(n,t);var e=vt(n);function n(t){var i;st(this,n),ct(pt(i=e.call(this,t)),"type",n.segmentType),ct(pt(i),"cx",void 0),ct(pt(i),"cy",void 0),ct(pt(i),"radius",void 0),ct(pt(i),"anticlockwise",void 0),ct(pt(i),"startAngle",void 0),ct(pt(i),"endAngle",void 0),ct(pt(i),"sweep",void 0),ct(pt(i),"length",void 0),ct(pt(i),"circumference",void 0),ct(pt(i),"frac",void 0),i.cx=t.cx,i.cy=t.cy,i.radius=t.r,i.anticlockwise=t.ac,t.startAngle&&t.endAngle?(i.startAngle=t.startAngle,i.endAngle=t.endAngle,i.x1=i.cx+i.radius*Math.cos(i.startAngle),i.y1=i.cy+i.radius*Math.sin(i.startAngle),i.x2=i.cx+i.radius*Math.cos(i.endAngle),i.y2=i.cy+i.radius*Math.sin(i.endAngle)):(i.startAngle=i._calcAngle(i.x1,i.y1),i.endAngle=i._calcAngle(i.x2,i.y2)),i.endAngle<0&&(i.endAngle+=J),i.startAngle<0&&(i.startAngle+=J);var o=i.endAngle<i.startAngle?i.endAngle+J:i.endAngle;return i.sweep=Math.abs(o-i.startAngle),i.anticlockwise&&(i.sweep=J-i.sweep),i.circumference=2*Math.PI*i.radius,i.frac=i.sweep/J,i.length=i.circumference*i.frac,i.extents={xmin:i.cx-i.radius,xmax:i.cx+i.radius,ymin:i.cy-i.radius,ymax:i.cy+i.radius},i}return lt(n,[{key:"_calcAngle",value:function(t,e){return n={x:this.cx,y:this.cy},o=$(n,i={x:t,y:e}),r=Math.atan(o),4!=(s=K(n,i))&&3!=s||(r+=Math.PI),r<0&&(r+=2*Math.PI),r;var n,i,o,r,s}},{key:"_calcAngleForLocation",value:function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+J:t.startAngle;return n-Math.abs(n-t.endAngle)*e}var i=t.endAngle<t.startAngle?t.endAngle+J:t.endAngle,o=Math.abs(i-t.startAngle);return t.startAngle+o*e}},{key:"getPath",value:function(t){var e=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(t?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+e+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(t,e){if(0===t)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===t)return{x:this.x2,y:this.y2,theta:this.endAngle};e&&(t/=length);var n=this._calcAngleForLocation(this,t),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:fn(i),y:fn(o),theta:n}}},{key:"gradientAtPoint",value:function(t,e){var n=this.pointOnPath(t,e),i=-1/$({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-1/0||(i*=-1),i}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e/this.circumference*2*Math.PI,r=this.anticlockwise?-1:1,s=i.theta+r*o;return{x:this.cx+this.radius*Math.cos(s),y:this.cy+this.radius*Math.sin(s)}}}]),n}(ot);ct(vn,"segmentType","Arc");var yn=function(t){ut(n,t);var e=vt(n);function n(t,i,o){var r;return st(this,n),(r=e.call(this,t,i,o)).instance=t,r.component=i,ct(pt(r),"width",void 0),ct(pt(r),"length",void 0),ct(pt(r),"foldback",void 0),ct(pt(r),"direction",void 0),ct(pt(r),"location",.5),ct(pt(r),"paintStyle",void 0),ct(pt(r),"type",n.type),ct(pt(r),"cachedDimensions",void 0),o=o||{},r.width=o.width||20,r.length=o.length||20,r.direction=(o.direction||1)<0?-1:1,r.foldback=o.foldback||.623,r.paintStyle=o.paintStyle||{strokeWidth:1},r.location=null==o.location?r.location:Array.isArray(o.location)?o.location[0]:o.location,r}return lt(n,[{key:"draw",value:function(t,e,n){if(t instanceof Tt){var i,o,r,s=t;if(this.location>1||this.location<0){var a=this.location<0?1:0;o=et(i=s.pointAlongPathFrom(a,this.location,!1),s.pointAlongPathFrom(a,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(o=et(i=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var l=o;o=i,i=l}}else if(0===this.location){if(i=et(o=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var c=o;o=i,i=c}}else o=et(i=s.pointAlongPathFrom(this.location,this.direction*this.length/2),s.pointOnPath(this.location),this.length);var u={hxy:i,tail:r=function(t,e,n){var i=$(t,e),o=Math.atan(-1/i),r=n/2*Math.sin(o),s=n/2*Math.cos(o);return[{x:e.x+s,y:e.y+r},{x:e.x-s,y:e.y-r}]}(i,o,this.width),cxy:et(i,o,this.foldback*this.length)},h=this.paintStyle.stroke||e.stroke,d=this.paintStyle.fill||e.stroke;return{component:t,d:u,"stroke-width":this.paintStyle.strokeWidth||e.strokeWidth,stroke:h,fill:d,xmin:Math.min(i.x,r[0].x,r[1].x),xmax:Math.max(i.x,r[0].x,r[1].x),ymin:Math.min(i.y,r[0].y,r[1].y),ymax:Math.max(i.y,r[0].y,r[1].y)}}}},{key:"updateFrom",value:function(t){}}]),n}(Xt);function gn(t){return t.type===yn.type}ct(yn,"type","Arrow"),qt(yn.type,yn);var mn=function(t){ut(n,t);var e=vt(n);function n(t,i,o){var r;return st(this,n),(r=e.call(this,t,i,o)).instance=t,ct(pt(r),"type",n.type),r.foldback=1,r}return n}(yn);function _n(t){return t.type===mn.type}ct(mn,"type","PlainArrow"),qt("PlainArrow",mn);var xn=function(t){ut(n,t);var e=vt(n);function n(t,i,o){var r;return st(this,n),(r=e.call(this,t,i,o)).instance=t,ct(pt(r),"type",n.type),r.length=r.length/2,r.foldback=2,r}return n}(yn);function kn(t){return t.type===xn.type}ct(xn,"type","Diamond"),qt(xn.type,xn);var bn,Cn=function(t){ut(n,t);var e=vt(n);function n(t,i,o){var r;return st(this,n),(r=e.call(this,t,i,o)).instance=t,r.component=i,ct(pt(r),"create",void 0),ct(pt(r),"type",n.type),r.create=o.create,r}return lt(n,[{key:"updateFrom",value:function(t){}}]),n}(Xt);function En(t){return t.type===Cn.type}function Pn(t){return(Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function jn(t,e,n){return e&&Sn(t.prototype,e),n&&Sn(t,n),t}function An(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Mn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tn(t,e)}function Dn(t){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Tn(t,e){return(Tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function In(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function On(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?In(t):e}function Gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Dn(t);if(e){var o=Dn(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return On(this,n)}}function Ln(t,e,n){return(Ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Dn(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Fn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}(t,e)||Rn(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bn(t){return function(t){if(Array.isArray(t))return Hn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Rn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rn(t,e){if(t){if("string"==typeof t)return Hn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hn(t,e):void 0}}function Hn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Nn(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function zn(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()}function Vn(t,e,n,i){if(i&&Nn(t,e,n))return t;for(t=t.parentNode;null!=t&&t!==n;){if(Nn(t,e))return t;t=t.parentNode}}function Wn(t){return t.srcElement||t.target}function Xn(t){return null!=t.className?void 0===t.className.baseVal?t.className:t.className.baseVal:""}function Yn(t,e,n){var i=null==e?[]:Array.isArray(e)?e:e.split(/\s+/),o=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),r=Xn(t).split(/\s+/),s=function(t,e){for(var n=0;n<e.length;n++)if(t)-1===r.indexOf(e[n])&&r.push(e[n]);else{var i=r.indexOf(e[n]);-1!==i&&r.splice(i,1)}};s(!0,i),s(!1,o),function(t,e,n){e=M(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var i=t.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var o=0;o<n.length;o++)n[o]&&i.add(n[o])}}catch(t){T("WARN: cannot set class list",t)}}(t,r.join(" "),r)}function Un(t){return!c(t)&&!Array.isArray(t)&&null!=t.length&&null==t.documentElement&&null==t.nodeType}function qn(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?g(M(e).split(/\s+/),(function(e){t.classList.add(e)})):Yn(t,e))};Un(t)?g(t,(function(t){return n(t,e)})):n(t,e)}function Zn(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?M(e).split(/\s+/).forEach((function(e){t.classList.remove(e)})):Yn(t,null,e))};Un(t)?g(t,(function(t){return n(t,e)})):n(t,e)}function Jn(t,e,n,i){return $n(null,t,e,n,i)}function $n(t,e,n,i,o){var r,s=null==t?document.createElement(e):document.createElementNS(t,e);for(r in n=n||{})s.style[r]=n[r];for(r in i&&(s.className=i),o=o||{})s.setAttribute(r,""+o[r]);return s}function Qn(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,r=window.pageXOffset||i.scrollLeft||n.scrollLeft,s=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=e.top+o-s,c=e.left+r-a;return{x:Math.round(c),y:Math.round(l)}}function Kn(t,e){var n=e.getContainer().getBoundingClientRect(),i=t.getBoundingClientRect(),o=e.currentZoom;return{x:(i.left-n.left)/o,y:(i.top-n.top)/o}}function ti(t,e){var n=t.getBoundingClientRect(),i=e.currentZoom;return{w:n.width/i,h:n.height/i}}function ei(t){return t instanceof SVGElement?bn.SVG:bn.HTML}ct(Cn,"type","Custom"),qt(Cn.type,Cn),Et.registerHandler(St),Et.registerHandler(Dt),Et.registerHandler(At),Ft(Ot.type,Ot),function(t){t.SVG="SVG",t.HTML="HTML"}(bn||(bn={}));var ni={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},ii={svg:"http://www.w3.org/2000/svg"};function oi(t,e){for(var n in e)t.setAttribute(n,""+e[n])}function ri(t,e){return(e=e||{}).version="1.1",e.xmlns=ii.svg,$n(ii.svg,t,null,null,e)}function si(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"}function ai(t,e,n){if(e.setAttribute("fill",n.fill?n.fill:"none"),e.setAttribute("stroke",n.stroke?n.stroke:"none"),n.strokeWidth&&e.setAttribute("stroke-width",n.strokeWidth),n.dashstyle&&n.strokeWidth&&!n["stroke-dasharray"]){var i=-1===n.dashstyle.indexOf(",")?" ":",",o=n.dashstyle.split(i),r="";g(o,(function(t){r+=Math.floor(t*n.strokeWidth)+i})),e.setAttribute("stroke-dasharray",r)}else n["stroke-dasharray"]&&e.setAttribute("stroke-dasharray",n["stroke-dasharray"]);for(var s in ni)n[s]&&e.setAttribute(ni[s],n[s])}function li(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)}function ci(t,e,n){var i=[t,e];return n&&i.push(n),i.join(":")}var ui,hi,di="element",pi=ci(di,"click"),fi=ci(di,"dblclick"),vi=ci(di,"dbltap"),yi=ci(di,"mouseout"),gi=ci(di,"mouseover"),mi=ci(di,"mousemove"),_i=ci(di,"mouseup"),xi=ci(di,"mousedown"),ki=ci(di,"contextmenu"),bi=ci(di,"tap"),Ci=ci("endpoint","click"),Ei=ci("endpoint","dblclick"),Pi=(ci("endpoint","dbltap"),ci("endpoint","mouseout")),wi=ci("endpoint","mouseover"),Si=ci("endpoint","mouseup"),ji=ci("endpoint","mousedown"),Ai=(ci("endpoint","tap"),ci("connection","click")),Mi=ci("connection","dblclick"),Di=ci("connection","dbltap"),Ti=ci("connection","mouseout"),Ii=ci("connection","mouseover"),Oi=ci("connection","mouseup"),Gi=ci("connection","mousedown"),Li=ci("connection","contextmenu"),Fi=ci("connection","tap"),Bi=Bt("jtk-connector"),Ri=Bt(Nt),Hi=Rt("data-jtk-group"),Ni=Rt("data-jtk-group-content"),zi=Bt("jtk-overlay");function Vi(t,e,n,i,o,r,s){return function(){var t=[];return t.push.apply(t,arguments),t.item=function(t){return this[t]},t}(function(t,e,n,i,o,r,s){return new Touch({target:t,identifier:j(),pageX:e,pageY:n,screenX:i,screenY:o,clientX:r||i,clientY:s||o})}(t,e,n,i,o,r,s))}function Wi(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function Xi(t){return t.srcElement||t.target}function Yi(t,e,n,i){if(i){var o=t.composedPath?t.composedPath():t.path;if(void 0!==o&&o.indexOf)return{path:o,end:o.indexOf(n)};var r={path:[],end:-1};return function t(e){r.path.push(e),e===n?r.end=r.path.length-1:null!=e.parentNode&&t(e.parentNode)}(e),r}return{path:[e],end:1}}var Ui=1,qi=!1,Zi=!1;function Ji(){return qi||"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function $i(){return Zi||"onmousedown"in document.documentElement}var Qi=(An(ui={},"mousedown","touchstart"),An(ui,"mouseup","touchend"),An(ui,"mousemove","touchmove"),ui);function Ki(t,e){if(null==t)return{x:0,y:0};var n=eo(no(t),0);return{x:n[e+"X"],y:n[e+"Y"]}}function to(t){return Ki(t,"page")}function eo(t,e){return t.item?t.item(e):t[e]}function no(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]}function io(t,e,n,i,o){if(so(t,e,n),i.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1,o);else if(t.attachEvent){var r=e+n.__tauid;t["e"+r]=n,t[r]=function(){t["e"+r]&&t["e"+r](window.event)},t.attachEvent("on"+e,t[r])}}function oo(t,e,n){var i=this;null!=n&&ro(t,(function(o){if(function(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)oo(t,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(o,e,n),null!=n.__tauid)if(o.removeEventListener)o.removeEventListener(e,n,!1),Ji()&&Qi[e]&&o.removeEventListener(Qi[e],n,!1);else if(i.detachEvent){var r=e+n.__tauid;o[r]&&o.detachEvent("on"+e,o[r]),o[r]=null,o["e"+r]=null}n.__taTouchProxy&&oo(t,n.__taTouchProxy[1],n.__taTouchProxy[0])}))}function ro(t,e){if(null!=t)for(var n="string"==typeof t?document.querySelectorAll(t):null!=t.length?t:[t],i=0;i<n.length;i++)e(n[i])}function so(t,e,n){var i=Ui++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][i]=n,n.__tauid=i,i}var ao=/:not\(([^)]+)\)/;function lo(t,e,n,i){if(null==t)return n;var o=t.split(","),r=[],s=[];g(o,(function(t){var e=t.match(ao);null!=e?s.push(e[1]):r.push(t)})),s.length>0&&0===r.length&&r.push("*");var a=function i(o){i.__tauid=n.__tauid;var a=Xi(o),l=!1,c=a,u=Yi(o,a,e,null!=t);if(-1!=u.end)for(var h=0;!l&&h<u.end;h++){c=u.path[h];for(var d=0;d<s.length;d++)if(Wi(c,s[d],e))return;for(var p=0;!l&&p<r.length;p++)if(Wi(c,r[p],e)){n.apply(c,[o,c]),l=!0;break}}};return function(t,e,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,n])}(n,i,a),a}var co=function(t,e,n,i,o){if(Ji()&&Qi[e]){var r=lo(i,t,n,Qi[e]);io(t,Qi[e],r,n,o)}"focus"===e&&null==t.getAttribute("tabindex")&&t.setAttribute("tabindex","1"),io(t,e,lo(i,t,n,e),n,o)},uo=(An(hi={},"tap",{touches:1,taps:1}),An(hi,"dbltap",{touches:1,taps:2}),An(hi,"contextmenu",{touches:2,taps:1}),hi);function ho(t,e,n,i){for(var o in n.__tamee[t])n.__tamee[t].hasOwnProperty(o)&&n.__tamee[t][o].apply(i,[e])}var po=function(){function t(){wn(this,t)}return jn(t,null,[{key:"generate",value:function(t,e){return function(n,i,o,r){if("contextmenu"==i&&$i())co(n,i,o,r);else{if(null==n.__taTapHandler){var s=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var o=Xi(i),a=Yi(i,o,n,null!=r),l=!1,h=0;h<a.end;h++){if(l)return;o=a.path[h];for(var d=0;d<s.downSelectors.length;d++)if(null==s.downSelectors[d]||Wi(o,s.downSelectors[d],n)){s.down=!0,setTimeout(c,t),setTimeout(u,e),l=!0;break}}},l=function(t){if(s.down){var e,i,o=Xi(t);s.taps++;var r=function(t){return no(t).length}(t);for(var a in uo)if(uo.hasOwnProperty(a)){var l=uo[a];if(l.touches===r&&(1===l.taps||l.taps===s.taps))for(var c=0;c<s[a].length;c++){i=Yi(t,o,n,null!=s[a][c][1]);for(var u=0;u<i.end;u++)if(e=i.path[u],null==s[a][c][1]||Wi(e,s[a][c][1],n)){s[a][c][0].apply(e,[t,e]);break}}}}},c=function(){s.down=!1},u=function(){s.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,co(n,"mousedown",a),co(n,"mouseup",l)}n.__taTapHandler.downSelectors.push(r),n.__taTapHandler[i].push([o,r]),o.__taUnstore=function(){null!=n.__taTapHandler&&(k(n.__taTapHandler.downSelectors,(function(t){return t===r})),function(t,e){var n,i=0;for(i=0,n=t.length;i<n&&t[i][0]!==e;i++);i<t.length&&t.splice(i,1)}(n.__taTapHandler[i],o),0===n.__taTapHandler.downSelectors.length&&(oo(n,"mousedown",n.__taTapHandler.downHandler),oo(n,"mouseup",n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),t}(),fo=function(){function t(){wn(this,t)}return jn(t,null,[{key:"generate",value:function(){var t=[];return function(e,n,i,o){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var r=function(n){var i=Xi(n);(null==o&&i==e&&!e.__tamee.over||Wi(i,o,e)&&(null==i.__tamee||!i.__tamee.over))&&(ho("mouseenter",n,e,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,t.push(i))},s=function(n){for(var i=Xi(n),o=0;o<t.length;o++)i!=t[o]||Wi(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,t.splice(o,1),ho("mouseexit",n,e,i))};io(e,"mouseover",lo(o,e,r,"mouseover"),r),io(e,"mouseout",lo(o,e,s,"mouseout"),s)}i.__taUnstore=function(){delete e.__tamee[n][i.__tauid]},so(e,n,i),e.__tamee[n][i.__tauid]=i}}}]),t}(),vo=function(){function t(e){wn(this,t),An(this,"clickThreshold",void 0),An(this,"dblClickThreshold",void 0),An(this,"tapHandler",void 0),An(this,"mouseEnterExitHandler",void 0),e=e||{},this.clickThreshold=e.clickThreshold||250,this.dblClickThreshold=e.dblClickThreshold||450,this.mouseEnterExitHandler=fo.generate(),this.tapHandler=po.generate(this.clickThreshold,this.dblClickThreshold)}return jn(t,[{key:"_doBind",value:function(t,e,n,i,o){if(null!=n){var r=t;"tap"===e||"dbltap"===e||"contextmenu"===e?this.tapHandler(r,e,n,i,o):"mouseenter"===e||"mouseexit"==e?this.mouseEnterExitHandler(r,e,n,i,o):co(r,e,n,i,o)}}},{key:"on",value:function(t,e,n,i,o){var r=null==i?null:n,s=null==i?n:i;return this._doBind(t,e,s,r,o),this}},{key:"off",value:function(t,e,n){return oo(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){var r=$i()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),s=Ji()&&!$i()&&Qi[e]?Qi[e]:e,a=!(Ji()&&!$i()&&Qi[e]),l=to(n),c=Ki(n,"screen"),u=function(t){return Ki(t,"client")}(n);return ro(t,(function(t){var h;n=n||{screenX:c.x,screenY:c.y,clientX:u.x,clientY:u.y};var d,p={TouchEvent:function(e){var n=Vi(t,l.x,l.y,c.x,c.y,u.x,u.y);(e.initTouchEvent||e.initEvent)(s,!0,!0,window,null,c.x,c.y,u.x,u.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function(e){e.initMouseEvent(s,!0,!0,window,null==o?1:o,c.x,c.y,u.x,u.y,!1,!1,!1,!1,1,t)}},f=!a&&!r&&Ji()&&Qi[e]?"TouchEvent":"MouseEvents";h=document.createEvent(f),p[f](h),d=h,i&&(d.payload=i),t.dispatchEvent(h)})),this}}]),t}();function yo(t,e,n){if(Nn(e,n,t))return e;for(var i=e.parentNode;null!=i&&i!==t;){if(Nn(i,n,t))return i;i=i.parentNode}}function go(t,e,n){var i=e.parentNode,o=t.getSize(i),r=t.getSize(e),s=n.x,a=s+r.w,l=n.y,c=l+r.h;return a>0&&s<o.w&&c>0&&l<o.h}var mo,_o=function(){return!0},xo=function(){return!1},ko="katavorio-delegated-draggable",bo="katavorio-drag-no-select",Co="katavorio-ghost-proxy",Eo="katavorio-clone-drag";!function(t){t.absolutePosition="absolutePosition",t.transform="transform",t.xyAttributes="xyAttributes"}(mo||(mo={}));var Po=new Map;Po.set(mo.absolutePosition,(function(t,e){t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px")})),Po.set(mo.xyAttributes,(function(t,e){t.setAttribute("x","".concat(e.x)),t.setAttribute("y","".concat(e.y))}));var wo=new Map;wo.set(mo.absolutePosition,(function(t){return{x:t.offsetLeft,y:t.offsetTop}})),wo.set(mo.xyAttributes,(function(t){return{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y"))}}));var So=new Map;So.set(mo.absolutePosition,(function(t,e){t.style.width="".concat(e.w,"px"),t.style.height="".concat(e.h,"px")})),So.set(mo.xyAttributes,(function(t,e){t.setAttribute("width","".concat(e.w)),t.setAttribute("height","".concat(e.h))}));var jo=new Map;jo.set(mo.absolutePosition,(function(t){return{w:t.offsetWidth,h:t.offsetHeight}})),jo.set(mo.xyAttributes,(function(t){return{w:parseFloat(t.getAttribute("width")),h:parseFloat(t.getAttribute("height"))}}));var Ao,Mo=["stop","start","drag","drop","over","out","beforeStart"],Do=function(){},To=function(t,e){if(null!=t){t=c(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}},Io=function(){function t(e,n){wn(this,t),this.el=e,this.manager=n,An(this,"_class",void 0),An(this,"uuid",j()),An(this,"enabled",!0),An(this,"scopes",[]),An(this,"eventManager",void 0),this.eventManager=n.eventManager}return jn(t,[{key:"setEnabled",value:function(t){this.enabled=t}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(t){var e={};for(var n in To(this.scopes,(function(t){e[t]=!0})),To(t?t.split(/\s+/):[],(function(t){e[t]=!0})),this.scopes.length=0,e)this.scopes.push(n)}},{key:"removeScope",value:function(t){var e={};for(var n in To(this.scopes,(function(t){e[t]=!0})),To(t?t.split(/\s+/):[],(function(t){delete e[t]})),this.scopes.length=0,e)this.scopes.push(n)}},{key:"toggleScope",value:function(t){var e={};for(var n in To(this.scopes,(function(t){e[t]=!0})),To(t?t.split(/\s+/):[],(function(t){e[t]?delete e[t]:e[t]=!0})),this.scopes.length=0,e)this.scopes.push(n)}}]),t}();!function(t){t.notNegative="notNegative",t.parent="parent",t.parentEnclosed="parentEnclosed"}(Ao||(Ao={}));var Oo=function(t){Mn(n,t);var e=Gn(n);function n(t,i,o){var r;if(wn(this,n),An(In(r=e.call(this,t,o)),"_class",void 0),An(In(r),"rightButtonCanDrag",void 0),An(In(r),"consumeStartEvent",void 0),An(In(r),"clone",void 0),An(In(r),"scroll",void 0),An(In(r),"trackScroll",void 0),An(In(r),"_downAt",void 0),An(In(r),"_posAtDown",void 0),An(In(r),"_pagePosAtDown",void 0),An(In(r),"_pageDelta",{x:0,y:0}),An(In(r),"_moving",void 0),An(In(r),"_lastPosition",void 0),An(In(r),"_lastScrollValues",{x:0,y:0}),An(In(r),"_initialScroll",{x:0,y:0}),An(In(r),"_size",void 0),An(In(r),"_currentParentPosition",void 0),An(In(r),"_ghostParentPosition",void 0),An(In(r),"_dragEl",void 0),An(In(r),"_multipleDrop",void 0),An(In(r),"_ghostProxyOffsets",void 0),An(In(r),"_ghostDx",void 0),An(In(r),"_ghostDy",void 0),An(In(r),"_isConstrained",!1),An(In(r),"_ghostProxyParent",void 0),An(In(r),"_useGhostProxy",void 0),An(In(r),"_ghostProxyFunction",void 0),An(In(r),"_activeSelectorParams",void 0),An(In(r),"_availableSelectors",[]),An(In(r),"_canDrag",void 0),An(In(r),"_consumeFilteredEvents",void 0),An(In(r),"_parent",void 0),An(In(r),"_ignoreZoom",void 0),An(In(r),"_filters",{}),An(In(r),"_constrainRect",void 0),An(In(r),"_elementToDrag",void 0),An(In(r),"downListener",void 0),An(In(r),"moveListener",void 0),An(In(r),"upListener",void 0),An(In(r),"scrollTracker",void 0),An(In(r),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),r._class=r.manager.css.draggable,qn(r.el,r._class),r.downListener=r._downListener.bind(In(r)),r.upListener=r._upListener.bind(In(r)),r.moveListener=r._moveListener.bind(In(r)),r.rightButtonCanDrag=!0===i.rightButtonCanDrag,r.consumeStartEvent=!1!==i.consumeStartEvent,r._dragEl=r.el,r.clone=!0===i.clone,r.scroll=!0===i.scroll,r.trackScroll=!1!==i.trackScroll,r._multipleDrop=!1!==i.multipleDrop,r._canDrag=i.canDrag||_o,r._consumeFilteredEvents=i.consumeFilteredEvents,r._parent=i.parent,r._ignoreZoom=!0===i.ignoreZoom,r._ghostProxyParent=i.ghostProxyParent,r.trackScroll&&(r.scrollTracker=r._trackScroll.bind(In(r)),document.addEventListener("scroll",r.scrollTracker)),!0===i.ghostProxy?r._useGhostProxy=_o:i.ghostProxy&&"function"==typeof i.ghostProxy?r._useGhostProxy=i.ghostProxy:r._useGhostProxy=function(t,e){return!(!r._activeSelectorParams||!r._activeSelectorParams.useGhostProxy)&&r._activeSelectorParams.useGhostProxy(t,e)},i.makeGhostProxy?r._ghostProxyFunction=i.makeGhostProxy:r._ghostProxyFunction=function(t){return r._activeSelectorParams&&r._activeSelectorParams.makeGhostProxy?r._activeSelectorParams.makeGhostProxy(t):t.cloneNode(!0)},i.selector){var s=r.el.getAttribute("katavorio-draggable");null==s&&(s=""+(new Date).getTime(),r.el.setAttribute("katavorio-draggable",s)),r._availableSelectors.push(i)}return r.eventManager.on(r.el,"mousedown",r.downListener),r}return jn(n,[{key:"_trackScroll",value:function(t){if(this._moving){var e={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=e.x-this._lastScrollValues.x,i=e.y-this._lastScrollValues.y,o={x:n+this._lastPosition.x,y:i+this._lastPosition.y},r=o.x-this._downAt.x,s=o.y-this._downAt.y,a=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(r+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,s+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),r/=a,s/=a,this.moveBy(r,s,t),this._lastPosition=o,this._lastScrollValues=e}}},{key:"on",value:function(t,e){this.listeners[t]&&this.listeners[t].push(e)}},{key:"off",value:function(t,e){if(this.listeners[t]){for(var n=[],i=0;i<this.listeners[t].length;i++)this.listeners[t][i]!==e&&n.push(this.listeners[t][i]);this.listeners[t]=n}}},{key:"_upListener",value:function(t){this._downAt&&(this._downAt=null,this.eventManager.off(document,"mousemove",this.moveListener),this.eventManager.off(document,"mouseup",this.upListener),Zn(document.body,bo),this.unmark(t),this.stop(t),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch("revert",this._dragEl)))}},{key:"_downListener",value:function(t){if(!t.defaultPrevented&&((this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this._canDrag()))if(this._testFilter(t)&&function(t,e,n){return!Nn(t.srcElement||t.target,n.getInputFilterSelector(),e)}(t,this.el,this.manager)){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var e=t.target||t.srcElement,n=function(t,e,n){for(var i=null,o=e.getAttribute("katavorio-draggable"),r=null!=o?"[katavorio-draggable='"+o+"'] ":"",s=0;s<t.length;s++)if(null!=(i=yo(e,n,r+t[s].selector))){if(t[s].filter){var a=Nn(n,t[s].filter,i);if(!0===t[s].filterExclude&&!a||a)return null}return[t[s],i]}return null}(this._availableSelectors,this.el,e);if(null!=n&&(this._activeSelectorParams=n[0],this._elementToDrag=n[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var i=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,t):null;if(null!=i&&(this._elementToDrag=i),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),qn(this._dragEl,Eo),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var o=this.manager.getPosition(this.el);this._dragEl.style.left=o.x+"px",this._dragEl.style.top=o.y+"px",this._parent.appendChild(this._dragEl)}else{var r=Qn(this._elementToDrag);this._dragEl.style.left=r.x+"px",this._dragEl.style.top=r.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&zn(t),this._downAt=to(t),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=Qn(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,"mousemove",this.moveListener),this.eventManager.on(document,"mouseup",this.upListener),qn(document.body,bo),this._dispatch("beforeStart",{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size})}else this._consumeFilteredEvents&&zn(t)}},{key:"_moveListener",value:function(t){if(this._downAt){if(!this._moving){var e=this._dispatch("start",{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size});if(!1!==e){if(!this._downAt)return;this.mark(e),this._moving=!0}else this.abort()}if(this._downAt){var n=to(t),i=n.x-this._downAt.x,o=n.y-this._downAt.y,r=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=r,o/=r,this.moveBy(i,o,t)}}}},{key:"getDragDelta",value:function(){return null!=this._posAtDown&&null!=this._downAt?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(t){var e;this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=Qn(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),qn(this._dragEl,this.manager.css.drag),this._constrainRect={w:(e=this._dragEl).parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(t){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,Zn(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(t,e,n){var i=this.toGrid({x:this._posAtDown.x+t,y:this._posAtDown.y+e}),o=this._doConstrain(i,this._dragEl,this._constrainRect,this._size,n);if(null!=o){if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==o.x||i.y!==o.y){if(!this._isConstrained){var r=this._ghostProxyFunction(this._elementToDrag);qn(r,Co),this._ghostProxyParent?(this._ghostProxyParent.appendChild(r),this._currentParentPosition=Qn(this._elementToDrag.parentNode),this._ghostParentPosition=Qn(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(r),this._dragEl=r,this._isConstrained=!0}o=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:o.x+this._ghostDx,y:o.y+this._ghostDy}),this._dispatch("drag",{el:this.el,pos:o,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(t){return t?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(t,e){if(e||this._moving){var n=[],i=this.manager.getPosition(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch("stop",{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:t,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(t,e){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[t])n=this._activeSelectorParams[t](e);else if(this.listeners[t])for(var i=0;i<this.listeners[t].length;i++)try{var o=this.listeners[t][i](e);null!=o&&(n=o)}catch(t){}return n}},{key:"resolveGrid",value:function(){var t={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(t.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(t.thresholdX=this._activeSelectorParams.snapThreshold,t.thresholdY=this._activeSelectorParams.snapThreshold)),t}},{key:"toGrid",value:function(t){var e=this.resolveGrid(),n=e.grid,i=e.thresholdX,o=e.thresholdY;return null==n?t:function(t,e,n,i){n=null==n?null==e.thresholdX?e.w/2:e.thresholdX:n,i=null==i?null==e.thresholdY?e.h/2:e.thresholdY:i;var o=Math.floor(t.x/e.w),r=e.w*o,s=r+e.w,a=Math.abs(t.x-r)<=n?r:Math.abs(s-t.x)<=n?s:t.x,l=Math.floor(t.y/e.h),c=e.h*l,u=c+e.h;return{x:a,y:Math.abs(t.y-c)<=i?c:Math.abs(u-t.y)<=i?u:t.y}}(t,n,n?n.w/2:i,n?n.h/2:o)}},{key:"setUseGhostProxy",value:function(t){this._useGhostProxy=t?_o:xo}},{key:"_doConstrain",value:function(t,e,n,i,o){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(t,e,n,i,o):t}},{key:"_testFilter",value:function(t){for(var e in this._filters){var n=this._filters[e],i=n[0](t);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(t,e){var n,i=this;if(t){var o="function"==typeof(n=t)?(n._katavorioId=j(),n._katavorioId):n;this._filters[o]=[function(e){var n,o=e.srcElement||e.target;return c(t)?n=Nn(o,t,i.el):"function"==typeof t&&(n=t(e,i.el)),n},!1!==e]}}},{key:"removeFilter",value:function(t){var e="function"==typeof t?t._katavorioId:t;delete this._filters[e]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(t,e){t.selector&&(e?this._availableSelectors.unshift(t):this._availableSelectors.push(t))}},{key:"destroy",value:function(){this.eventManager.off(this.el,"mousedown",this.downListener),this.eventManager.off(document,"mousemove",this.moveListener),this.eventManager.off(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),n}(Io),Go=["input","textarea","select","button","option"].join(","),Lo=function(){function t(e){wn(this,t),An(this,"eventManager",void 0),An(this,"zoom",1),An(this,"css",{}),An(this,"inputFilterSelector",void 0),An(this,"positioningStrategy",void 0),An(this,"_positionSetter",void 0),An(this,"_positionGetter",void 0),An(this,"_sizeSetter",void 0),An(this,"_sizeGetter",void 0),e=e||{},this.inputFilterSelector=e.inputFilterSelector||Go,this.eventManager=new vo,this.zoom=e.zoom||1,this.positioningStrategy=e.positioningStrategy||mo.absolutePosition,this._positionGetter=wo.get(this.positioningStrategy),this._positionSetter=Po.get(this.positioningStrategy),this._sizeGetter=jo.get(this.positioningStrategy),this._sizeSetter=So.get(this.positioningStrategy);var n=e.css||{};a(this.css,n)}return jn(t,[{key:"getPosition",value:function(t){return this._positionGetter(t)}},{key:"setPosition",value:function(t,e){this._positionSetter(t,e)}},{key:"getSize",value:function(t){return this._sizeGetter(t)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(t){this.zoom=t}},{key:"_prepareParams",value:function(t){t=t||{};var e,n={events:{}};for(e in t)n[e]=t[e];for(e=0;e<Mo.length;e++)n.events[Mo[e]]=t[Mo[e]]||Do;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(t){return this.inputFilterSelector=t,this}},{key:"draggable",value:function(t,e){if(null==t._katavorioDrag){var n=this._prepareParams(e),i=new Oo(t,n,this);return qn(t,ko),t._katavorioDrag=i,i}return t._katavorioDrag}},{key:"destroyDraggable",value:function(t){t._katavorioDrag&&(t._katavorioDrag.destroy(),delete t._katavorioDrag)}}]),t}(),Fo=function(){function t(e){wn(this,t),this.instance=e,An(this,"_dragSelection",[]),An(this,"_dragSizes",new Map),An(this,"_dragElements",new Map),An(this,"_dragElementStartPositions",new Map),An(this,"_dragElementPositions",new Map),An(this,"__activeSet",void 0)}return jn(t,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(t){var e=this;this.__activeSet=[],g(this._dragSelection,(function(n){t(n)&&e.__activeSet.push(n)}))}},{key:"clear",value:function(){var t=this;this.reset(),g(this._dragSelection,(function(e){return t.instance.removeClass(e.jel,"jtk-drag-selected")})),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var t=this;g(this._activeSet,(function(e){var n=t.instance.viewport.getPosition(e.id),i={x:parseInt(""+e.jel.offsetLeft,10),y:parseInt(""+e.jel.offsetTop,10)};t._dragElementStartPositions.set(e.id,i),t._dragElementPositions.set(e.id,i),t._dragSizes.set(e.id,{w:n.w,h:n.h})}))}},{key:"updatePositions",value:function(t,e,n){var i=this,o=t.x-e.x,r=t.y-e.y;g(this._activeSet,(function(t){var e=i._dragElementStartPositions.get(t.id);if(e){var s=e.x+o,a=e.y+r,l=i._dragSizes.get(t.id),c={x:s,y:a,w:l.w,h:l.h};if(t.jel._jsPlumbParentGroup&&t.jel._jsPlumbParentGroup.constrain){var u={w:t.jel.parentNode.offsetWidth+t.jel.parentNode.scrollLeft,h:t.jel.parentNode.offsetHeight+t.jel.parentNode.scrollTop};c.x=Math.max(c.x,0),c.y=Math.max(c.y,0),c.x=Math.min(c.x,u.w-l.w),c.y=Math.min(c.y,u.h-l.h)}i._dragElementPositions.set(t.id,{x:s,y:a}),t.jel.style.left=c.x+"px",t.jel.style.top=c.y+"px",n(t.jel,t.id,l,c)}}))}},{key:"each",value:function(t){var e=this;g(this._activeSet,(function(n){var i=e._dragSizes.get(n.id),o=e._dragElementPositions.get(n.id),r=e._dragElementStartPositions.get(n.id);t(n.jel,n.id,o,i,r)}))}},{key:"add",value:function(t,e){var n=t;e=e||this.instance.getId(n),-1===m(this._dragSelection,(function(t){return t.id===e}))&&(this.instance.addClass(t,"jtk-drag-selected"),this._dragSelection.push({id:e,jel:n}))}},{key:"remove",value:function(t){var e=this,n=t;this._dragSelection=this._dragSelection.filter((function(t){var i=t.jel!==n;return i||e.instance.removeClass(t.jel,"jtk-drag-selected"),i}))}},{key:"toggle",value:function(t){var e=t;-1!==m(this._dragSelection,(function(t){return t.jel===e}))?this.remove(e):this.add(t)}}]),t}(),Bo=function(){function t(e,n,i){var o=this;wn(this,t),this.instance=e,this.dragSelection=n,An(this,"collicat",void 0),An(this,"drag",void 0),An(this,"_draggables",{}),An(this,"_dlist",[]),An(this,"_elementsWithEndpoints",{}),An(this,"_draggablesForElements",{}),An(this,"handlers",[]),An(this,"_trackScroll",void 0),An(this,"_filtersToAdd",[]),this.collicat=new Lo({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind("zoom",(function(t){o.collicat.setZoom(t)})),i=i||{},this._trackScroll=!1!==i.trackScroll}return jn(t,[{key:"addHandler",value:function(t,e){var n=this,i=a({selector:t.selector},e||{});i.start=O(i.start,(function(e){return t.onStart(e)}),!1),i.drag=O(i.drag,(function(e){return t.onDrag(e)})),i.stop=O(i.stop,(function(e){return t.onStop(e)}));var o=(t.onBeforeStart||function(t){}).bind(t);if(i.beforeStart=O(i.beforeStart,(function(t){return o(t)})),i.dragInit=function(e,n){return t.onDragInit(e,n)},i.dragAbort=function(e){return t.onDragAbort(e)},t.useGhostProxy&&(i.useGhostProxy=t.useGhostProxy,i.makeGhostProxy=t.makeGhostProxy),null==i.constrainFunction&&null!=i.containment)switch(i.containment){case Ao.notNegative:i.constrainFunction=function(t,e,n,i){return{x:Math.max(0,Math.min(t.x)),y:Math.max(0,Math.min(t.y))}};break;case Ao.parent:var r=i.containmentPadding||5;i.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x>n.w-r?n.w-r:t.x,y:t.y<0?0:t.y>n.h-r?n.h-r:t.y}};break;case Ao.parentEnclosed:i.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x+i.w>n.w?n.w-i.w:t.x,y:t.y<0?0:t.y+i.h>n.h?n.h-i.h:t.y}}}null==this.drag?(i.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),i),g(this._filtersToAdd,(function(t){return n.drag.addFilter(t[0],t[1])})),this.drag.on("revert",(function(t){n.instance.revalidate(t)}))):this.drag.addSelector(i),this.handlers.push({handler:t,options:i}),t.init(this.drag)}},{key:"addSelector",value:function(t,e){this.drag&&this.drag.addSelector(t,e)}},{key:"addFilter",value:function(t,e){null==this.drag?this._filtersToAdd.push([t,!0===e]):this.drag.addFilter(t,e)}},{key:"removeFilter",value:function(t){null!=this.drag&&this.drag.removeFilter(t)}},{key:"setFilters",value:function(t){var e=this;g(t,(function(t){e.drag.addFilter(t[0],t[1])}))}},{key:"reset",value:function(){var t=[];if(g(this.handlers,(function(t){t.handler.reset()})),this.handlers.length=0,null!=this.drag){var e=this.drag._filters;for(var n in e)t.push([n,e[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,t}},{key:"setOption",value:function(t,e){var n=_(this.handlers,(function(e){return e.handler===t}));null!=n&&a(n.options,e||{})}}]),t}();function Ro(t,e){return c(e)?{id:e,active:!0}:{id:e.id,active:e.active}}var Ho=function(){function t(e,n){wn(this,t),this.instance=e,this._dragSelection=n,An(this,"selector","> "+Vt+":not("+Bt("jtk-overlay")+")"),An(this,"_dragOffset",null),An(this,"_groupLocations",[]),An(this,"_intersectingGroups",[]),An(this,"_currentDragParentGroup",null),An(this,"_dragGroupByElementIdMap",{}),An(this,"_dragGroupMap",{}),An(this,"_currentDragGroup",null),An(this,"_currentDragGroupOffsets",new Map),An(this,"_currentDragGroupSizes",new Map),An(this,"_dragPayload",null),An(this,"drag",void 0),An(this,"originalPosition",void 0)}return jn(t,[{key:"onDragInit",value:function(t){return null}},{key:"onDragAbort",value:function(t){return null}},{key:"getDropGroup",value:function(){var t=null;if(this._intersectingGroups.length>0){var e=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==e&&(null!=i&&i.overrideDrop(n,e)||(t=this._intersectingGroups[0]))}return t}},{key:"onStop",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.getDropGroup(),o=[];if(o.push({el:n,id:this.instance.getId(n),pos:t.finalPos,originalGroup:n._jsPlumbParentGroup,redrawResult:null,originalPos:t.originalPos,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null}),this._dragSelection.each((function(e,n,r,s,a){if(e!==t.el){var l={x:r.x,y:r.y},c=l.x,u=l.y;if(e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain){var h={w:e.parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop};c=Math.max(c,0),u=Math.max(u,0),c=Math.min(c,h.w-s.w),u=Math.min(u,h.h-s.h),l.x=c,l.y=u}o.push({el:e,id:n,pos:l,originalPos:a,originalGroup:e._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null})}})),g(o,(function(t){var n=null!=t.originalGroup,o=n&&go(e.instance,t.el,t.pos),r={x:0,y:0};if(n&&!o){if(null==i){var s=e._pruneOrOrphan(t,!0,!0);null!=s.pos?t.pos=s.pos.pos:!s.pruned&&t.originalGroup.revert&&(t.pos=t.originalPos,t.reverted=!0)}}else n&&o&&(r=e._computeOffsetByParentGroup(t.originalGroup));null==i||o?t.dropGroup=null:e.instance.groupManager.addToGroup(i.groupLoc.group,!1,t.el),t.reverted&&e.instance.setPosition(t.el,t.pos),t.redrawResult=e.instance.setElementPosition(t.el,t.pos.x+r.x,t.pos.y+r.y),e.instance.removeClass(t.el,"jtk-dragged"),e.instance.select({source:t.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:t.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0)})),null!=o[0].originalGroup){var r=n._jsPlumbParentGroup;if(r!==o[0].originalGroup){var s=t.drag.getDragElement(!0);if(o[0].originalGroup.ghost){var a=this.instance.getPosition(this.instance.getGroupContentArea(r)),l=this.instance.getPosition(this.instance.getGroupContentArea(o[0].originalGroup)),c={x:l.x+t.pos.x-a.x,y:l.y+t.pos.y-a.y};s.style.left=c.x+"px",s.style.top=c.y+"px",this.instance.revalidate(s)}}}this.instance.fire("drag:stop",{elements:o,e:t.e,el:n,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var t=this;g(this._groupLocations,(function(e){t.instance.removeClass(e.el,"jtk-drag-active"),t.instance.removeClass(e.el,"jtk-drag-hover")})),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(t){this.drag=t}},{key:"onDrag",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getId(n),o=t.pos,r=this.instance.viewport.getPosition(i),s={x:o.x,y:o.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(s.x+=this._dragOffset.x,s.y+=this._dragOffset.y);var a=function(n,i,o){if(o){var r=new Set;g(e._groupLocations,(function(n){!r.has(n.group.id)&&tt(i,n.r)?(n.group!==e._currentDragParentGroup&&e.instance.addClass(n.el,"jtk-drag-hover"),e._intersectingGroups.push({groupLoc:n,intersectingElement:t.drag.getDragElement(!0),d:0}),g(e.instance.groupManager.getAncestors(n.group),(function(t){return r.add(t.id)}))):e.instance.removeClass(n.el,"jtk-drag-hover")}))}e.instance.setElementPosition(n,i.x,i.y),e.instance.fire("drag:move",{el:n,e:t.e,pos:{x:i.x,y:i.y},originalPosition:e.originalPosition,payload:e._dragPayload})},l={x:s.x,y:s.y,w:r.w,h:r.h};a(n,l,!0),this._dragSelection.updatePositions(o,this.originalPosition,(function(t,e,n,i){a(t,i,!1)})),this._currentDragGroupOffsets.forEach((function(t,n){var i=e._currentDragGroupSizes.get(n),o={x:l.x+t[0].x,y:l.y+t[0].y,w:i.w,h:i.h};t[1].style.left=o.x+"px",t[1].style.top=o.y+"px",a(t[1],o,!1)}))}},{key:"_computeOffsetByParentGroup",value:function(t){var e=this.instance.getPosition(t.el),n=t.contentArea;if(n!==t.el){var i=this.instance.getPosition(n);e.x+=i.x,e.y+=i.y}if(t.el._jsPlumbParentGroup){var o=this._computeOffsetByParentGroup(t.el._jsPlumbParentGroup);e.x+=o.x,e.y+=o.y}return e}},{key:"onStart",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getPosition(n);this.originalPosition={x:t.pos.x,y:t.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(n._jsPlumbParentGroup),this._currentDragParentGroup=n._jsPlumbParentGroup);var o=!0,r=n.getAttribute("data-jtk-not-draggable");if((!1===this.instance.elementsDraggable||null!=r&&"false"!==r)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var s=t.drag.getDragElement(!0),a=s.querySelectorAll(Vt),l=function(t){for(var e=[],n=t._jsPlumbParentGroup;null!=n;)e.push(n.el),n=n.group;return e}(s),c=[];Array.prototype.push.apply(c,a),Array.prototype.push.apply(c,l),this._dragSelection.filterActiveSet((function(t){return-1===c.indexOf(t.jel)})),this._dragSelection.initialisePositions();var u=function(n,i,o){if(!n._isJsPlumbGroup||e.instance.allowNestedGroups){var r=!n._jsPlumbParentGroup,s=r||!0!==n._jsPlumbParentGroup.dropOverride,a=!r&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(r||s&&a)&&(g(e.instance.groupManager.getGroups(),(function(t){var i=n._jsPlumbGroup;if(!1!==t.droppable&&!1!==t.enabled&&n._jsPlumbGroup!==t&&!e.instance.groupManager.isDescendant(t,i)){var o=t.el,r=e.instance.getId(o),s=e.instance.viewport.getPosition(r),a={el:o,r:{x:s.x,y:s.y,w:s.w,h:s.h},group:t};e._groupLocations.push(a),t!==e._currentDragParentGroup&&e.instance.addClass(o,"jtk-drag-active")}})),e._groupLocations.sort((function(t,n){return e.instance.groupManager.isDescendant(t.group,n.group)?-1:e.instance.groupManager.isAncestor(n.group,t.group)?1:0})))}return e.instance.select({source:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0),e.instance.fire("drag:start",{el:n,e:t.e,originalPosition:e.originalPosition,pos:e.originalPosition,dragGroup:i,dragGroupMemberSpec:o})},h=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[h],this._currentDragGroup&&!function(t,e){var n=x(t.members,(function(t){return t.el===e}));return null!==n&&!0===n.active}(this._currentDragGroup,n)&&(this._currentDragGroup=null);var d=u(n);if(!1===d)return this._cleanup(),!1;this._dragPayload=d,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach((function(t){var n=e.instance.viewport.getPosition(t.elId);e._currentDragGroupOffsets.set(t.elId,[{x:n.x-i.x,y:n.y-i.y},t.el]),e._currentDragGroupSizes.set(t.elId,n),u(t.el,e._currentDragGroup,t)})))}return o}},{key:"addToDragGroup",value:function(t){var e=this,n=Ro(this.instance,t),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];this.removeFromDragGroup.apply(this,r),g(r,(function(t){var o=e.instance.getId(t);i.members.add({elId:o,el:t,active:n.active}),e._dragGroupByElementIdMap[o]=i}))}},{key:"removeFromDragGroup",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];g(n,(function(e){var n=t.instance.getId(e),i=t._dragGroupByElementIdMap[n];if(null!=i){var o=new Set;i.members.forEach((function(t){t.el!==e&&o.add(t)})),i.members=o,delete t._dragGroupByElementIdMap[n]}}))}},{key:"setDragGroupState",value:function(t){for(var e=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var r=i.map((function(t){return e.instance.getId(t)}));g(r,(function(n){var i=e._dragGroupByElementIdMap[n];if(null!=i){var o=x(i.members,(function(t){return t.elId===n}));null!=o&&(o.active=t)}}))}},{key:"clearDragGroup",value:function(t){var e=this,n=this._dragGroupMap[t];null!=n&&(n.members.forEach((function(t){delete e._dragGroupByElementIdMap[t.elId]})),n.members.clear())}},{key:"_pruneOrOrphan",value:function(t,e,n){var i=t.el,o={pruned:!1,pos:null};if(n||!go(this.instance,i,t.pos)){var r=i._jsPlumbParentGroup;r.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):r.remove(t.el,!0),o.pruned=!0):r.orphan&&(o.pos=this.instance.groupManager.orphan(t.el,e),i._isJsPlumbGroup?r.removeGroup(i._jsPlumbGroup):r.remove(t.el))}return o}}]),t}();function No(t,e,n,i,o,r){var s=function(t,e,n){return new pe(t,e,n)}(r,i,o),a={paintStyle:t.getPaintStyle(),preparedAnchor:s,element:i,scope:t.scope,cssClass:[zt,t.cssClass].join(" ")};null!=e&&(L(e,Pt)?a.existingEndpoint=e:a.endpoint=e);var l=r._internal_newEndpoint(a);return r._paintEndpoint(l,{}),l}function zo(t,e,n,i,o){for(var r=t.target||t.srcElement,s=!1,a=i.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===r){s=!0;break}return o?!s:s}var Vo=Bt("jtk-drag-active","jtk-drag-hover"),Wo=function(){function t(e){wn(this,t),this.instance=e,An(this,"jpc",void 0),An(this,"existingJpc",void 0),An(this,"_originalAnchorSpec",void 0),An(this,"ep",void 0),An(this,"endpointRepresentation",void 0),An(this,"canvasElement",void 0),An(this,"_activeDefinition",void 0),An(this,"placeholderInfo",{id:null,element:null}),An(this,"floatingIndex",void 0),An(this,"floatingId",void 0),An(this,"floatingElement",void 0),An(this,"floatingEndpoint",void 0),An(this,"floatingAnchor",void 0),An(this,"_stopped",void 0),An(this,"inPlaceCopy",void 0),An(this,"endpointDropTargets",[]),An(this,"currentDropTarget",null),An(this,"payload",void 0),An(this,"floatingConnections",{}),An(this,"_forceReattach",void 0),An(this,"_forceDetach",void 0),An(this,"mousedownHandler",void 0),An(this,"mouseupHandler",void 0),An(this,"selector",Bt(Nt));var n=e.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),e.on(n,"mousedown",Vt,this.mousedownHandler),e.on(n,"mouseup",[Vt,Bt(Nt)].join(","),this.mouseupHandler)}return jn(t,[{key:"_resolveDragParent",value:function(t,e){var n=this.instance.getContainer(),i=Vn(e,Vt,n,!0);if(null!=t.parentSelector){var o=Vn(e,t.parentSelector,n,!0);return null!=o&&(i=Vn(o.parentNode,Vt,n,!1)),o||i}return i}},{key:"_mousedownHandler",value:function(t){var e,n;if(3!==t.which&&2!==t.button){var i=t.target||t.srcElement;if((null==(n=this._getSourceDefinition(t))||null!=(e=this._resolveDragParent(n.def.def,i))&&"false"!==e.getAttribute("data-jtk-enabled"))&&n){var o,r=t.currentTarget;if("false"!==i.getAttribute("data-jtk-enabled")){if(zn(t),this._activeDefinition=n,null!=(o=n.def.def).canAcceptNewConnection&&!o.canAcceptNewConnection(e,t))return!1;var s=Ko(t,e,this.instance.currentZoom),l={element:e};if(a(l,o),l.isTemporarySource=!0,o.scope)l.scope=o.scope;else{var c=i.getAttribute("data-jtk-scope");null!=c&&(l.scope=c)}if(null!=(l=f(l,o.parameterExtractor?o.parameterExtractor(e,i,t):{})).maxConnections&&l.maxConnections>=0)if(this.instance.select({source:e}).length>=l.maxConnections)return zn(t),o.onMaxConnections&&o.onMaxConnections({element:e,maxConnections:l.maxConnections},t),t.stopImmediatePropagation&&t.stopImmediatePropagation(),!1;if(o.anchorPositionFinder){var u=o.anchorPositionFinder(e,s,o,t);null!=u&&(l.anchor=u)}this._originalAnchorSpec=l.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var h=this.instance.router.prepareAnchor(this._originalAnchorSpec),d=[s.x,s.y,0,0];if(h.locations.length>0)d[2]=h.locations[0].ox,d[3]=h.locations[0].oy;else if(h.isContinuous){var p=s.x<.5?s.x:1-s.x,v=s.y<.5?s.y:1-s.y;d[2]=p<v?s.x<.5?-1:1:0,d[3]=v<p?s.y<.5?-1:1:0}l.anchor=d,l.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(l);var y={};if(o.extract){for(var g in o.extract){var m=i.getAttribute(g);m&&(y[o.extract[g]]=m)}this.ep.mergeParameters(y)}if(l.uniqueEndpoint){var _=this.ep.elementId,x=this.instance.getManagedData(_,"sourceSelectorEndpoint",n.id);null==x?(this.instance.setManagedData(_,"sourceSelectorEndpoint",n.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=x}r._jsPlumbOrphanedEndpoints=r._jsPlumbOrphanedEndpoints||[],r._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,"mousedown",t,y)}}}}},{key:"_mouseupHandler",value:function(t){var e=t.currentTarget||t.srcElement;e._jsPlumbOrphanedEndpoints&&(!function(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])}(e._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),e._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(t){var e=Kn(t,this.instance),n=ti(t,this.instance);return this._makeDraggablePlaceholder(e,n),this.placeholderInfo.element.jtk=t.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(t){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(t,e){this.placeholderInfo=this.placeholderInfo||{};var n=Jn("div",{position:"absolute"});this.instance._appendElementToContainer(n);var i=this.instance.getId(n);return this.instance.setPosition(n,t),n.style.width=e.w+"px",n.style.height=e.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var t=this.instance.getContainer();this.instance.off(t,"mouseup",this.mouseupHandler),this.instance.off(t,"mousedown",this.mousedownHandler)}},{key:"init",value:function(t){}},{key:"startNewConnectionDrag",value:function(t,e){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:t,data:e}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire("connection:drag",this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var t=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire("connection:drag",this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[t].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,t),this.jpc.suspendedEndpoint=this.jpc.endpoints[t],this.jpc.suspendedElement=this.jpc.endpoints[t].element,this.jpc.suspendedElementId=this.jpc.endpoints[t].elementId,this.jpc.suspendedElementType=0===t?"source":"target",this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[t]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=t,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var t=!0;this.ep.enabled||(t=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(t=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(t=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?t=!1:this.jpc=null);var e={},n=this.instance.checkCondition(null==this.jpc?"beforeDrag":"beforeStartDetach",{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===n?t=!1:"object"===Pn(n)?a(e=n,this.payload||{}):e=this.payload||{},[t,e]}},{key:"_createFloatingEndpoint",value:function(t){var e=this.ep.endpoint;null!=this.ep.edgeType&&(e=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]);this.floatingEndpoint=No(this.ep,e,0,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(t,e){var n,i,o=this,r=this.jpc&&this.jpc.endpoints[0]===this.ep;if(g(this.instance.getContainer().querySelectorAll([".",Nt,"[",Ht,this.ep.scope,"]:not(.",zt,")"].join("")),(function(e){if(!(null==o.jpc&&e===t||e===o.floatingElement||null==o.jpc&&e.jtk.endpoint.isFull())&&(r&&e.jtk.endpoint.isSource||!r&&e.jtk.endpoint.isTarget)){var i=Kn(e,o.instance),s=ti(e,o.instance);n={x:i.x,y:i.y,w:s.w,h:s.h},o.endpointDropTargets.push({el:e,targetEl:e,r:n,endpoint:e.jtk.endpoint,def:null}),o.instance.addClass(e,"jtk-drag-active")}})),r){var s=_(this.instance.sourceSelectors,(function(t){return t.isEnabled()&&(null==t.def.def.scope||t.def.def.scope===o.ep.scope)}));if(null!=s)g(this._findTargetZones(s),(function(t){if("false"!==t.getAttribute("data-jtk-enabled")){var e=t.getAttribute("data-jtk-scope");if(null!=e&&e!==o.ep.scope)return;var n={r:null,el:t};n.targetEl=Vn(t,Vt,o.instance.getContainer(),!0);var i=Kn(n.el,o.instance),r=ti(n.el,o.instance);n.r={x:i.x,y:i.y,w:r.w,h:r.h},null!=s.def.def.rank&&(n.rank=s.def.def.rank),n.def=s.def,o.endpointDropTargets.push(n),o.instance.addClass(n.targetEl,"jtk-drag-active")}}))}else{(function(t,e){var n=[];if(t)for(var i=0;i<t.length;i++)e(t[i])&&n.push(i);return n})(i=this.instance.targetSelectors,(function(t){return t.isEnabled()})).map((function(t){return i[t]})).forEach((function(t){g(o._findTargetZones(t),(function(n){if("false"!==n.getAttribute("data-jtk-enabled")){var i=n.getAttribute("data-jtk-scope");if(null!=i&&i!==o.ep.scope)return;var r={r:null,el:n};if(null!=t.def.def.parentSelector&&(r.targetEl=Vn(n,t.def.def.parentSelector,o.instance.getContainer(),!0)),null==r.targetEl&&(r.targetEl=Vn(n,Vt,o.instance.getContainer(),!0)),(!1===t.def.def.allowLoopback||o._activeDefinition&&!1===o._activeDefinition.def.def.allowLoopback)&&r.targetEl===o.ep.element)return;if(null!=t.def.def.canAcceptNewConnection&&!t.def.def.canAcceptNewConnection(r.targetEl,e))return;var s=t.def.def.maxConnections;if(null!=s&&-1!==s&&o.instance.select({target:r.targetEl}).length>=s)return;var a=Kn(n,o.instance),l=ti(n,o.instance);r.r={x:a.x,y:a.y,w:l.w,h:l.h},r.def=t.def,null!=t.def.def.rank&&(r.rank=t.def.def.rank),o.endpointDropTargets.push(r),o.instance.addClass(r.targetEl,"jtk-drag-active")}}))}))}this.endpointDropTargets.sort((function(t,e){if(t.targetEl._isJsPlumbGroup&&!e.targetEl._isJsPlumbGroup)return 1;if(!t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup)return-1;if(t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup){if(o.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return-1;if(o.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return 1}else{if(null==t.rank||null==e.rank)return 0;if(t.rank>e.rank)return-1;if(t.rank<e.rank)return 1}}))}},{key:"_findTargetZones",value:function(t){var e;if("any"===t.redrop){var n=this.instance.targetSelectors.map((function(t){return t.selector}));n.push.apply(n,Bn(this.instance.sourceSelectors.map((function(t){return t.selector})))),n.push(Vt),e=n.join(",")}else if(t.redrop===cn)e=t.selector;else if("anySource"===t.redrop)e=this.instance.sourceSelectors.map((function(t){return t.selector})).join(",");else if("anyTarget"===t.redrop)e=this.instance.targetSelectors.map((function(t){return t.selector})).join(",");else if("anySourceOrTarget"===t.redrop){var i=this.instance.targetSelectors.map((function(t){return t.selector}));i.push.apply(i,Bn(this.instance.sourceSelectors.map((function(t){return t.selector})))),e=i.join(",")}return this.instance.getContainer().querySelectorAll(e)}},{key:"onStart",value:function(t){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var e=t.drag.getDragElement();if(this.ep=e.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var n=Fn(this._shouldStartDrag(),2),i=n[0],o=n[1];if(!1===i)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,t.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,o):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(t){this.payload=t.e.payload||{}}},{key:"onDrag",value:function(t){if(this._stopped)return!0;if(this.placeholderInfo.element){var e=ti(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,t.pos.x,t.pos.y);for(var n,i,o={x:t.pos.x,y:t.pos.y,w:e.w,h:e.h},r=0;r<this.endpointDropTargets.length;r++)if(tt(o,this.endpointDropTargets[r].r)){n=this.endpointDropTargets[r];break}if(n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,"jtk-drag-hover"),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n)if(this.instance.addClass(n.el,"jtk-drag-hover"),i=this._getFloatingAnchorIndex(),null!=n.endpoint)if(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id)this.instance.checkCondition("checkDropAllowed",{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc);else n=null;this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(t){t._mtNew&&0===t.connections.length?this.instance.deleteEndpoint(t):delete t._mtNew}},{key:"_reattachOrDiscard",value:function(t){var e=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return e&&this._shouldReattach()?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,t),!1)}},{key:"onStop",value:function(t){var e=this,n=t.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.join(" ")}("jtk-drag-hover","jtk-drag-active");if(g(this.instance.getContainer().querySelectorAll(Vo),(function(t){e.instance.removeClass(t,i)})),this.jpc&&null!=this.jpc.endpoints){var o,r=null!=this.jpc.suspendedEndpoint,s=this._getFloatingAnchorIndex(),a=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(o=this._getDropEndpoint(t,this.jpc)))this._reattachOrDiscard(t.e);else if(a&&a.id===o.id)this._doForceReattach(s);else if(o.enabled)if(o.isFull())o.fire("maxConnections",{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(t.e);else{0===s?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var l=!0;r&&this.jpc.suspendedEndpoint.id!==o.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[s].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(l=!1)),(l=l&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,s,n,l):this._reattachOrDiscard(t.e)}else this._reattachOrDiscard(t.e);else this._reattachOrDiscard(t.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(t){for(var e,n=this.instance.getContainer(),i=0;i<this.instance.sourceSelectors.length;i++){if((e=this.instance.sourceSelectors[i]).isEnabled())if(!1!==zo(t,n,e.selector,this.instance,e.exclude))return e}}},{key:"_getDropEndpoint",value:function(t,e){var n;if(null==this.currentDropTarget.endpoint){var i=this.currentDropTarget.def,o=t.e.target||t.e.srcElement;if(null==i)return null;var r=this.currentDropTarget.targetEl,s=Ko(t.e,r,this.instance.currentZoom),l=this.instance._deriveEndpointAndAnchorSpec(e.getType().join(" "),!0),c=l.endpoints?a(t,{endpoint:i.def.endpoint||l.endpoints[1],cssClass:i.def.cssClass||"",source:!0===i.def.source,target:!0===i.def.target}):t,u=this.instance.validAnchorsSpec(l.anchors)?l.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,h=i.def.anchor,d=i.def.anchorPositionFinder?i.def.anchorPositionFinder(r,s,i.def,t.e):null,p=null!=d?d:null!=h?h:null!=u&&null!=u[1]?u[1]:null;if(null!=p&&(c=a(c,{anchor:p})),null!=i.def.portId&&(c.portId=i.def.portId),(c=f(c,i.def.parameterExtractor?i.def.parameterExtractor(this.currentDropTarget.el,o,t.e):{})).element=r,(n=this.instance._internal_newEndpoint(c))._mtNew=!0,n.deleteOnEmpty=!0,i.def.parameters&&n.mergeParameters(i.def.parameters),i.def.extract){var v={};for(var y in i.def.extract){var g=this.currentDropTarget.el.getAttribute(y);g&&(v[i.def.extract[y]]=g)}n.mergeParameters(v)}}else n=this.currentDropTarget.endpoint;return n&&(n.removeClass(this.instance.endpointDropAllowedClass),n.removeClass(this.instance.endpointDropForbiddenClass)),n}},{key:"_doForceReattach",value:function(t){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,t),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var t=this.jpc.suspendedEndpoint,e="source"==this.jpc.suspendedElementType?1:0,n=this.jpc.endpoints[e];return!v(!0,!1,[[t,"isDetachAllowed",[this.jpc]],[n,"isDetachAllowed",[this.jpc]],[this.jpc,"isDetachAllowed",[this.jpc]],[this.instance,"checkCondition",["beforeDetach",this.jpc]]])}},{key:"_discard",value:function(t,e){this.jpc.pending?this.instance.fire("connection:abort",this.jpc,e):(0===t?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:e,force:!0})}},{key:"_drop",value:function(t,e,n,i){if(this.jpc.endpoints[e].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[e]=t,t.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:e,originalSourceId:0===e?o:this.jpc.sourceId,newSourceId:0===e?t.elementId:this.jpc.sourceId,originalTargetId:1===e?o:this.jpc.targetId,newTargetId:1===e?t.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:t},n)}(1===e?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint)&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc));h(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(t,e){this.floatingConnections[t.id]=e}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),t}(),Xo=function(t){Mn(n,t);var e=Gn(n);function n(t,i){var o;return wn(this,n),(o=e.call(this,t,i)).instance=t,o.dragSelection=i,An(In(o),"selector",[">",Hi,Vt].join(" ")),An(In(o),"doRevalidate",void 0),o.doRevalidate=o._revalidate.bind(In(o)),o}return jn(n,[{key:"reset",value:function(){this.drag.off("revert",this.doRevalidate)}},{key:"_revalidate",value:function(t){this.instance.revalidate(t)}},{key:"init",value:function(t){this.drag=t,t.on("revert",this.doRevalidate)}},{key:"useGhostProxy",value:function(t,e){var n=e._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function(t){var e=t,n=e.cloneNode(!0);return n._jsPlumbParentGroup=e._jsPlumbParentGroup,n}}]),n}(Ho),Yo=function(){function t(e,n){wn(this,t),this.instance=e,this.overlay=n,An(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return jn(t,null,[{key:"getElement",value:function(t,e,n){if(null==t.canvas){if(n&&e){t.canvas=n(e);var i=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.canvas,i)}else t.canvas=Jn("div",{},t.instance.overlayClass+" "+(t.cssClass?t.cssClass:""));for(var o in t.instance.setAttribute(t.canvas,"jtk-overlay-id",t.id),t.attributes)t.instance.setAttribute(t.canvas,o,t.attributes[o]);t.canvas.style.position="absolute",t.instance._appendElement(t.canvas,t.instance.getContainer()),t.instance.getId(t.canvas);var r="translate(-50%, -50%)";t.canvas.style.webkitTransform=r,t.canvas.style.mozTransform=r,t.canvas.style.msTransform=r,t.canvas.style.oTransform=r,t.canvas.style.transform=r,t.isVisible()||(t.canvas.style.display="none"),t.canvas.jtk={overlay:t}}return t.canvas}},{key:"destroy",value:function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.cachedDimensions}},{key:"_getDimensions",value:function(t,e){return(null==t.cachedDimensions||e)&&(t.cachedDimensions={w:1,h:1}),t.cachedDimensions}}]),t}();function Uo(t){if(null==t.path){var e=a({"jtk-overlay-id":t.id},t.attributes);t.path=ri("path",e);var n=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.path,n),t.path.jtk={overlay:t}}var i=t.path.parentNode;if(null==i){if(t.component instanceof Le){var o=t.component.connector;i=null!=o?o.canvas:null}else if(t.component instanceof Be){var r=t.component.endpoint;i=null!=r?r.canvas:r}null!=i&&li(i,t.path,1)}return t.path}!function(t){Mn(n,t);var e=Gn(n);function n(){var t;wn(this,n);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return An(In(t=e.call.apply(e,[this].concat(o))),"path",void 0),t}}(Xt);var qo=function(){function t(){wn(this,t)}return jn(t,null,[{key:"paint",value:function(t,e,n,i){if(null!=n){var o=[t.x,t.y],r=[t.w,t.h];if(null!=i&&(i.xmin<0&&(o[0]+=i.xmin),i.ymin<0&&(o[1]+=i.ymin),r[0]=i.xmax+(i.xmin<0?-i.xmin:0),r[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(r[0])&&isFinite(r[1])){var s={width:""+(r[0]||0),height:""+(r[1]||0)};e.containerType===bn.HTML?oi(t.canvas,a(s,{style:si([o[0],o[1]])})):oi(t.canvas,a(s,{x:o[0],y:o[1]}))}}}}]),t}();function Zo(t,e,n,i){!function(t,e){if(null!=e.canvas)return e.canvas;var n=ri("svg",{style:"",width:"0",height:"0","pointer-events":"none",position:"absolute"});e.canvas=n,t._appendElement(e.canvas,t.getContainer()),null!=e.cssClass&&t.addClass(n,e.cssClass),t.addClass(n,t.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=e}(t,e),qo.paint(e,t,n,i);var o=[0,0];if(i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin),e.segments.length>0){var r={d:t.getPathData(e),transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"},s=null;if(n.outlineStroke){var l=n.outlineWidth||1,c=n.strokeWidth+2*l;(s=a({},n)).stroke=n.outlineStroke,s.strokeWidth=c,null==e.bgPath?(e.bgPath=ri("path",r),t.addClass(e.bgPath,t.connectorOutlineClass),li(e.canvas,e.bgPath,0)):oi(e.bgPath,r),ai(e.canvas,e.bgPath,s)}var u=e;null==u.path?(u.path=ri("path",r),li(u.canvas,u.path,n.outlineStroke?1:0)):(u.path.parentNode!==u.canvas&&li(u.canvas,u.path,n.outlineStroke?1:0),oi(e.path,r)),ai(e.canvas,e.path,n)}}var Jo=function(){function t(){wn(this,t)}return jn(t,null,[{key:"getEndpointElement",value:function(t){if(null!=t.canvas)return t.canvas;var e=ri("svg",{style:"",width:"0",height:"0","pointer-events":"all",position:"absolute"});t.canvas=e;var n=t.classes.join(" ");t.instance.addClass(e,n);for(var i=t.endpoint.scope.split(/\s/),o=0;o<i.length;o++)t.instance.setAttribute(e,Ht+i[o],"true");return t.instance._appendElementToContainer(e),null!=t.cssClass&&t.instance.addClass(e,t.cssClass),t.instance.addClass(e,t.instance.endpointClass),e.jtk=e.jtk||{},e.jtk.endpoint=t.endpoint,e.style.display=!1!==t.endpoint.visible?"block":"none",e}},{key:"paint",value:function(t,e,n){if(!0!==t.endpoint.deleted){this.getEndpointElement(t),qo.paint(t,t.instance,n);var i=a({},n);i.outlineStroke&&(i.stroke=i.outlineStroke),null==t.node?(t.node=e.makeNode(t,i),t.canvas.appendChild(t.node)):null!=e.updateNode&&e.updateNode(t,t.node),ai(t.canvas,t.node,i)}}}]),t}(),$o={};function Qo(t,e){$o[t]=e}function Ko(t,e,n){var i=e,o="undefined"!==Pn(e.getBoundingClientRect)?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},r=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||r.scrollTop,l=window.pageXOffset||s.scrollLeft||r.scrollLeft,c=s.clientTop||r.clientTop||0,u=s.clientLeft||r.clientLeft||0,h=o.top+a-c+0*n,d=o.left+l-u+0*n,p=to(t),f=o.width||i.offsetWidth*n,v=o.height||i.offsetHeight*n;return{x:(p.x-d)/f,y:(p.y-h)/v}}function tr(t){return gn(t)||kn(t)||_n(t)}function er(t,e){t.canvas&&(t.canvas.style.display=e?"block":"none")}function nr(t){t.canvas&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas}function ir(t){return t.canvas}function or(t){return Yo.getElement(t)}function rr(t){return Yo.getElement(t,t.component,(function(e){var n=t.create(e);return t.instance.addClass(n,t.instance.overlayClass),n}))}function sr(t,e,n,i){var o=t.x,r=t.y;return e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain&&(o=Math.max(t.x,0),r=Math.max(t.y,0),o=Math.min(o,n.w-i.w),r=Math.min(r,n.h-i.h)),{x:o,y:r}}var ar=function(t){Mn(n,t);var e=Gn(n);function n(t,i){var o;if(wn(this,n),(o=e.call(this,t,i))._instanceIndex=t,An(In(o),"containerType",null),An(In(o),"dragSelection",void 0),An(In(o),"dragManager",void 0),An(In(o),"_connectorClick",void 0),An(In(o),"_connectorDblClick",void 0),An(In(o),"_connectorTap",void 0),An(In(o),"_connectorDblTap",void 0),An(In(o),"_endpointClick",void 0),An(In(o),"_endpointDblClick",void 0),An(In(o),"_overlayClick",void 0),An(In(o),"_overlayDblClick",void 0),An(In(o),"_overlayTap",void 0),An(In(o),"_overlayDblTap",void 0),An(In(o),"_connectorMouseover",void 0),An(In(o),"_connectorMouseout",void 0),An(In(o),"_endpointMouseover",void 0),An(In(o),"_endpointMouseout",void 0),An(In(o),"_connectorContextmenu",void 0),An(In(o),"_connectorMousedown",void 0),An(In(o),"_connectorMouseup",void 0),An(In(o),"_endpointMousedown",void 0),An(In(o),"_endpointMouseup",void 0),An(In(o),"_overlayMouseover",void 0),An(In(o),"_overlayMouseout",void 0),An(In(o),"_elementClick",void 0),An(In(o),"_elementTap",void 0),An(In(o),"_elementDblTap",void 0),An(In(o),"_elementMouseenter",void 0),An(In(o),"_elementMouseexit",void 0),An(In(o),"_elementMousemove",void 0),An(In(o),"_elementMouseup",void 0),An(In(o),"_elementMousedown",void 0),An(In(o),"_elementContextmenu",void 0),An(In(o),"_resizeObserver",void 0),An(In(o),"eventManager",void 0),An(In(o),"draggingClass","jtk-dragging"),An(In(o),"elementDraggingClass","jtk-element-dragging"),An(In(o),"hoverClass","jtk-hover"),An(In(o),"sourceElementDraggingClass","jtk-source-element-dragging"),An(In(o),"targetElementDraggingClass","jtk-target-element-dragging"),An(In(o),"hoverSourceClass","jtk-source-hover"),An(In(o),"hoverTargetClass","jtk-target-hover"),An(In(o),"dragSelectClass","jtk-drag-select"),An(In(o),"managedElementsSelector",void 0),An(In(o),"elementsDraggable",void 0),An(In(o),"elementDragHandler",void 0),An(In(o),"groupDragOptions",void 0),An(In(o),"elementDragOptions",void 0),An(In(o),"svg",{node:function(t,e){return ri(t,e)},attr:function(t,e){return oi(t,e)},pos:function(t){return si(t)}}),i=i||{},o.containerType=ei(o.getContainer()),o.elementsDraggable=i&&!1!==i.elementsDraggable,o.managedElementsSelector=i&&i.managedElementsSelector||Vt,o.eventManager=new vo,o.dragSelection=new Fo(In(o)),o.dragManager=new Bo(In(o),o.dragSelection),o.dragManager.addHandler(new Wo(In(o))),o.groupDragOptions={constrainFunction:sr},o.dragManager.addHandler(new Xo(In(o),o.dragSelection),o.groupDragOptions),o.elementDragHandler=new Ho(In(o),o.dragSelection),o.elementDragOptions=i&&i.dragOptions||{},o.dragManager.addHandler(o.elementDragHandler,o.elementDragOptions),i&&i.dragOptions&&i.dragOptions.filter&&o.dragManager.addFilter(i.dragOptions.filter),o._createEventListeners(),o._attachEventDelegates(),!1!==i.resizeObserver)try{o._resizeObserver=new ResizeObserver((function(t){t.filter((function(t){var e=o.getAttribute(t.target,"data-jtk-managed");if(null!=e){var n=o.viewport._elementMap.get(e);return!!n&&(n.w!==t.contentRect.width||n.h!==t.contentRect.height)}return!1})).forEach((function(t){return o.revalidate(t.target)}))}))}catch(t){T("WARN: ResizeObserver could not be attached.")}return o}return jn(n,[{key:"fireOverlayMethod",value:function(t,e,n){var i=ci(t.component instanceof Le?"connection":"endpoint",e);n._jsPlumbOverlay=t,t.fire(e,{e:n,overlay:t}),this.fire(i,t.component,n)}},{key:"addDragFilter",value:function(t,e){this.dragManager.addFilter(t,e)}},{key:"removeDragFilter",value:function(t){this.dragManager.removeFilter(t)}},{key:"setDragGrid",value:function(t){this.dragManager.setOption(this.elementDragHandler,{grid:t})}},{key:"setDragConstrainFunction",value:function(t){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:t})}},{key:"_removeElement",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"_appendElement",value:function(t,e){e&&e.appendChild(t)}},{key:"_appendElementToGroup",value:function(t,e){this.getGroupContentArea(t).appendChild(e)}},{key:"_appendElementToContainer",value:function(t){this._appendElement(t,this.getContainer())}},{key:"_getAssociatedElements",value:function(t){var e=[];if(3!==t.nodeType&&8!==t.nodeType){var n=t.querySelectorAll(Vt);Array.prototype.push.apply(e,n)}return e.filter((function(t){return 3!==t.nodeType&&8!==t.nodeType}))}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getClass",value:function(t){return function(t){return Xn(t)}(t)}},{key:"addClass",value:function(t,e){qn(t,e)}},{key:"hasClass",value:function(t,e){return function(t,e){return t.classList?t.classList.contains(e):-1!==Xn(t).indexOf(e)}(t,e)}},{key:"removeClass",value:function(t,e){Zn(t,e)}},{key:"toggleClass",value:function(t,e){!function(t,e){var n=this,i=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?t.classList.toggle(e):n.hasClass(t,e)?n.removeClass(t,e):n.addClass(t,e))};Un(t)?g(t,(function(t){return i(t,e)})):i(t,e)}(t,e)}},{key:"setAttribute",value:function(t,e,n){t.setAttribute(e,n)}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"setAttributes",value:function(t,e){for(var n in e)t.setAttribute(n,e[n])}},{key:"removeAttribute",value:function(t,e){t.removeAttribute&&t.removeAttribute(e)}},{key:"on",value:function(t,e,n,i){var o=this,r=function(t){null==i?o.eventManager.on(t,e,n):o.eventManager.on(t,e,n,i)};return Un(t)?g(t,(function(t){return r(t)})):r(t),this}},{key:"off",value:function(t,e,n){var i=this;return Un(t)?g(t,(function(t){return i.eventManager.off(t,e,n)})):this.eventManager.off(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){this.eventManager.trigger(t,e,n,i,o)}},{key:"getOffsetRelativeToRoot",value:function(t){return Qn(t)}},{key:"getOffset",value:function(t){for(var e,n=t,i=this.getContainer(),o=this.getPosition(n),r=t!==i&&n.offsetParent!==i?n.offsetParent:null;null!=r;)o.x+=r.offsetLeft,o.y+=r.offsetTop,null!=(e=r)&&e!==document.body&&(e.scrollTop>0||e.scrollLeft>0)&&(o.x-=e.scrollLeft,o.y-=e.scrollTop),r=r.offsetParent===i?null:r.offsetParent;if(null!=i&&(i.scrollTop>0||i.scrollLeft>0)){var s=null!=n.offsetParent?this.getStyle(n.offsetParent,"position"):"static",a=this.getStyle(n,"position");"absolute"!==a&&"fixed"!==a&&"absolute"!==s&&"fixed"!==s&&(o.x-=i.scrollLeft,o.y-=i.scrollTop)}return o}},{key:"getSize",value:function(t){var e=t;return null!=e.offsetWidth?function(t){return{w:t.offsetWidth,h:t.offsetHeight}}(t):e.width&&e.width.baseVal?function(t){try{return{w:parseFloat(t.width.baseVal.value),h:parseFloat(t.height.baseVal.value)}}catch(t){return{w:0,h:0}}}(e):void 0}},{key:"getPosition",value:function(t){var e=t;return null!=e.offsetLeft?{x:parseFloat(e.offsetLeft),y:parseFloat(e.offsetTop)}:e.x&&e.x.baseVal?function(t){try{return{x:parseFloat(t.x.baseVal.value),y:parseFloat(t.y.baseVal.value)}}catch(t){return{x:0,y:0}}}(e):void 0}},{key:"getStyle",value:function(t,e){return"undefined"!==Pn(window.getComputedStyle)?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]}},{key:"getGroupContentArea",value:function(t){var e=this.getSelector(t.el,Ni);return e&&e.length>0?e[0]:t.el}},{key:"getSelector",value:function(t,e){var n=null;if(1===arguments.length){if(!c(t)){var i=document.createDocumentFragment();return i.appendChild(t),b(i.childNodes)}n=b(document.querySelectorAll(t))}else n=b(t.querySelectorAll(e));return n}},{key:"setPosition",value:function(t,e){var n=t;n.style.left=e.x+"px",n.style.top=e.y+"px"}},{key:"setDraggable",value:function(t,e){e?this.removeAttribute(t,"data-jtk-not-draggable"):this.setAttribute(t,"data-jtk-not-draggable","true")}},{key:"isDraggable",value:function(t){var e=this.getAttribute(t,"data-jtk-not-draggable");return null==e||"false"===e}},{key:"toggleDraggable",value:function(t){var e=this.isDraggable(t);return this.setDraggable(t,!e),!e}},{key:"_createEventListeners",value:function(){var t=function(t,e){if(!e.defaultPrevented&&null==e._jsPlumbOverlay){var n=Vn(Wn(e),Bi,this.getContainer(),!0);this.fire(t,n.jtk.connector.connection,e)}};this._connectorClick=t.bind(this,Ai),this._connectorDblClick=t.bind(this,Mi),this._connectorTap=t.bind(this,Fi),this._connectorDblTap=t.bind(this,Di);var e=function(t,e){var n=Wn(e).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,o=i.connection;this.setConnectorHover(i,t),t?(this.addClass(o.source,this.hoverSourceClass),this.addClass(o.target,this.hoverTargetClass)):(this.removeClass(o.source,this.hoverSourceClass),this.removeClass(o.target,this.hoverTargetClass)),this.fire(t?Ii:Ti,n.jtk.connector.connection,e)}};this._connectorMouseover=e.bind(this,!0),this._connectorMouseout=e.bind(this,!1);var n=function(t,e){var n=Wn(e).parentNode;n.jtk&&n.jtk.connector&&this.fire(t?Oi:Gi,n.jtk.connector.connection,e)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=function(t){var e=Wn(t).parentNode;e.jtk&&e.jtk.connector&&this.fire(Li,e.jtk.connector.connection,t)}.bind(this);var i=function(t,e,n){e.defaultPrevented||null!=e._jsPlumbOverlay||this.fire(t,n.jtk.endpoint,e)};this._endpointClick=i.bind(this,Ci),this._endpointDblClick=i.bind(this,Ei);var o=function(t,e){var n=Wn(e);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,t),this.fire(t?wi:Pi,n.jtk.endpoint,e))};this._endpointMouseover=o.bind(this,!0),this._endpointMouseout=o.bind(this,!1);var r=function(t,e){var n=Wn(e);n.jtk&&n.jtk.endpoint&&this.fire(t?Si:ji,n.jtk.endpoint,e)};this._endpointMouseup=r.bind(this,!0),this._endpointMousedown=r.bind(this,!1);var s=function(t,e){var n=Vn(Wn(e),zi,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,t,e)}.bind(this);this._overlayClick=s.bind(this,"click"),this._overlayDblClick=s.bind(this,"dblclick"),this._overlayTap=s.bind(this,"tap"),this._overlayDblTap=s.bind(this,"dbltap");var a=function(t,e){var n=Vn(Wn(e),zi,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,t)};this._overlayMouseover=a.bind(this,!0),this._overlayMouseout=a.bind(this,!1);this._elementClick=function(t,e,n){e.defaultPrevented||this.fire(1===e.detail?pi:fi,n,e)}.bind(this,pi);this._elementTap=function(t,e,n){e.defaultPrevented||this.fire(bi,n,e)}.bind(this,bi);this._elementDblTap=function(t,e,n){e.defaultPrevented||this.fire(vi,n,e)}.bind(this,vi);var l=function(t,e){this.fire(t?gi:yi,Wn(e),e)};this._elementMouseenter=l.bind(this,!0),this._elementMouseexit=l.bind(this,!1),this._elementMousemove=function(t){this.fire(mi,Wn(t),t)}.bind(this),this._elementMouseup=function(t){this.fire(_i,Wn(t),t)}.bind(this),this._elementMousedown=function(t){this.fire(xi,Wn(t),t)}.bind(this),this._elementContextmenu=function(t){this.fire(ki,Wn(t),t)}.bind(this)}},{key:"_attachEventDelegates",value:function(){var t=this.getContainer();this.eventManager.on(t,"click",zi,this._overlayClick),this.eventManager.on(t,"dblclick",zi,this._overlayDblClick),this.eventManager.on(t,"tap",zi,this._overlayTap),this.eventManager.on(t,"dbltap",zi,this._overlayDblTap),this.eventManager.on(t,"click",Bi,this._connectorClick),this.eventManager.on(t,"dblclick",Bi,this._connectorDblClick),this.eventManager.on(t,"tap",Bi,this._connectorTap),this.eventManager.on(t,"dbltap",Bi,this._connectorDblTap),this.eventManager.on(t,"click",Ri,this._endpointClick),this.eventManager.on(t,"dblclick",Ri,this._endpointDblClick),this.eventManager.on(t,"click",this.managedElementsSelector,this._elementClick),this.eventManager.on(t,"tap",this.managedElementsSelector,this._elementTap),this.eventManager.on(t,"dbltap",this.managedElementsSelector,this._elementDblTap),this.eventManager.on(t,"mouseover",Bi,this._connectorMouseover),this.eventManager.on(t,"mouseout",Bi,this._connectorMouseout),this.eventManager.on(t,"contextmenu",Bi,this._connectorContextmenu),this.eventManager.on(t,"mouseup",Bi,this._connectorMouseup),this.eventManager.on(t,"mousedown",Bi,this._connectorMousedown),this.eventManager.on(t,"mouseover",Ri,this._endpointMouseover),this.eventManager.on(t,"mouseout",Ri,this._endpointMouseout),this.eventManager.on(t,"mouseup",Ri,this._endpointMouseup),this.eventManager.on(t,"mousedown",Ri,this._endpointMousedown),this.eventManager.on(t,"mouseover",zi,this._overlayMouseover),this.eventManager.on(t,"mouseout",zi,this._overlayMouseout),this.eventManager.on(t,"mouseover",Vt,this._elementMouseenter),this.eventManager.on(t,"mouseout",Vt,this._elementMouseexit),this.eventManager.on(t,"mousemove",Vt,this._elementMousemove),this.eventManager.on(t,"mouseup",Vt,this._elementMouseup),this.eventManager.on(t,"mousedown",Vt,this._elementMousedown),this.eventManager.on(t,"contextmenu",Vt,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var t=this.getContainer();t&&(this.eventManager.off(t,"click",this._connectorClick),this.eventManager.off(t,"dblclick",this._connectorDblClick),this.eventManager.off(t,"tap",this._connectorTap),this.eventManager.off(t,"dbltap",this._connectorDblTap),this.eventManager.off(t,"click",this._endpointClick),this.eventManager.off(t,"dblclick",this._endpointDblClick),this.eventManager.off(t,"click",this._overlayClick),this.eventManager.off(t,"dblclick",this._overlayDblClick),this.eventManager.off(t,"tap",this._overlayTap),this.eventManager.off(t,"dbltap",this._overlayDblTap),this.eventManager.off(t,"click",this._elementClick),this.eventManager.off(t,"tap",this._elementTap),this.eventManager.off(t,"dbltap",this._elementDblTap),this.eventManager.off(t,"mouseover",this._connectorMouseover),this.eventManager.off(t,"mouseout",this._connectorMouseout),this.eventManager.off(t,"contextmenu",this._connectorContextmenu),this.eventManager.off(t,"mouseup",this._connectorMouseup),this.eventManager.off(t,"mousedown",this._connectorMousedown),this.eventManager.off(t,"mouseover",this._endpointMouseover),this.eventManager.off(t,"mouseout",this._endpointMouseout),this.eventManager.off(t,"mouseup",this._endpointMouseup),this.eventManager.off(t,"mousedown",this._endpointMousedown),this.eventManager.off(t,"mouseover",this._overlayMouseover),this.eventManager.off(t,"mouseout",this._overlayMouseout),this.eventManager.off(t,"mouseenter",this._elementMouseenter),this.eventManager.off(t,"mouseexit",this._elementMouseexit),this.eventManager.off(t,"mousemove",this._elementMousemove),this.eventManager.off(t,"mouseup",this._elementMouseup),this.eventManager.off(t,"mousedown",this._elementMousedown),this.eventManager.off(t,"contextmenu",this._elementContextmenu))}},{key:"setContainer",value:function(t){var e,i=this;if(t===document||t===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(e=this.dragManager.reset()),this.setAttribute(t,"data-jtk-container",j().replace("-",""));var o=this.getContainer();null!=o&&(o.removeAttribute("data-jtk-container"),g(b(o.childNodes).filter((function(t){return null!=t&&(i.hasClass(t,"jtk-connector")||i.hasClass(t,Nt)||i.hasClass(t,"jtk-overlay")||t.getAttribute&&null!=t.getAttribute("data-jtk-managed"))})),(function(e){t.appendChild(e)})));Ln(Dn(n.prototype),"setContainer",this).call(this,t),this.containerType=ei(t),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Wo(this)),this.dragManager.addHandler(new Xo(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Ho(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=e&&this.dragManager.setFilters(e))}},{key:"reset",value:function(){Ln(Dn(n.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect(),g(this.getContainer().querySelectorAll([Vt,Ri,Bi,zi].join(",")),(function(t){return t.parentNode&&t.parentNode.removeChild(t)}))}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),Ln(Dn(n.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(t,e){null!=this._resizeObserver&&this._resizeObserver.unobserve(t),this.removeFromDragSelection(t),Ln(Dn(n.prototype),"unmanage",this).call(this,t,e)}},{key:"addToDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];g(n,(function(e){return t.dragSelection.add(e)}))}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];g(n,(function(e){return t.dragSelection.remove(e)}))}},{key:"toggleDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];g(n,(function(e){return t.dragSelection.toggle(e)}))}},{key:"addToDragGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).addToDragGroup.apply(e,[t].concat(i))}},{key:"removeFromDragGroup",value:function(){var t;(t=this.elementDragHandler).removeFromDragGroup.apply(t,arguments)}},{key:"setDragGroupState",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).setDragGroupState.apply(e,[t].concat(i))}},{key:"clearDragGroup",value:function(t){this.elementDragHandler.clearDragGroup(t)}},{key:"consume",value:function(t,e){zn(t,e)}},{key:"rotate",value:function(t,e,i){var o=this.getId(t);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+e+"deg)",this._managedElements[o].el.style.transformOrigin="center center",Ln(Dn(n.prototype),"rotate",this).call(this,t,e,i)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(t,e){if(Jt(t))t.instance.addClass(or(t),e);else if(tr(t))t.instance.addClass(Uo(t),e);else{if(!En(t))throw"Could not add class to overlay of type ["+t.type+"]";t.instance.addClass(rr(t),e)}}},{key:"removeOverlayClass",value:function(t,e){if(Jt(t))t.instance.removeClass(or(t),e);else if(tr(t))t.instance.removeClass(Uo(t),e);else{if(!En(t))throw"Could not remove class from overlay of type ["+t.type+"]";t.instance.removeClass(rr(t),e)}}},{key:"_paintOverlay",value:function(t,e,n){if(Jt(t)){or(t);var i=t.component.getXY();t.canvas.style.left=i.x+e.d.minx+"px",t.canvas.style.top=i.y+e.d.miny+"px"}else if(tr(t)){!function(t,e,n,i){Uo(t);var o=[0,0];i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin);var r={d:e,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"};oi(t.path,r)}(t,isNaN(e.d.cxy.x)||isNaN(e.d.cxy.y)?"M 0 0":"M"+e.d.hxy.x+","+e.d.hxy.y+" L"+e.d.tail[0].x+","+e.d.tail[0].y+" L"+e.d.cxy.x+","+e.d.cxy.y+" L"+e.d.tail[1].x+","+e.d.tail[1].y+" L"+e.d.hxy.x+","+e.d.hxy.y,e,n)}else{if(!En(t))throw"Could not paint overlay of type ["+t.type+"]";rr(t);var o=t.component.getXY();t.canvas.style.left=o.x+e.d.minx+"px",t.canvas.style.top=o.y+e.d.miny+"px"}}},{key:"setOverlayVisible",value:function(t,e){var n=e?"block":"none";function i(t){null!=t&&(t.style.display=n)}Jt(t)?i(or(t)):En(t)?i(rr(t)):tr(t)&&i(t.path)}},{key:"reattachOverlay",value:function(t,e){Jt(t)?t.instance._appendElement(or(t),this.getContainer()):En(t)?t.instance._appendElement(rr(t),this.getContainer()):tr(t)&&this._appendElement(Uo(t),e.connector.canvas)}},{key:"setOverlayHover",value:function(t,e){var n;Jt(t)?n=or(t):En(t)?n=rr(t):tr(t)&&(n=Uo(t)),null!=n&&(null!=this.hoverClass&&(e?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(t.component,e))}},{key:"destroyOverlay",value:function(t){if(Jt(t)){var e=or(t);e.parentNode.removeChild(e),delete t.canvas,delete t.cachedDimensions}else if(gn(t)||kn(t)||_n(t))!function(t,e){var n=t;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}(t);else if(En(t)){var n=rr(t);n.parentNode.removeChild(n),delete t.canvas,delete t.cachedDimensions}}},{key:"drawOverlay",value:function(t,e,n,i){if(Jt(t)||En(t)){var o=Yo._getDimensions(t);if(null!=o&&null!=o.w&&null!=o.h){var r={x:0,y:0};if(i)r={x:i.x,y:i.y};else if(e instanceof Pt){var s=Array.isArray(t.location)?t.location:[t.location,t.location];r={x:s[0]*e.w,y:s[1]*e.h}}else{var a=t.location,l=!1;(c(t.location)||t.location<0||t.location>1)&&(a=parseInt(""+t.location,10),l=!0),r=e.pointOnPath(a,l)}var u=r.x-o.w/2,h=r.y-o.h/2;return{component:t,d:{minx:u,miny:h,td:o,cxy:r},xmin:u,xmax:u+o.w,ymin:h,ymax:h+o.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(gn(t)||kn(t)||_n(t))return t.draw(e,n,i);throw"Could not draw overlay of type ["+t.type+"]"}},{key:"updateLabel",value:function(t){if(d(t.label)){var e=t.label(this);or(t).innerText=null!=e?e:""}else null==t.labelText&&(t.labelText=t.label,null!=t.labelText?or(t).innerText=t.labelText:or(t).innerText="")}},{key:"setHover",value:function(t,e){t._hover=e,t instanceof Be&&null!=t.endpoint?this.setEndpointHover(t,e,-1):t instanceof Le&&null!=t.connector&&this.setConnectorHover(t.connector,e)}},{key:"paintConnector",value:function(t,e,n){Zo(this,t,e,n)}},{key:"setConnectorHover",value:function(t,e,n){if(!1===e||!this.currentlyDragging&&!this.isHoverSuspended()){var i=t.canvas;null!=i&&(null!=t.hoverClass&&(e?this.addClass(i,t.hoverClass):this.removeClass(i,t.hoverClass)),e?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=t.connection.hoverPaintStyle&&(t.connection.paintStyleInUse=e?t.connection.hoverPaintStyle:t.connection.paintStyle,this._suspendDrawing||this._paintConnection(t.connection)),t.connection.endpoints[0]!==n&&this.setEndpointHover(t.connection.endpoints[0],e,0,!0),t.connection.endpoints[1]!==n&&this.setEndpointHover(t.connection.endpoints[1],e,1,!0)}}},{key:"destroyConnector",value:function(t){null!=t.connector&&nr(t.connector)}},{key:"addConnectorClass",value:function(t,e){t.canvas&&this.addClass(t.canvas,e)}},{key:"removeConnectorClass",value:function(t,e){t.canvas&&this.removeClass(t.canvas,e)}},{key:"getConnectorClass",value:function(t){return t.canvas?t.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(t,e){er(t,e)}},{key:"applyConnectorType",value:function(t,e){if(t.canvas&&e.cssClass){var n=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(t.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(t,e){var n=ir(t.endpoint);null!=n&&this.addClass(n,e)}},{key:"applyEndpointType",value:function(t,e){if(e.cssClass){var n=ir(t.endpoint);if(n){var i=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(t){var e=this.endpointAnchorClassPrefix+(t.currentAnchorClass?"-"+t.currentAnchorClass:"");this.removeClass(t.element,e),nr(t.endpoint)}},{key:"renderEndpoint",value:function(t,e){var n=$o[t.endpoint.type];null!=n?Jo.paint(t.endpoint,n,e):T("jsPlumb: no endpoint renderer found for type ["+t.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(t,e){var n=ir(t.endpoint);null!=n&&this.removeClass(n,e)}},{key:"getEndpointClass",value:function(t){var e=ir(t.endpoint);return null!=e?e.className:""}},{key:"setEndpointHover",value:function(t,e,n,i){if(null!=t&&(!1===e||!this.currentlyDragging&&!this.isHoverSuspended())){var o=ir(t.endpoint);if(null!=o&&(null!=t.hoverClass&&(e?this.addClass(o,t.hoverClass):this.removeClass(o,t.hoverClass)),0===n||1===n)){var r=0===n?this.hoverSourceClass:this.hoverTargetClass;e?this.addClass(o,r):this.removeClass(o,r)}if(null!=t.hoverPaintStyle&&(t.paintStyleInUse=e?t.hoverPaintStyle:t.paintStyle,this._suspendDrawing||this.renderEndpoint(t,t.paintStyleInUse)),!i)for(var s=0;s<t.connections.length;s++)this.setConnectorHover(t.connections[s].connector,e,t)}}},{key:"setEndpointVisible",value:function(t,e){er(t.endpoint,e)}},{key:"setGroupVisible",value:function(t,e){for(var n=t.el.querySelectorAll(Vt),i=0;i<n.length;i++)e?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(t,e){return null!=t&&!0!==t.deleted&&(!0!==t.endpoints[0].deleted&&this.setEndpointHover(t.endpoints[0],!1,0,!0),!0!==t.endpoints[1].deleted&&this.setEndpointHover(t.endpoints[1],!1,1,!0),Ln(Dn(n.prototype),"deleteConnection",this).call(this,t,e))}},{key:"addSourceSelector",value:function(t,e,i){return this.addDragFilter(t),Ln(Dn(n.prototype),"addSourceSelector",this).call(this,t,e,i)}},{key:"removeSourceSelector",value:function(t){this.removeDragFilter(t.selector),Ln(Dn(n.prototype),"removeSourceSelector",this).call(this,t)}},{key:"manage",value:function(t,e,i){if(this.containerType===bn.SVG&&ei(t)!==bn.SVG)throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var o=Ln(Dn(n.prototype),"manage",this).call(this,t,e,i);return null!=o&&null!=this._resizeObserver&&this._resizeObserver.observe(o.el),o}}]),n}(pn),lr={width:10,height:0,fill:"transparent",stroke:"transparent"};Qo(wt.type,{makeNode:function(t,e){return ri("circle",{cx:t.w/2,cy:t.h/2,r:t.radius})},updateNode:function(t,e){oi(e,{cx:""+t.w/2,cy:""+t.h/2,r:""+t.radius})}}),Qo(jt.type,{makeNode:function(t,e){return ri("rect",lr)},updateNode:function(t,e){oi(e,lr)}}),Qo(Mt.type,{makeNode:function(t,e){return ri("rect",{width:t.w,height:t.h})},updateNode:function(t,e){oi(e,{width:t.w,height:t.h})}});var cr=0;function ur(t){return new ar((e=cr+1,cr++,e),t);var e}var hr=t=>ur({container:t.get(0)}),dr=n(99);var pr=t=>{let e=Object(dr.a)(t,"jsPlumbInstance");return e||(e=hr(t),Object(dr.c)(t,"jsPlumbInstance",e)),e};function fr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function yr(t,e,n){return e&&vr(t.prototype,e),n&&vr(t,n),t}function gr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xr(t,e)}function _r(t){return(_r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xr(t,e){return(xr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function kr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function br(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?kr(t):e}function Cr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=_r(t);if(e){var o=_r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return br(this,n)}}var Er=function(t){mr(n,t);var e=Cr(n);function n(t,i){var o;return fr(this,n),(o=e.call(this,t,i)).connection=t,gr(kr(o),"showLoopback",void 0),gr(kr(o),"curviness",void 0),gr(kr(o),"margin",void 0),gr(kr(o),"proximityLimit",void 0),gr(kr(o),"orientation",void 0),gr(kr(o),"loopbackRadius",void 0),gr(kr(o),"clockwise",void 0),gr(kr(o),"isLoopbackCurrently",void 0),gr(kr(o),"geometry",null),i=i||{},o.showLoopback=!1!==i.showLoopback,o.curviness=i.curviness||10,o.margin=i.margin||5,o.proximityLimit=i.proximityLimit||80,o.clockwise=i.orientation&&"clockwise"===i.orientation,o.loopbackRadius=i.loopbackRadius||25,o.isLoopbackCurrently=!1,o}return yr(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){var n=e.sourcePos,i=e.targetPos,o=Math.abs(n.curX-i.curX),r=Math.abs(n.curY-i.curY);if(this.showLoopback&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var s=e.sourcePos.curX,a=e.sourcePos.curY-this.margin,l=s,c=a-this.loopbackRadius,u=l-this.loopbackRadius,h=c-this.loopbackRadius;o=2*this.loopbackRadius,r=2*this.loopbackRadius,t.points[0]=u,t.points[1]=h,t.points[2]=o,t.points[3]=r,this._addSegment(vn,{loopback:!0,x1:s-u+4,y1:a-h,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:s-u-4,y2:a-h,cx:l-u,cy:c-h})}else this.isLoopbackCurrently=!1,this._computeBezier(t,e,n,i,o,r)}},{key:"exportGeometry",value:function(){return null==this.geometry?null:{controlPoints:[a({},this.geometry.controlPoints[0]),a({},this.geometry.controlPoints[1])],source:a({},this.geometry.source),target:a({},this.geometry.target)}}},{key:"transformGeometry",value:function(t,e,n){return{controlPoints:[{x:t.controlPoints[0].x+e,y:t.controlPoints[0].y+n},{x:t.controlPoints[1].x+e,y:t.controlPoints[1].y+n}],source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}},{key:"importGeometry",value:function(t){return null!=t&&(null==t.controlPoints||2!=t.controlPoints.length?(T("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):null==t.controlPoints[0].x||null==t.controlPoints[0].y||null==t.controlPoints[1].x||null==t.controlPoints[1].y?(T("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):null==t.source||null==t.source.curX||null==t.source.curY?(T("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):null==t.target||null==t.target.curX||null==t.target.curY?(T("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(t,!1),!0))}}]),n}(Tt),Pr=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},wr=function(t,e){return t.x*e.x+t.y*e.y},Sr=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},jr=function(t,e){return{x:t.x*e,y:t.y*e}},Ar=Math.pow(2,-65);function Mr(t,e){for(var n,i=[],o=function(t,e){for(var n=e.length-1,i=2*n-1,o=[],r=[],s=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=n;c++)o[c]=Pr(e[c],t);for(var u=0;u<=n-1;u++)r[u]=Pr(e[u+1],e[u]),r[u]=jr(r[u],3);for(var h=0;h<=n-1;h++)for(var d=0;d<=n;d++)s[h]||(s[h]=[]),s[h][d]=wr(r[h],o[d]);for(var p=0;p<=i;p++)a[p]||(a[p]=[]),a[p].y=0,a[p].x=parseFloat(""+p)/i;for(var f=n,v=n-1,y=0;y<=f+v;y++)for(var g=Math.max(0,y-v),m=Math.min(y,f),_=g;_<=m;_++){var x=y-_;a[_+x].y+=s[x][_]*l[x][_]}return a}(t,e),r=e.length-1,s=function t(e,n,i,o){var r,s,a=[],l=[],c=[],u=[];switch(function(t,e){var n,i,o=0;n=i=I(t[0].y);for(var r=1;r<=e;r++)(n=I(t[r].y))!=i&&o++,i=n;return o}(e,n)){case 0:return 0;case 1:if(o>=64)return i[0]=(e[0].x+e[n].x)/2,1;if(function(t,e){var n,i,o,r,s,a,l,c,u,h;s=t[0].y-t[e].y,a=t[e].x-t[0].x,l=t[0].x*t[e].y-t[e].x*t[0].y,u=h=0;for(var d=1;d<e;d++){var p=s*t[d].x+a*t[d].y+l;p>u?u=p:p<h&&(h=p)}return 0,1,0,n=(1*(l-u)-0*(c=a))*(1/(0*c-1*s)),i=(1*(l-h)-0*(c=a))*(1/(0*c-1*s)),o=Math.min(n,i),r=Math.max(n,i),r-o<Ar?1:0}(e,n))return i[0]=function(t,e){var n=t[e].x-t[0].x,i=t[e].y-t[0].y,o=t[0].x-0,r=t[0].y-0;return 0+1/(0*n-1*i)*(n*r-i*o)*1}(e,n),1}Dr(e,n,.5,a,l),r=t(a,n,c,o+1),s=t(l,n,u,o+1);for(var h=0;h<r;h++)i[h]=c[h];for(var d=0;d<s;d++)i[d+r]=u[d];return r+s}(o,2*r-1,i,0),a=Pr(t,e[0]),l=Sr(a),c=0,u=0;u<s;u++)a=Pr(t,Dr(e,r,i[u],null,null)),(n=Sr(a))<l&&(l=n,c=i[u]);return a=Pr(t,e[r]),(n=Sr(a))<l&&(l=n,c=1),{location:c,distance:l}}function Dr(t,e,n,i,o){for(var r=[[]],s=0;s<=e;s++)r[0][s]=t[s];for(var a=1;a<=e;a++)for(var l=0;l<=e-a;l++)r[a]||(r[a]=[]),r[a][l]||(r[a][l]={}),r[a][l].x=(1-n)*r[a-1][l].x+n*r[a-1][l+1].x,r[a][l].y=(1-n)*r[a-1][l].y+n*r[a-1][l+1].y;if(null!=i)for(var c=0;c<=e;c++)i[c]=r[c][0];if(null!=o)for(var u=0;u<=e;u++)o[u]=r[e-u][u];return r[e][0]}function Tr(t,e){var n={x:0,y:0};if(0===t)return e[0];var i=e.length-1;if(1===t)return e[i];var o=e,r=1-t;if(0===i)return e[0];if(1===i)return{x:r*o[0].x+t*o[1].x,y:r*o[0].y+t*o[1].y};if(4>i){var s,a,l,c=r*r,u=t*t,h=0;return 2===i?(o=[o[0],o[1],o[2],n],s=c,a=r*t*2,l=u):3===i&&(s=c*r,a=c*t*3,l=r*u*3,h=t*u),{x:s*o[0].x+a*o[1].x+l*o[2].x+h*o[3].x,y:s*o[0].y+a*o[1].y+l*o[2].y+h*o[3].y}}return n}function Ir(t){var e=0;if(!Fr(t))for(var n=function(t,e){var n=[];t--;for(var i=0;i<=t;i++)n.push(Tr(i/t,e));return n}(16,t),i=0;i<15;i++){e+=Lr(n[i],n[i+1])}return e}var Or=new Map;function Gr(t,e){for(var n=function(t){var e=Or.get(t);if(!e){var n=function(t){return function(e){return t}},i=function(t){return function(e){for(var n=1,i=0;i<t.length;i++)n*=t[i](e);return n}};(e=[]).push((function(e){return Math.pow(e,t)}));for(var o=1;o<t;o++){for(var r=[n(t)],s=0;s<t-o;s++)r.push((function(t){return t}));for(var a=0;a<o;a++)r.push((function(t){return 1-t}));e.push(i(r))}e.push((function(e){return Math.pow(1-e,t)})),Or.set(t,e)}return e}(t.length-1),i=0,o=0,r=0;r<t.length;r++)i+=t[r].x*n[r](e),o+=t[r].y*n[r](e);return{x:i,y:o}}function Lr(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Fr(t){return t[0].x===t[1].x&&t[0].y===t[1].y}function Br(t,e,n){if(Fr(t))return{point:t[0],location:e};for(var i=Gr(t,e),o=0,r=e,s=n>0?1:-1,a=null;o<Math.abs(n);)o+=Lr(a=Gr(t,r+=.005*s),i),i=a;return{point:a,location:r}}function Rr(t,e){var n=Gr(t,e),i=Gr(t.slice(0,t.length-1),e),o=i.y-n.y,r=i.x-n.x;return 0===o?1/0:Math.atan(o/r)}function Hr(t,e,n,i,o){var r=i-e,s=t-n,a=t*(e-i)+e*(n-t),l=function(t){return[Nr(t,"x"),Nr(t,"y")]}(o),c=[r*l[0][0]+s*l[1][0],r*l[0][1]+s*l[1][1],r*l[0][2]+s*l[1][2],r*l[0][3]+s*l[1][3]+a],u=zr.apply(null,c),h=[];if(null!=u)for(var d=0;d<3;d++){var p=u[d],f=Math.pow(p,2),v=Math.pow(p,3),y={x:l[0][0]*v+l[0][1]*f+l[0][2]*p+l[0][3],y:l[1][0]*v+l[1][1]*f+l[1][2]*p+l[1][3]},g=void 0;g=n-t!=0?(y[0]-t)/(n-t):(y[1]-e)/(i-e),p>=0&&p<=1&&g>=0&&g<=1&&h.push(y)}return h}function Nr(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function zr(t,e,n,i){var o,r,s=e/t,a=n/t,l=i/t,c=(3*a-Math.pow(s,2))/9,u=(9*s*a-27*l-2*Math.pow(s,3))/54,h=Math.pow(c,3)+Math.pow(u,2),d=[0,0,0];if(h>=0)o=I(u+Math.sqrt(h))*Math.pow(Math.abs(u+Math.sqrt(h)),1/3),r=I(u-Math.sqrt(h))*Math.pow(Math.abs(u-Math.sqrt(h)),1/3),d[0]=-s/3+(o+r),d[1]=-s/3-(o+r)/2,d[2]=-s/3-(o+r)/2,0!==Math.abs(Math.sqrt(3)*(o-r)/2)&&(d[1]=-1,d[2]=-1);else{var p=Math.acos(u/Math.sqrt(-Math.pow(c,3)));d[0]=2*Math.sqrt(-c)*Math.cos(p/3)-s/3,d[1]=2*Math.sqrt(-c)*Math.cos((p+2*Math.PI)/3)-s/3,d[2]=2*Math.sqrt(-c)*Math.cos((p+4*Math.PI)/3)-s/3}for(var f=0;f<3;f++)(d[f]<0||d[f]>1)&&(d[f]=-1);return d}var Vr=function(t){mr(n,t);var e=Cr(n);function n(t){var i;return fr(this,n),gr(kr(i=e.call(this,t)),"curve",void 0),gr(kr(i),"cp1x",void 0),gr(kr(i),"cp1y",void 0),gr(kr(i),"cp2x",void 0),gr(kr(i),"cp2y",void 0),gr(kr(i),"length",0),gr(kr(i),"type",n.segmentType),i.cp1x=t.cp1x,i.cp1y=t.cp1y,i.cp2x=t.cp2x,i.cp2y=t.cp2y,i.x1=t.x1,i.x2=t.x2,i.y1=t.y1,i.y2=t.y2,i.curve=[{x:i.x1,y:i.y1},{x:i.cp1x,y:i.cp1y},{x:i.cp2x,y:i.cp2y},{x:i.x2,y:i.y2}],i.extents={xmin:Math.min(i.x1,i.x2,i.cp1x,i.cp2x),ymin:Math.min(i.y1,i.y2,i.cp1y,i.cp2y),xmax:Math.max(i.x1,i.x2,i.cp1x,i.cp2x),ymax:Math.max(i.y1,i.y2,i.cp1y,i.cp2y)},i}return yr(n,[{key:"getPath",value:function(t){return(t?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(t,e){return t=n._translateLocation(this.curve,t,e),Gr(this.curve,t)}},{key:"gradientAtPoint",value:function(t,e){return t=n._translateLocation(this.curve,t,e),Rr(this.curve,t)}},{key:"pointAlongPathFrom",value:function(t,e,i){return t=n._translateLocation(this.curve,t,i),function(t,e,n){return Br(t,e,n).point}(this.curve,t,e)}},{key:"getLength",value:function(){return null!=this.length&&0!==this.length||(this.length=Ir(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(t,e){var n,i,o,r=(n={x:t,y:e},i=this.curve,o=Mr(n,i),{point:Dr(i,i.length-1,o.location,null,null),location:o.location});return{d:Math.sqrt(Math.pow(r.point.x-t,2)+Math.pow(r.point.y-e,2)),x:r.point.x,y:r.point.y,l:1-r.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return Hr(t,e,n,i,this.curve)}}],[{key:"_translateLocation",value:function(t,e,n){return n&&(e=function(t,e,n){return Br(t,e,n).location}(t,e>0?0:1,e)),e}}]),n}(ot);gr(Vr,"segmentType","Bezier");var Wr=function(t){mr(n,t);var e=Cr(n);function n(t,i){var o;return fr(this,n),(o=e.call(this,t,i)).connection=t,gr(kr(o),"type",n.type),gr(kr(o),"majorAnchor",void 0),gr(kr(o),"minorAnchor",void 0),i=i||{},o.majorAnchor=i.curviness||150,o.minorAnchor=10,o}return yr(n,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(t,e,n,i,o){var r={x:0,y:0};return i[0]!==o[0]||i[1]===o[1]?(0===o[0]?r.x=n.curX<e.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:r.x=t.x+this.majorAnchor*o[0],0===o[1]?r.y=n.curY<e.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:r.y=t.y+this.majorAnchor*i[1]):(0===i[0]?r.x=e.curX<n.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:r.x=t.x-this.majorAnchor*i[0],0===i[1]?r.y=e.curY<n.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:r.y=t.y+this.majorAnchor*o[1]),r}},{key:"_computeBezier",value:function(t,e,n,i,o,r){var s,a,l=n.curX<i.curX?o:0,c=n.curY<i.curY?r:0,u=n.curX<i.curX?0:o,h=n.curY<i.curY?0:r;!0!==this.edited?(s=this._findControlPoint({x:l,y:c},n,i,t.so,t.to),a=this._findControlPoint({x:u,y:h},i,n,t.to,t.so)):(s=this.geometry.controlPoints[0],a=this.geometry.controlPoints[1]),this.geometry={controlPoints:[s,a],source:e.sourcePos,target:e.targetPos},this._addSegment(Vr,{x1:l,y1:c,x2:u,y2:h,cp1x:s.x,cp1y:s.y,cp2x:a.x,cp2y:a.y})}}]),n}(Er);gr(Wr,"type","Bezier");var Xr=function(t){mr(n,t);var e=Cr(n);function n(t,i){var o;return fr(this,n),(o=e.call(this,t,i)).connection=t,gr(kr(o),"type",n.type),gr(kr(o),"_controlPoint",void 0),o.curviness=i.curviness||10,o.margin=i.margin||5,o.proximityLimit=i.proximityLimit||80,o.clockwise=i.orientation&&"clockwise"===i.orientation,o}return yr(n,[{key:"_computeBezier",value:function(t,e,n,i,o,r){var s,a,l,c,u,h,d,p,f=n.curX<i.curX?0:o,v=n.curY<i.curY?0:r,y=n.curX<i.curX?o:0,g=n.curY<i.curY?r:0;if(0===n.x&&(f-=this.margin),1===n.x&&(f+=this.margin),0===n.y&&(v-=this.margin),1===n.y&&(v+=this.margin),0===i.x&&(y-=this.margin),1===i.x&&(y+=this.margin),0===i.y&&(g-=this.margin),1===i.y&&(g+=this.margin),!0!==this.edited){var m=(f+y)/2,_=(v+g)/2,x=(a=v,c=g,(s=f)<=(l=y)&&c<=a?1:s<=l&&a<=c?2:l<=s&&c>=a?3:4),k=Math.sqrt(Math.pow(y-f,2)+Math.pow(g-v,2));this._controlPoint=function(t,e,n,i,o,r,s,a,l){return a<=l?{x:t,y:e}:1===n?i.curY<=0&&o.curY>=1?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX>=1&&o.curX<=0?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+-1*r,y:e+-1*s}:2===n?i.curY>=1&&o.curY<=0?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX>=1&&o.curX<=0?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+r,y:e+-1*s}:3===n?i.curY>=1&&o.curY<=0?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX<=0&&o.curX>=1?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+-1*r,y:e+-1*s}:4===n?i.curY<=0&&o.curY>=1?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX<=0&&o.curX>=1?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+r,y:e+-1*s}:void 0}(m,_,x,e.sourcePos,e.targetPos,this.curviness,this.curviness,k,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];u=this._controlPoint.x,h=this._controlPoint.x,d=this._controlPoint.y,p=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:e.sourcePos,target:e.targetPos},this._addSegment(Vr,{x1:y,y1:g,x2:f,y2:v,cp1x:u,cp1y:d,cp2x:h,cp2y:p})}}]),n}(Er);gr(Xr,"type","StateMachine"),Ft(Wr.type,Wr),Ft(Xr.type,Xr);var Yr=n(17);const Ur={h:["ContinuousTopBottom","ContinuousTopBottom"],v:["ContinuousLeftRight","ContinuousLeftRight"]};var qr=t=>{const e=Object(Yr.a)(t,"data-display")||"v";return Ur[e]};n(25);var Zr=t=>t.hasClass("matchItem");var Jr=t=>t.hasClass("matchTarget");var $r=(t,e)=>{const n=t.get(0),i=e.get(0),o=Zr(t),r=Jr(e);if(o&&!r||!o&&r)throw new Error("Cannot create connection between two items of the same type");return{source:o?n:i,target:r?i:n}};var Qr=(t,e,n,i)=>{const o=pr(t),r=qr(t),{source:s,target:a}=$r(n,e),l=o.connect({source:s,target:a,anchors:r,connector:{type:Wr.type,options:{strokeWidth:5,curviness:120,cssClass:i}},endpoints:[{type:"Dot",options:{radius:8,cssClass:i}},{type:"Dot",options:{radius:8,cssClass:i}}]});l.endpoints[0].enabled=!1,l.endpoints[1].enabled=!1};var Kr=(t,e,n,i,o)=>{const s=pr(t),a=n.get(0);e.each((e,l)=>{const c=r()(l).get(0);!i&&o&&(s.deleteConnectionsForElement(c),s.deleteConnectionsForElement(a));const u=s.getConnections({target:a}),h=s.getConnections({source:c});u.length>0||h.length>0||(s.deleteConnectionsForElement(c),s.deleteConnectionsForElement(a),(!o||o&&i)&&Qr(t,n,r()(c),o?"userAnswer":"showCorrectAnswer"))})},ts=n(338);n(11),n(48);var es=(t,e)=>{const n=Array.isArray(e)?e:[e];return r()(n).map((e,n)=>t.find(".matchItem[data-rcfid='".concat(n,"']")))};var ns=(t,e)=>t.find(".matchTarget[data-rcfid='".concat(e,"']"));var is=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=t.$interaction,i=t.value;i.filter(t=>!!t.value).forEach(t=>{const i=Object(ts.a)(t),o=t.value,r=ns(n,t.elm),s=es(n,o);Kr(n,s,r,i,e)})},os=n(4),rs=n(340),ss=n(371);function as(t){const e=t.$interaction;t.value.forEach(t=>{const n=t.elm,i=ns(e,n),o=Object(ts.a)(t);if(Object(os.y)(i))return;const r=Object(ss.a)(i);Object(rs.a)(r,o)})}var ls=n(8);var cs=t=>t&&t.length>0&&Object(os.v)(r()(t[0].source))||"";var us=(t,e)=>{const n=e.getConnections({target:t.get(0)}),i=cs(n);return{elm:Object(os.v)(t)||"",type:ls.a.simple,value:i}};var hs=t=>{const e=pr(t);return t.find(".matchTarget:not(.example, .distractor)").get().map(t=>us(r()(t),e))};var ds=t=>({elm:Object(os.v)(t)||"",type:ls.a.composite,markType:ls.d.byItem,value:hs(t)});var ps=t=>{const e=pr(t),n=t.find(".matchTarget:not(.example,.distractor)");let i=!0;return n.each((t,n)=>{const o=r()(n),s=e.getConnections({target:o.get(0)});Object(os.y)(s)&&(i=!1)}),i};function fs(t){t.each((t,e)=>{const n=r()(e),i=pr(n);if(i)try{i.setSuspendDrawing(!1,!0)}catch(t){}})}var vs=n(336);var ys=t=>{const e=pr(t);t.find(".matchTarget:not(.example)").get().forEach(t=>{e.deleteConnectionsForElement(t)})};function gs(t){Object(vs.a)(t),t.filter(":not(.example)").get().forEach(t=>ys(r()(t))),fs(t)}var ms=n(476),_s=n.n(ms),xs=n(51);n(106);function ks(t,e,n){const i=r()(t.currentTarget),o=e.elm,s=JSON.parse(JSON.stringify(e));if(o!==Object(os.v)(i))return;const a=s.value.filter(t=>t.elm===n);s.value=a,s.$interaction=i,is(s,!1)}var bs=n(419),Cs=n(365);var Es=t=>{const e=t.instance,n=r()(e.getContainer()),i=r()(t.source),o=r()(t.target);if(Object(os.i)(n).hasClass("rcfFeedbackPlaying"))return;if(Object(os.y)(i)||Object(os.y)(o))return;if(i.hasClass("example")||o.hasClass("example"))return;e.deleteConnectionsForElement(t.target);const s=o.closest(".matchTargetContainer"),a=Object(bs.a)(s);Object(Cs.a)(a)},Ps=n(29);var ws=t=>t.find(".matchItem.selected").first();var Ss=(t,e,n,i)=>{const o=Object(Ps.a)();o.feedbackOptions&&function(t){if(!Object(Ps.a)().feedbackOptions)return;const e=ws(t),n=pr(t),i=Object(Yr.a)(e,"id")||"";if(i.length<1)return;const o=n.getConnections({source:r()("#".concat(i))[0]});if(!o||o.length<1)return;const s=r()(o[0].target).parent().find(".mark");Object(Cs.a)(s)}(t),i.deleteConnectionsForElement(e.get(0)),i.deleteConnectionsForElement(n.get(0)),Qr(t,n,e,"userAnswer"),e.removeClass("selected"),n.removeClass("selected"),fs(t),o.feedbackOptions&&function(t,e,n){const i=Object(Ps.a)();if(!i.feedbackOptions)return;const o=i.feedbackOptions.onAnswerChanged;if(!o||"function"!=typeof o)return;const r=Object(os.i)(t),s=Object(os.v)(t),a=Object(Yr.a)(r,"id")||"",l=Object(os.v)(n),c=Object(os.v)(e);o({id:a,answers:[{elm:s,type:ls.a.composite,markType:ls.d.byItem,value:[{elm:l,type:ls.a.simple,value:c}]}]})}(t,e,n)};var js=(t,e,n)=>{const i=r()(t.getContainer()),o=n(i),s=!Object(os.y)(o);return s&&Ss(i,e,o,t),s};var As=t=>t.closest(".matchingContainer");var Ms=t=>t.find(".matchTarget.selected").first();var Ds=t=>t.hasClass("example")?r()([]):t.hasClass("dev-matchable-element")?t:t.closest(".dev-matchable-element:not(.example)");var Ts=(t,e)=>{e.addClass("exclude"),t.find(".selected:not(.exclude)").removeClass("selected"),e.removeClass("exclude")};var Is=t=>{const e=r()(t.srcElement),n=As(e),i=Ds(e);if(Object(os.y)(i))return;const o=pr(n),s=Object(os.i)(n),a=i.hasClass("matchTarget");js(o,i,a?ws:Ms)||(Ts(s,i),i.toggleClass("selected"))};var Os=t=>{t.filter(":not(.example)").each((t,e)=>{const n=r()(e),i=pr(n);i.bind(Ai,Es),i.on(n,"click",Is)})};var Gs=t=>t.find(".matchTargets");var Ls=t=>{const e=Gs(t);Object(os.G)(e,".matchTargetContainer","seed:matchTargets")};var Fs=t=>t.find(".matchItems");var Bs=t=>{const e=Fs(t);Object(os.G)(e,".matchItemContainer","seed:matchItems")};var Rs=(t,e)=>t.find(".matchItem[data-rcfid='".concat(e,"']"));var Hs=t=>{const e=Gs(t).find(".matchTarget.example");e.each((t,e)=>{(t=>{const e=As(t),n=(Object(Yr.a)(t,"data-matchItem-rcfid")||"").split("|")[0],i=Rs(e,n),o=pr(e);if(Object(os.y)(i))throw"Cannot find match item with id [".concat(n,"]");o.batch(()=>{o.deleteConnectionsForElement(t[0]),Qr(e,t,i,"showExampleAnswer"),i.addClass("example"),i.closest(".matchItemContainer").addClass("example")})})(r()(e))})};var Ns=async(t,e)=>{const n=e.find("*[data-rcfinteraction='matching']");return t.$activity=e,t.$selector=n,Ls(n),Bs(n),new Promise(t=>{var i;i=()=>{Os(n),function(t){t.on("rcf.single.answer","*[data-rcfinteraction='matching']",ks)}(e),Hs(n),function(t){r()(xs.a).resize(()=>{fs(t)})}(n),_s()(n.get(0),()=>{fs(n),t()})},function t(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?i():setTimeout(t,9)}()})};function zs(t,e){const n=e.find(".matchTarget"),i=pr(t),o=Object(bs.a)(e);Object(Cs.a)(o),i.deleteConnectionsForElement(n.get(0))}var Vs=n(335);class Ws extends Vs.a{constructor(t){super(t,i),this.$activity=t}async initialise(){await Ns(this,this.$activity)}provideFeedback(t){!function(t,e){const n=e.answers[0].elm,i=t.filter("[data-rcfid='".concat(n,"']"));if(Object(os.y)(i))return;const o=e.answers[0].value[0].elm,r="1"==e.answers[0].value[0].verification[0],s=ns(i,o);window.RCF.Handlers.FeedbackHandler.provideFeedback(i,s.closest(".matchTargetContainer"),r,zs)}(this.$selector,t)}}e.default=Ws}}]);
/* build created on 15/08/2025 16:19 */
//# sourceMappingURL=http://localhost:4000/source-maps/interactions/marked/rcfMatching.js.map