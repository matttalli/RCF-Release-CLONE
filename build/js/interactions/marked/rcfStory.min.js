(window.rcfRunTime_24113=window.rcfRunTime_24113||[]).push([["interactions/marked/rcfStory"],{676:function(e,t,s){"use strict";s.r(t);s(25),s(6),s(11);var i=s(5),n=s.n(i),a=s(17);var o=e=>Object(a.a)(e,"data-mode")||"";var r=e=>e.closest(".story"),c=s(4);var d=e=>e.find(".scene.active");var l=e=>d(e).prev(".scene");var h=e=>e.hasClass("comprehension");var u=e=>e.hasClass("showQuestions");function v(e,t){return parseInt(Object(a.a)(e,t)||0)}function y(e){e.addClass("active")}function p(e){e.removeClass("active")}function f(e){return!Object(c.y)(Object(a.a)(e,"data-speechaudio"))}var m=e=>{e.trigger("rcf.scene.complete")};var b=(e,t,s)=>{const i=n()(function(e){return e.find(".speech").get()}(t));e.addClass("showQuestions"),t.addClass("showQuestions"),"modeListen"!==s&&y(i),m(e)};var g=e=>{e.addClass("active"),e.removeClass("hide")};var C=e=>{e.find(".speech.active").removeClass("active")};var $=e=>{e.addClass("hide"),e.removeClass("active"),C(e)},A=s(29);var P=()=>"comprehension"===(Object(A.a)().storyPlayingMode||"comprehension");const j=Object.freeze({read:"modeRead",listen:"modeListen",listenAndRead:"modeListenRead"}),O=Object.freeze({before:"before",playing:"playing",after:"after"});var k=e=>e.hasClass("modeListen")?j.listen:e.hasClass("modeRead")?j.read:(e.hasClass("modeListenRead"),j.listenAndRead);const w="rcf.story.change.page";function E(e,t,s,i,n){const a=Object(c.i)(e);n&&e.addClass("dev-seen-last-page");const o=new CustomEvent(w,{type:w,detail:{hasQuestions:t,isCoverPage:s,isFirstPage:i,isLastPage:n},bubbles:!0,cancellable:!0,composed:!1});a.get(0).dispatchEvent(o),a.trigger(w,{hasQuestions:t,isCoverPage:s,isFirstPage:i,isLastPage:n})}var R=(e,t)=>{e.removeClass("showQuestions"),t.removeClass("showQuestions")};var q=e=>e.find(".navigation .button.next");var L=e=>e.find(".navigation .button.back");function S(e){q(e).addClass("active")}function T(e){q(e).removeClass("active")}function x(e){L(e).addClass("active")}function D(e){L(e).removeClass("active")}var Q=e=>{e.trigger("rcf.scene.reset")},B=s(99);var F=e=>Object(B.a)(e,"controller");var M=e=>{const t=F(e);Object(c.y)(t)||t.stopPlaying()};var z=e=>{const t=F(e);Object(c.y)(t)||t.startPlaying()};var N=e=>{const t=d(e),s=l(e),i=!Object(c.y)(s),n=k(e),a=P();let o=!1,r=!1;if(Q(e),x(e),a){const s=h(t);if(s&&!u(t))return M(t),b(e,t,n),r=!0,o=!i,i?S(e):T(e),void E(e,r,!1,!1,o);s&&R(e,t)}if(!i)return E(e,r,!1,!1,!0),void T(e);$(t),g(s),z(s);const v=a&&h(s)||!Object(c.y)(l(e));v?S(e):T(e),o=!v,E(e,r,!1,!1,o)};var U=e=>d(e).next(".scene");var W=e=>e.find(".cover");var _=e=>{const t=d(e),s=W(e);$(t),g(s),T(e),D(e);Q(e),E(e,!1,!0,!1,!1)};var I=e=>{const t=d(e),s=U(e),i=P(),n=k(e),a=Object(c.y)(s);let o=!1;return Q(e),S(e),i&&h(t)&&u(t)?(R(e,t),E(e,!1,!1,a,!1),void z(t)):a?(M(t),_(e),void D(e)):(i&&h(s)?(o=!0,b(e,s,n),M(t)):z(s),E(e,o,!1,a,!1),g(s),void $(t))};var G=e=>e.find(".scene:last");var H=e=>{const t=W(e),s=G(e);$(t),g(s),S(e),x(e);E(e,!1,!1,!0,!1),z(s)};var J=e=>{const t=r(e);switch(o(e)){case"read":!function(e){e.removeClass("modeListen").removeClass("modeListenRead").addClass("modeRead"),H(e)}(t);break;case"listen":!function(e){e.removeClass("modeRead").removeClass("modeListenRead").addClass("modeListen"),H(e)}(t);break;case"listenRead":!function(e){e.removeClass("modeListen").removeClass("modeRead").addClass("modeListenRead"),H(e)}(t);break;case"previous":I(t);break;case"next":N(t)}};var K=(e,t)=>{const s=F(e);Object(c.y)(s)||s.replayAudio(t)};var V=e=>{const t=e.closest(".scene");K(t,e)};var X=e=>{e.on("rcf.scene.reset",()=>{e.removeClass("sceneCompleted")}),e.on("rcf.scene.complete",()=>{e.addClass("sceneCompleted")}),e.on("click",".navigation .button",e=>{const t=n()(e.currentTarget);J(t),e.preventDefault()}),e.on("click",".cover .button",e=>{const t=n()(e.currentTarget);J(t),e.preventDefault()}),e.on("click",".frame .speech",e=>{const t=n()(e.currentTarget);V(t),e.preventDefault()})};s(31);var Y=(e,t)=>{e.find("audio.storyAudio").removeClass("playing"),t.pause(),t.currentTime=0};var Z=e=>{const t=e.find(".storyAudioContainer.audioContainer audio.storyPlaybackAudioPlayer").get(0);if(!t)throw new Error("Could not find expected audio.storyPlaybackAudioPlayer element");return t};var ee=(e,t,s)=>{const i=e.get(0);t.addClass("playing"),e.on("ended",()=>{t.removeClass("playing"),i.currentTime=0,s()}),i.play()};var te=e=>e.hasClass("sceneAudio");var se=e=>e.find(".hiddenAudio audio.speechAudio").length>0;var ie=e=>{e.off("ended"),e.empty()};var ne=(e,t)=>{t.find("source").clone().appendTo(e);e.get(0).load()};var ae=e=>{e.pause()};var oe=e=>{e.play()};function re(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ce{constructor(e){re(this,"$activity",void 0),re(this,"storyPlaybackAudioElement",void 0),re(this,"$storyPlaybackAudioElement",void 0),re(this,"$scene",void 0),re(this,"$story",void 0),re(this,"$sequence",void 0),re(this,"position",void 0),re(this,"phase",void 0),re(this,"playing",void 0),re(this,"paused",void 0),re(this,"mode",void 0),this.$activity=Object(c.i)(e),this.storyPlaybackAudioElement=Z(this.$activity),this.$storyPlaybackAudioElement=n()(this.storyPlaybackAudioElement),this.$scene=e,this.$story=r(e),this.$sequence=function(e){return e.find(".dev-scenePlayableElement").get()}(e),this.position=0,this.phase=O.before,this.playing=!1,this.paused=!1}startPlaying(){this.position=0,this.phase=O.before,this.mode=k(this.$story);this.$scene.siblings(".scene").each((function(){const e=n()(this);M(e)})),this.playing=!0,this.playCurrentPhase()}stopPlaying(){this.playing=!1,Y(this.$scene,this.storyPlaybackAudioElement)}promiseResolver(e,t){e===this.position&&t===this.phase&&this.playing&&(t===O.after?(this.phase=O.before,this.position++):t===O.before?this.phase=O.playing:t===O.playing&&(this.phase=O.after),e<this.$sequence.length?this.playCurrentPhase():(this.playing=!1,m(this.$story)))}getResolver(e,t,s){return()=>{s(e,t)}}playCurrentPhase(){const e=this.getResolver(this.position,this.phase,this.promiseResolver.bind(this)),t=n()(this.$sequence[this.position]);switch(this.phase){case O.before:this.playDelayBefore(t,e);break;case O.playing:this.playSpeech(t,e);break;case O.after:this.playDelayAfter(t,e)}}playDelayBefore(e,t){let s;s=this.mode===j.read?0:function(e){return v(e,"data-delaybefore")}(e),Object(c.E)(s).then(t)}playDelayAfter(e,t){let s;s=this.mode===j.read?0:function(e){return v(e,"data-delayafter")}(e),Object(c.E)(s).then(t)}playSpeech(e,t){const s=Object(c.v)(e)||"";if(this.mode!==j.listen&&y(e),f(e)&&this.mode!==j.read){const e=this.$scene.find('.storyAudio[data-speechid="'.concat(s,'"]'));return this.playAudioElement(e).then(t)}return Object(c.E)().then(t)}playAudioElement(e){return this.playing=!0,ie(this.$storyPlaybackAudioElement),ne(this.$storyPlaybackAudioElement,e),new Promise(t=>{ee(this.$storyPlaybackAudioElement,e,t),te(e)&&!se(this.$scene)&&t("no-speech-audio")})}replayAudioWithSequence(e){Y(this.$scene,this.storyPlaybackAudioElement),this.position=this.$sequence.indexOf(e[0]),this.phase=O.playing;for(let e=this.position+1;e<this.$sequence.length;e++){p(n()(this.$sequence[e]))}this.playCurrentPhase()}replayAudio(e){if(this.playing)this.replayAudioWithSequence(e);else if(f(e)){Y(this.$scene,this.storyPlaybackAudioElement);const t=Object(c.v)(e)||"",s=this.$scene.find('.storyAudio[data-speechid="'.concat(t,'"]'));this.playAudioElement(s)}}pauseSequence(){this.paused=!0,this.playing=!1;const e=n()(this.$sequence[this.position]);if(ae(this.storyPlaybackAudioElement),this.phase===O.playing&&this.mode!==j.read&&f(e)){const t=Object(c.v)(e)||"";this.$scene.find('.storyAudio[data-speechid="'.concat(t,'"]')).removeClass("playing")}}resumeSequence(){if(!this.paused)return;this.storyPlaybackAudioElement.paused&&this.storyPlaybackAudioElement.currentTime>0&&oe(this.storyPlaybackAudioElement),this.playing=!0;const e=n()(this.$sequence[this.position]);if(this.phase===O.playing&&this.mode!==j.read&&f(e)){const t=Object(c.v)(e)||"";this.$scene.find('.storyAudio[data-speechid="'.concat(t,'"]')).addClass("playing")}else this.promiseResolver(this.position,this.phase)}}var de=function(e){e.each((function(){const e=n()(this);Object(B.c)(e,"controller",new ce(e))}))};var le=e=>{if("ogg"===Object(A.a)().mediaFormats.audio.format){e.find(".hiddenAudio source").each((e,t)=>{const s=t.src.split(".");s[s.length-1]="ogg",t.src=s.join("."),t.parentElement.load()})}};var he=(e,t)=>{e.$activity=t,e.$story=t.find(".story"),e.$cover=t.find(".story .cover"),e.$scenes=t.find(".story .scene"),X(e.$story),function(e){const t=e.find(".sceneAudio, .speechAudio"),s=e.find(".speech");if(0===t.length){e.find(".cover .button.listen, .cover .button.listenRead").removeClass("active")}if(0===s.length){e.find(".cover .button.read,.cover .button.listenRead").removeClass("active")}}(e.$story),_(e.$story),de(e.$scenes),le(t)};var ue=e=>e.find(".scene"),ve=function(e){e.removeClass("modeRead"),e.removeClass("modeListen"),e.removeClass("modeListenRead")};var ye=e=>{e.each((function(){const e=n()(this);M(e)}))};var pe=e=>{const t=e.$story,s=W(t),i=ue(t),n=L(t),a=q(t);t.removeClass("dev-seen-last-page"),$(i),R(t,i),ye(i),g(s),Q(t),n.removeClass("active"),a.removeClass("active"),ve(t),E(t,!1,!0,!1,!1)};var fe=e=>{const t=F(e);Object(c.y)(t)||t.pauseSequence()};var me=e=>{const t=d(e);Object(c.y)(t)||fe(t)};var be=e=>{const t=F(e);Object(c.y)(t)||t.resumeSequence()};var ge=e=>{const t=d(e);Object(c.y)(t)||be(t)};var Ce=e=>Object(c.y)(e.next());var $e=e=>Object(c.y)(e.prev());var Ae=(e,t)=>{const s=d(e),i=P(),n=k(e),a=Ce(t),o=$e(t),r=i&&h(t);i&&u(s)&&R(e,s),Q(e),M(s),r?b(e,t,n):z(t),o?T(e):S(e),E(e,r,!1,a,o),g(t),$(s)};s(246),s(13);var Pe=e=>{const t=e.find(".scene.comprehension").get().reverse().find(e=>{const t=n()(e).find(".mark");if(t.filter(".wrong").length>0)return!0;const s=t.filter(":not(.correct,.wrong)");return!(s.closest(".example").length>0)&&s.length===t.length});if(t)return n()(t)};var je=e=>{const t=Pe(e);if(!t)return;const s=d(e),i=Object(c.v)(s),n=Object(c.v)(t);i&&i!==n&&Ae(e,t)};function Oe(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,"default",(function(){return ke}));class ke{constructor(e){Oe(this,"$activity",void 0),Oe(this,"$cover",void 0),Oe(this,"$story",void 0),Oe(this,"$scenes",void 0),he(this,e)}clearMarkedAnswers(){}showAnswers(e,t){t&&je(this.$story)}getUserAnswers(){return[{elm:"story",type:"simple",markType:"unmarked",markedBy:"nobody",value:this.$story.hasClass("dev-seen-last-page")?"y":""}]}showMarkedAnswers(){}showUserAnswers(){}reset(){pe(this)}pause(){me(this.$story)}resume(){ge(this.$story)}}}}]);
/* build created on 15/08/2025 16:19 */
//# sourceMappingURL=http://localhost:4000/source-maps/interactions/marked/rcfStory.js.map